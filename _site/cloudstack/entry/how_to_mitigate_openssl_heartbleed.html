<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>How to Mitigate OpenSSL HeartBleed Vulnerability in Apache CloudStack | Blogs Archive</title>
<meta name="generator" content="Jekyll v3.9.3" />
<meta property="og:title" content="How to Mitigate OpenSSL HeartBleed Vulnerability in Apache CloudStack" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="OpenSSL is an important part of Apache CloudStack. In light of the recent “HeartBleed” vulnerability disclosure, we are providing instructions on how to mitigate the vulnerability in your infrastructure." />
<meta property="og:description" content="OpenSSL is an important part of Apache CloudStack. In light of the recent “HeartBleed” vulnerability disclosure, we are providing instructions on how to mitigate the vulnerability in your infrastructure." />
<link rel="canonical" href="http://localhost:4000/cloudstack/entry/how_to_mitigate_openssl_heartbleed" />
<meta property="og:url" content="http://localhost:4000/cloudstack/entry/how_to_mitigate_openssl_heartbleed" />
<meta property="og:site_name" content="Blogs Archive" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2014-04-09T18:05:23-04:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="How to Mitigate OpenSSL HeartBleed Vulnerability in Apache CloudStack" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2014-04-09T18:05:23-04:00","datePublished":"2014-04-09T18:05:23-04:00","description":"OpenSSL is an important part of Apache CloudStack. In light of the recent “HeartBleed” vulnerability disclosure, we are providing instructions on how to mitigate the vulnerability in your infrastructure.","headline":"How to Mitigate OpenSSL HeartBleed Vulnerability in Apache CloudStack","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/cloudstack/entry/how_to_mitigate_openssl_heartbleed"},"url":"http://localhost:4000/cloudstack/entry/how_to_mitigate_openssl_heartbleed"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Blogs Archive" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Blogs Archive</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">How to Mitigate OpenSSL HeartBleed Vulnerability in Apache CloudStack</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2014-04-09T18:05:23-04:00" itemprop="datePublished">Apr 9, 2014
      </time>• <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">{"display_name"=>"John Kinsella", "login"=>"jlk", "email"=>"jlk@apache.org "}</span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p><b>UPDATE 1:</b> The instructions below are incomplete. The proper upgrade command is "apt-get install openssl libssl1.0.0". If you've just updated openssl, please go back and update libssl as well.<br><br />
<b>UPDATE 2:</b> Adding instructions for VMWare-hosted System VMs (Thanks to Geoff Higginbottom at ShapeBlue)</b><br><br />
<b>UPDATE 3:</b> Added instructions for verification of correct versions installed<br><br />
<b>UPDATE 4:</b> Apache CloudStack 4.0-4.1 not vulnerable, they use older Debian/openssl.<br></p>
<p>Earlier this week, a security vulnerability was disclosed in OpenSSL, one of the software libraries that Apache CloudStack uses to encrypt data sent over network network connections. As the vulnerability has existed in OpenSSL since early 2012, System VMs in Apache CloudStack versions 4.1.1-4.3 are running software using vulnerable versions of OpenSSL. This includes CloudStack's Virtual Router VMs, Console Proxy VMs, and Secondary Storage VMs.</p>
<p>We are actively working on creating updated System VM templates for each recent version of Apache CloudStack, and for each of the hypervisor platforms which Apache CloudStack supports. Due to our testing and QA processes, this will take several days. In the meantime, we want to provide our users with a temporary workaround for currently running System VMs.</p>
<p>If you are running Apache CloudStack 4.0.0-incubating through the recent 4.3 release, the the following steps will help ensure the security of your cloud infrastructure until an updated version of the System VM template is available:</p>
<h2> For KVM/Xen hosted systems</h2>
<ol>
<li> As an administrator in the CloudStack web UI, navigate to Infrastructure->System VMs</li>
<li> For each System VM listed, note the host it is running on, and it&rsquo;s &ldquo;Link Local IP address."</li>
<li> With that data, perform the following steps for each System VM:
<ol type="a">
<li> ssh into that host as root</li>
<li> From the host, ssh into the SSVM via it&rsquo;s link local IP address: (e.g. ssh -i /root/.ssh/id_rsa.cloud -p 3922 169.254.3.33)</li>
<li> On the System VM, first run "apt-get update"</li>
<li> Then run apt-get install "openssl libssl1.0.0". If a dialog appears asking to restart programs, accept it&rsquo;s request.</li>
<li> Next, for Secondary Storage VMs, run /etc/init.d/apache2 restart</li>
<li> Log out of the System VM and host server</li>
</ol>
</li>
<li>Back in the CloudStack UI, now navigate to Infrastructure->Virtual Routers. For each VR, host it's running on and it's link local IP address, and then repeat steps a-f above.</li>
</ol>
<h2> For VMWare hosted systems</h2>
<ol>
<li> As an administrator in the CloudStack web UI, navigate to Infrastructure->System VMs</li>
<li> For each System VM listed, note it's management IP address</li>
<li> With that data, perform the following steps for each System VM:</li>
<ol type="a">
<li> From the Management Server, ssh to the System VM via it's management IP: (eg ssh -i /var/lib/cloud/management/.ssh/id_rsa -p 3922 root@10.40.50.8)</li>
<li> On the System VM, first run "apt-get update"</li>
<li> Then run apt-get install "openssl libssl1.0.0". If a dialog appears asking to restart programs, accept it&rsquo;s request.</li>
<li> Next, for Secondary Storage VMs, run /etc/init.d/apache2 restart</li>
<li> Log out of the System VM</li>
</ol>
</li>
<li>Back in the CloudStack UI, now navigate to Infrastructure->Virtual Routers. For each VR, host it's running on and it's link local IP address, and then repeat steps a-f above.</li>
</ol>
<h2>Verification</h2>
<p>On each System VM, you can test if it has non-vulnerable openssl packages installed by listing installed packages and looking at the installed versions of openssl and libssl. As in the example below, for a system to be non-vulnerable, the packages need to be at or above version 1.0.1e-2+deb7u6:</p>
<pre>
root@v-14-VM:~# dpkg -l|grep ssl
ii  libssl1.0.0:i386                     1.0.1e-2+deb7u6                  i386         SSL shared libraries
ii  openssl                              1.0.1e-2+deb7u6                  i386         Secure Socket Layer (SSL) binary and related cryptographic tools
</pre>
<p>We realize that for larger installations where System VMs are being actively created and destroyed based on customer demand, this is a very rough stop-gap. The Apache CloudStack security team is actively working on a more permanent fix and will be releasing that to the community as soon as possible.</p>
<p>For Apache CloudStack installations that secure the web-based user-interface with SSL, these may also be vulnerable to HeartBleed, but that is outside the scope of this blog post. We recommend testing your installation with [1] to determine if you need to patch/upgrade the SSL library used by any web servers (or other SSL-based services) you use.</p>
<p>1: <a target="_new" href="http://filippo.io/Heartbleed/">http://filippo.io/Heartbleed/</a></p>

  </div><a class="u-url" href="/cloudstack/entry/how_to_mitigate_openssl_heartbleed" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Blogs Archive</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Blogs Archive</li><li><a class="u-email" href="mailto:issues@infra.apache.org">issues@infra.apache.org</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/jekyll"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">jekyll</span></a></li><li><a href="https://www.twitter.com/jekyllrb"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">jekyllrb</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>This is an archive of the Roller blogs that were previously hosted on blogs.apache.org</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
