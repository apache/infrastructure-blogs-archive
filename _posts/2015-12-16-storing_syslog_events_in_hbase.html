---
layout: post
status: PUBLISHED
published: true
title: Getting Syslog Events to HBase
author:
  display_name: Bryan Bende
  login: bbende
  email: bbende@apache.org
author_login: bbende
author_email: bbende@apache.org
id: c70286b5-7349-4b1e-9425-34066513d5f1
date: '2015-12-16 13:39:24 -0500'
categories:
- Dataflow
tags:
- syslog
- hbase
- logging
comments:
- id: 0
  author: hadoop user
  author_email: hadoopuser.hadoop@gmail.com
  author_url: ''
  date: '2017-10-20 12:41:33 -0400'
  content: "Hi can we do the same way when we use TCP?\r\nAlso, I need to get rfc
    5424 format, so the above approach works?\r\nAs I am new to nifi, please help
    me."
- id: 0
  author: Lloyd Flaton
  author_email: lloydflaton@yopmail.com
  author_url: ''
  date: '2018-03-11 17:26:02 -0400'
  content: Parsing and batching it's what i like this  attribute the most http://imvucreditshack.club
- id: 0
  author: Sara Monero
  author_email: saramonero@yopmail.com
  author_url: ''
  date: '2018-03-11 17:33:25 -0400'
  content: Do you guys know how long i have been searching for a page like this for
    apache, as i am addicted to code about apache http://episodehack.club/
- id: 0
  author: enapenrhod1982
  author_email: libuckkili1987@gmail.com
  author_url: https://blogs.apache.org/couchdb/entry/board_report_may_2014
  date: '2019-07-20 18:45:29 -0400'
  content: Beautiful, intricate, dynamic. these are awesome shots. what technique
    did you use?
- id: 0
  author: itarfimea1979
  author_email: spanriconcau1980@gmail.com
  author_url: https://blogs.apache.org/logging/entry/apache_log4j_2_0_is
  date: '2019-07-20 23:46:49 -0400'
  content: It&rsquo;s so amazing ,I&rsquo;m love it so much! I admire your works!
    Awesome logo :)
- id: 0
  author: candwehoumu1974
  author_email: adingroweed1977@gmail.com
  author_url: https://blogs.apache.org/carbondata/entry/apache-carbondata-1-1-0
  date: '2019-07-21 05:00:03 -0400'
  content: Fun work you have here. Its too smart
- id: 0
  author: poichildpromes1976
  author_email: produngaasol1976@gmail.com
  author_url: https://blogs.apache.org/click/entry/click_2_1_0_now
  date: '2019-07-21 05:32:54 -0400'
  content: Really love this color and creative concept Fantastic work.
- id: 0
  author: centleacacon1981
  author_email: abdarwhire1975@gmail.com
  author_url: https://blogs.apache.org/openmeetings/entry/google_summer_of_code_2012
  date: '2019-07-21 07:18:55 -0400'
  content: Such attention to detail. Amazing work! Thank you James.@James Hernandez
- id: 0
  author: toatelloweb1971
  author_email: desccogado1978@gmail.com
  author_url: https://blogs.apache.org/ofbiz/entry/apache_ofbiz_news_september_2015
  date: '2019-07-21 08:55:27 -0400'
  content: Fantastic illustrations! You can see the amount of work you put into this
    project. Great work. Cheers, mate!
- id: 0
  author: derswhishomar1970
  author_email: deparkcafir1987@gmail.com
  author_url: https://blogs.apache.org/openejb/entry/example_common_troubleshooting_flags
  date: '2019-07-21 10:01:06 -0400'
  content: Good shots! A beautiful pieces of our planet 好
- id: 1
  author: plactimoman1978
  author_email: haimarthmeame1970@gmail.com
  author_url: https://blogs.apache.org/kafka/entry/apache-kafka-supports-more-partitions
  date: '2019-07-21 07:51:03 -0400'
  content: even as automobilist love the typo, great job
- id: 3
  author: Live Streaming Bola online
  author_email: aa@gmail.com
  author_url: ''
  date: '2019-06-21 19:52:49 -0400'
  content: "Welcome fred.. mantab lah seenggaknya ada pemain masuk sblom WC..\r\n\r\nDan
    ane rasa tim sekelas MU pasti bakal sign big name di stiap musimnya, untuk menaikkan
    value MU gan..\r\napalagi MU doyan bgt iklan dmn2 dan lama bgt buat sign pemain
    bintangnya..\r\nhttps://fansbarcelona999.blogspot.com/2019/05/barcelona-menjalani-laga-liga-champions.html\r\nhttps://juventusindo.weebly.com/\r\nhttps://www.storeboard.com/blogs/sports-and-fitness/fans-keren-manchester-united-indonesia/961863\r\nhttps://fansliverpool.yolasite.com/\r\nhttps://liverpool999.home.blog/2019/05/01/strategi-klopp-menangani-liverpool/\r\nhttp://icalshare.com/calendars/8796\r\nhttps://berandasehat.com/ahli-kunci-karawang/\r\nane
    masih penasaran MU bakal gaet sapa yak.. ane sih berharap griezmen yg masuk..
    deadwood\" di dibuang..."
- id: 3
  author: tsadsadathe1977
  author_email: lockfatantdis1976@gmail.com
  author_url: https://blogs.apache.org/openejb/entry/user_blog_openejb_3_1
  date: '2019-07-20 20:27:54 -0400'
  content: This style is incredible. Very unique! Awesome prints! Love it
- id: 6
  author: trusealccorti1980
  author_email: astravcana1980@gmail.com
  author_url: https://blogs.apache.org/couchdb/entry/apache_couchdb_1_2_0
  date: '2019-07-21 06:13:19 -0400'
  content: Fantastic !! Amazingly done!!
- id: 7
  author: google play redeem codes
  author_email: imvu20802@gmail.com
  author_url: http://gplaycodes.com/
  date: '2017-10-10 09:27:03 -0400'
  content: This is my views on the storing syslog events in base of the h.I am eager
    to get more information regarding it.
- id: 9
  author: vercsentioping1970
  author_email: erschonadov1970@gmail.com
  author_url: https://blogs.apache.org/geode/entry/welcome
  date: '2019-07-20 17:36:17 -0400'
  content: beautiful design! thank you
- id: 32
  author: cyberflix tv
  author_email: poraniii@gmail.com
  author_url: https://cyberflixtv.com
  date: '2018-11-28 12:55:24 -0500'
  content: Thanks for sharing this info
- id: 35
  author: usivtirigh1978
  author_email: nutreletac1985@gmail.com
  author_url: https://blogs.apache.org/logging/entry/apache_log4php_2_1_0
  date: '2019-07-21 00:36:21 -0400'
  content: Awesome characters, I really like your work☺️ nice shot!
- id: 63
  author: apbagsubstan1976
  author_email: conglicenca1972@gmail.com
  author_url: https://blogs.apache.org/logging/entry/welcome_remko_popma
  date: '2019-07-21 01:52:40 -0400'
  content: Not a single extra line. Perfect! Nice idea, and well executed series !
- id: 83
  author: salldeheartopc1983
  author_email: nesshynile1971@gmail.com
  author_url: https://blogs.apache.org/couchdb/entry/registration_is_open_for_couchdb
  date: '2019-07-21 06:46:35 -0400'
  content: Im a sucker for big type on royal blue def a trend lately works for postmates
    too. Awesome......!!!!
- id: 518
  author: ribacksohot1975
  author_email: ciakowsdustcyc1984@gmail.com
  author_url: https://blogs.apache.org/sdp/entry/apache_sentry_1_6_0
  date: '2019-07-21 11:07:11 -0400'
  content: wow. great concept Wow. Really cool designs. :)
- id: 824
  author: deddecktofi1976
  author_email: oxinenov1983@gmail.com
  author_url: https://blogs.apache.org/logging/entry/nick_williams_joined_the_apache
  date: '2019-07-21 09:27:53 -0400'
  content: Great work! Exquisite design!
- id: 9208
  author: coatemeslio1975
  author_email: layrentala1987@gmail.com
  author_url: https://blogs.apache.org/couchdb/entry/apache_couchdb_1_3_0
  date: '2019-07-21 03:31:09 -0400'
  content: I like this Magnificent!
- id: 9358
  author: Bruno Den
  author_email: brunoden@yopmail.com
  author_url: ''
  date: '2018-03-11 17:12:53 -0400'
  content: Really good format of coding, keep it up amazing stuff http://animaljamhack.club
- id: 57576
  author: pretexprosre1986
  author_email: landbacboti1983@gmail.com
  author_url: https://blogs.apache.org/openmeetings/entry/openmeetings_3_1_2_released
  date: '2019-07-21 10:34:36 -0400'
  content: Wow, these pics are amazing! This is easily one of the greatest detailed
    art projects for kids I&rsquo;ve ever seen. Take it from me, amd I&rsquo;ve illustrated
    detailed maps and posters like this. I got this for my grandkids and named it
    after Cecil, their dearly departed chihuahua, and signed by the rest of the grand
    Dogs! Can&rsquo;t wait to share it!
- id: 857456
  author: binrapiczio1988
  author_email: crazdangknotal1979@gmail.com
  author_url: https://blogs.apache.org/openejb/entry/screencast_ejb_unit_testing_with1
  date: '2019-07-20 18:03:14 -0400'
  content: Son espectaculares. Enhorabuena! creative, cool & elegant work ✌️✌️
- id: 6478393
  author: Sara Montero
  author_email: grayburton70027@gmail.com
  author_url: ''
  date: '2017-10-26 15:37:17 -0400'
  content: "I usually do this tasks with tcp, it's really good type of format. Check
    what i did with those tasks http://imvucreditshack.us\r\n\r\nYou are so awesome
    dudes."
permalink: nifi/entry/storing_syslog_events_in_hbase
---
<h1>Getting Syslog Events to HBase</h1>
<p>
   <span class="author">Bryan Bende -&nbsp;</span><br />
   <span class="author"><a href="mailto:bbende@gmail.com">bbende@gmail.com</a> -&nbsp;</span><br />
   <span class="author"><a href="https://twitter.com/BBende">@bbende</a></span></p>
<hr />
<p>
In the Apache NiFi 0.4.0 release there are several new integration points<br />
including processors for interacting with Syslog and HBase. In this post we'll<br />
demonstrate how to use NiFi to receive messages from Syslog over UDP,<br />
and store those messages in HBase.</p>
<p>
The flow described in this post was created using Apache NiFi 0.4.0,<br />
rsyslog 5.8.10, and Apache HBase 1.1.2.</p>
<h2>Setting up Syslog</h2>
<p>
In order for NiFi to receive syslog messages, rsyslog needs to forward messages<br />
to a port that NiFi will be listening on. Forwarding of messages can be<br />
configured in rsyslog.conf, generally located in /etc on most Linux operating<br />
systems.</p>
<p>
Edit rsyslog.conf and add the following line:</p>
<div>
<code></p>
<pre style="background-color: #f1f1f1">
*.* @localhost:7780
</pre>
<p></code>
</div></p>
<p>
This tells rsyslog to forward all messages over UDP to localhost port 7780.<br />
A double '@@' can be used to forward over TCP.</p>
<p>
Restart rsyslog for the changes to take effect:</p>
<div>
<code></p>
<pre style="background-color: #f1f1f1">
/etc/init.d/rsyslog restart
Shutting down system logger:                               [  OK  ]
Starting system logger:                                    [  OK  ]
</pre>
<p></code>
</div></p>
<h2>Setting up HBase</h2>
<p>
In order to store the syslog messages, we'll create an HBase table called<br />
'syslog' with one column family called 'msg'. From the command line enter the<br />
following:</p>
<div>
<code></p>
<pre style="background-color: #f1f1f1">
hbase shell
create 'syslog', {NAME => 'msg'}
</pre>
<p></code>
</div></p>
<h2>Configure an HBase Client Service</h2>
<p>
  The HBase processors added in Apache NiFi 0.4.0 use a controller service to<br />
  interact with HBase. This allows the processors to remain unchanged when the<br />
  HBase client changes, and allows a single NiFi instance to support multiple<br />
  versions of the HBase client. NiFi's class-loader isolation provided in NARs,<br />
  allows a single NiFi instance to interact with HBase instances of different<br />
  versions at the same time.</p>
<p>
  The HBase Client Service can be configured by providing paths to external<br />
  configuration files, such as hbase-site.xml, or by providing several<br />
  properties directly in the processor. For this example we will take the<br />
  latter approach. From the Controller Services configuration window in NiFi,<br />
  add an HBase_1_1_2_ClientService with the following configuration (adjusting<br />
  values appropriately for your system):</p>
<p>
<a href="https://blogs.apache.org/nifi/mediaresource/d3ea48a8-e8db-46c0-9f2b-0896ef37f493"><img src="https://blogs.apache.org/nifi/mediaresource/d3ea48a8-e8db-46c0-9f2b-0896ef37f493?" alt="client-service-config.jpg"></img></a></p>
<p>
  After configuring the service, enable it in order for it to be usable by<br />
  processors:</p>
<p>
<a href="https://blogs.apache.org/nifi/mediaresource/eddbfa7e-0032-48d9-bad7-21e37b7736fc"><img src="https://blogs.apache.org/nifi/mediaresource/eddbfa7e-0032-48d9-bad7-21e37b7736fc?" alt="client-service-enabled.jpg"></img></a></p>
<h2>Building the Dataflow</h2>
<p>
  The dataflow we are going build will consist of the following components:</p>
<ul>
<li><b>ListenSyslog</b> for receiving syslog messages over UDP</li>
<li><b>UpdateAttribute</b> for renaming attributes and creating a row id for HBase</li>
<li><b>AttributesToJSON</b> for creating a JSON document from the syslog attributes</li>
<li><b>PutHBaseJSON</b> for inserting each JSON document as a row in HBase</li>
</ul>
<p>
The overall flow looks like the following:</p>
<p>
<a href="https://blogs.apache.org/nifi/mediaresource/d4136c36-cea4-4e36-b072-f72944edbff3"><img src="https://blogs.apache.org/nifi/mediaresource/d4136c36-cea4-4e36-b072-f72944edbff3?" alt="syslog-hbase-flow.jpg"></img></a><br/><br />
Lets walk through the configuration of each processor...</p>
<h3>ListenSyslog</h3>
<p>
<a href="https://blogs.apache.org/nifi/mediaresource/e9f4b991-8c41-4c26-8b60-e8a7e6d4c7dc"><img src="https://blogs.apache.org/nifi/mediaresource/e9f4b991-8c41-4c26-8b60-e8a7e6d4c7dc?" alt="config-listensyslog.jpg"></img></a></p>
<p>
  Set the <i>Port</i> to the same port that rsyslog is forwarding messages to,<br />
  in this case 7780. Leave everything else as the default values.</p>
<p>
   With a <i>Max Batch Size</i> of "1" and <i>Parse Messages</i> as "true", each syslog<br />
   message will be emitted as a single FlowFile, with the content of the<br />
   FlowFile being the original message, and the results of parsing the message<br />
   being stored as FlowFile attributes.</p>
<p>
  The attributes we will be interested in are:</p>
<ul>
<li>syslog.priority</li>
<li>syslog.severity</li>
<li>syslog.facility</li>
<li>syslog.version</li>
<li>syslog.timestamp</li>
<li>syslog.hostname</li>
<li>syslog.sender</li>
<li>syslog.body</li>
<li>syslog.protocol</li>
<li>syslog.port</li>
</ul>
<h3>UpdateAttribute</h3>
<p>
<a href="https://blogs.apache.org/nifi/mediaresource/c04e59e3-a444-4fd5-9ad3-7518a9438a4f"><img src="https://blogs.apache.org/nifi/mediaresource/c04e59e3-a444-4fd5-9ad3-7518a9438a4f?" alt="config-updateattr.jpg"></img></a></p>
<p>
  The attributes produced by ListenSyslog all start with "syslog." which keeps<br />
  them nicely namespaced in NiFi. However, we are going to use these attribute<br />
  names as column qualifiers in HBase. We don't really need this prefix since<br />
  we will already be with in a syslog table.</p>
<p>
  Add a property for each syslog attribute to remove the prefix, and use the<br />
  <i>Delete Attributes Expression</i> to remove the original attributes. In addition,<br />
  create an <i>id</i> attribute of the form "timestamp_uuid" where timestamp is the<br />
  long representation of the timestamp on the syslog message, and uuid is the<br />
  uuid of the FlowFile in NiFi. This id attribute will be used as the row id in<br />
  HBase.</p>
<p>
  The expression language for the id attribute is:</p>
<div>
  <code></p>
<pre style="background-color: #f1f1f1">
${syslog.timestamp:toDate('MMM d HH:mm:ss'):toNumber()}_${uuid}
  </pre>
<p>  </code>
  </div></p>
<h3>AttributesToJSON</h3>
<p>
<a href="https://blogs.apache.org/nifi/mediaresource/e710ebb7-0289-4cb1-bc03-3a07121c2daf"><img src="https://blogs.apache.org/nifi/mediaresource/e710ebb7-0289-4cb1-bc03-3a07121c2daf" alt="config-attrstojson.jpg"></img></a></p>
<p>
  Set the <i>Destination</i> to "flowfile-content" so that the JSON document<br />
  replaces the FlowFile content, and set <i>Include Core Attributes</i> to<br />
  "false" so that the standard NiFi attributes are not included.</p>
<h3>PutHBaseJSON</h3>
<p>
<a href="https://blogs.apache.org/nifi/mediaresource/efcfdfcf-e4f1-4894-ad79-b1deed8c42f3"><img src="https://blogs.apache.org/nifi/mediaresource/efcfdfcf-e4f1-4894-ad79-b1deed8c42f3" alt="config-puthbasejson.jpg"></img></a></p>
<p>
  Select the <i>HBase Client Service</i> we configured earlier and set the<br />
  <i>Table Name</i> and <i>Column Family</i> to "syslog" and "msg" based on the<br />
  table we created earlier. In addition set the <i>Row Identifier Field Name</i><br />
  to "id" to instruct the processor to use the id field from the JSON for the<br />
  row id.</p>
<h2>Verifying the Flow</h2>
<p>
From a terminal we can send a test message to syslog using the logger utility:</p>
<div>
<code></p>
<pre style="background-color: #f1f1f1">
logger "this is a test syslog message"
</pre>
<p></code>
</div></p>
<p>
Using the HBase shell we can inspect the contents of the syslog table:</p>
<div>
<code></p>
<pre style="background-color: #f1f1f1">
hbase shell
hbase(main):002:0> scan 'syslog'
ROW                                          COLUMN+CELL
29704815000_84f91b21-d35f-4a24-8e0e-aaed4a521c13 column=msg:body, timestamp=1449775215481,
  value=root: this is a test message
29704815000_84f91b21-d35f-4a24-8e0e-aaed4a521c13 column=msg:hostname, timestamp=1449775215481,
  value=localhost
29704815000_84f91b21-d35f-4a24-8e0e-aaed4a521c13 column=msg:port, timestamp=1449775215481,
  value=7780
29704815000_84f91b21-d35f-4a24-8e0e-aaed4a521c13 column=msg:protocol, timestamp=1449775215481,
  value=UDP
29704815000_84f91b21-d35f-4a24-8e0e-aaed4a521c13 column=msg:sender, timestamp=1449775215481,
  value=/127.0.0.1
29704815000_84f91b21-d35f-4a24-8e0e-aaed4a521c13 column=msg:timestamp, timestamp=1449775215481,
  value=Dec 10 19:20:15
29704815000_84f91b21-d35f-4a24-8e0e-aaed4a521c13 column=msg:version, timestamp=1449775215481,
  value=
1 row(s) in 0.1120 seconds
</pre>
<p></code>
</div></p>
<h2>Performance Considerations</h2>
<p>
  In some cases the volume of syslog messages being pushed to ListenSyslog may<br />
  be very high. There are several options to help scale the processing<br />
  depending on the given use-case.</p>
<h4>Concurrent Tasks</h4>
<p>
  ListenSyslog has a background thread reading messages as fast<br />
  as possible and placing them on a blocking queue to be de-queued and processed<br />
  by the onTrigger method of the processor. By increasing the number of<br />
  concurrent tasks for the processor, we can scale up the rate at which messages<br />
  are processed, ensuring new messages can continue to be queued.</p>
<h4>Parsing</h4>
<p>
  One of the more expensive operations during the processing of a message is<br />
  parsing the message in order to provide the the attributes. Parsing messages<br />
  is controlled on the processor through a property and can be turned off in<br />
  cases where the attributes are not needed, and the original message just<br />
  needs to be delivered somewhere.</p>
<h4>Batching</h4>
<p>
  In cases where parsing the messages is not necessary, an additional option is<br />
  batching many messages together during one call to onTrigger. This is<br />
  controlled through the <i>Batch Size</i> property which defaults to "1". This<br />
  would be appropriate in cases where having individual  messages is not<br />
  necessary, such as storing the messages in HDFS where you need them batched<br />
  into appropriately sized files.</p>
<h4>ParseSyslog</h4>
<p>
  In addition to parsing messages directly in ListenSyslog, there is also a<br />
  ParseSyslog processor. An alternative to the flow described in the post<br />
  would be to have ListenSyslog produce batches of 100 messages at a time,<br />
  followed by SplitText, followed by ParseSyslog. The tradeoff here is that<br />
  we can scale the different components independently, and take advantage of<br />
  backpressure between processors.</p>
<h2>Summary</h2>
<p>
  At this point you should be able to get your syslog messages ingested into<br />
  HBase and can experiment with different configurations. The template for this flow can be found<br />
<a href="https://cwiki.apache.org/confluence/download/attachments/57904847/Syslog_HBase.xml?version=1&modificationDate=1449776959701&api=v2">here</a>.</p>
<p>
  We would love to hear any questions, comments, or feedback that you may have!</p>
<p>
  <a href="http://nifi.apache.org">Learn more about Apache NiFi</a> and feel<br />
  free to leave comments here or e-mail us at dev@nifi.apache.org.</p>
