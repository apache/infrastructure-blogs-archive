---
layout: post
status: PUBLISHED
published: true
title: OLAP with Apache Phoenix and HBase
author:
  display_name: James Taylor
  login: jamestaylor
  email: jamestaylor@apache.org
author_login: jamestaylor
author_email: jamestaylor@apache.org
id: 2fe081ae-0512-4b2d-aa01-a3c6fc70221e
date: '2014-05-28 07:28:43 -0400'
categories:
- General
tags:
- apache
- data
- phoenix
- big
- olap
- hbase
- sql
comments:
- id: 0
  author: Luis G&oacute;mez
  author_email: ''
  author_url: ''
  date: '2015-04-23 12:31:52 -0400'
  content: Very goog post
- id: 2
  author: Boris
  author_email: boris@treukhov.com
  author_url: ''
  date: '2016-02-16 19:10:56 -0500'
  content: "I have created a 60 millions items fact table \"account_transaction\",
    \ and a time dimension \"DAYS\" with 365 items.\r\n\r\n\r\nSo I want to display
    total \"AMOUNT\" per day,\r\nMondrian generates following query\r\n\r\nselect
    \"DAYS\".\"DATE\" as \"c0\", sum(\"account_transactions\".\"AMOUNT\") as \"m0\"
    from \"DAYS\" as \"DAYS\", \"account_transactions\" as \"account_transactions\"
    where \"account_transactions\".\"DATE\" = \"DAYS\".\"DATE\" group by \"DAYS\".\"DATE\";\r\n\r\nAs
    result phoenix tries to suck up entire 60 M table into memory and throws Size
    of hash cache (104857627 bytes) exceeds the maximum allowed size (104857600 bytes)
    exception .\r\n\r\nIf only Mondrian used  another table order i.e. \"account_transactions\"
    as \"account_transactions, \"m0\" from \"DAYS\" as \"DAYS\" then it would work.\r\n\r\n
    So query planning is just atrocious, it just takes whatever table is first hence
    this product is definitely not ready to production.\r\n\r\n"
permalink: phoenix/entry/olap_with_apache_phoenix_and
---
<p><em><br />
Today's blog is brought to you by <strong>Juan Rodr&iacute;guez Hortal&aacute; </strong>of <a href="http://lambdoop.com/"><span style="font-size: 15px; font-family: Arial; color: #1155cc; text-decoration: underline; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">LAMBDOOP</span></a></em> </p>
<p><span id="docs-internal-guid-763736e9-4185-4689-7710-54a2192094b7"> </p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">One of the benefits of having a SQL query interface for a database is that SQL has become a lingua franca that is used as the basis for the interoperability of many systems. One example of that are visualization tools, that usually accept SQL connections as data sources. In this post we'll see how to use Apache Phoenix as a bridge between HBase and </span><a href="http://meteorite.bi/saiku"><span style="font-size: 15px; font-family: Arial; color: #1155cc; text-decoration: underline; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">Saiku Analytics</span></a><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">, a visualization tool for Business Intelligence. </span></p>
<p> </p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">Saiku is an open source visualization tool for Online Analytical Processing (</span><a href="http://en.wikipedia.org/wiki/Online_analytical_processing"><span style="font-size: 15px; font-family: Arial; color: #1155cc; text-decoration: underline; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">OLAP</span></a><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">) that consists in modeling a given business process as a set of facts corresponding to business transactions, that contain measures of quantities relevant for the business, and which are categorized by several dimensions that describe the context of the transaction. </span></p>
<p> </p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 15px; font-family: Arial; font-style: italic; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">For example if we want to analyze the traffic of a website then we might define a measure ACTIVE_VISITOR for the number of visitors and put it into context by considering the date of the visit (DATE dimension), or the part of the site which was visited (FEATURE dimension). </span></p>
<p><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">Facts and dimensions are collected into a logical (and sometimes also physical) structure called </span><a href="http://en.wikipedia.org/wiki/OLAP_cube"><span style="font-size: 15px; font-family: Arial; color: #1155cc; text-decoration: underline; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">OLAP cube</span></a><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">, which can be thought as a multidimensional array indexed by the dimensions and with the measures as values. OLAP cubes are queried using </span><a href="http://en.wikipedia.org/wiki/Multidimensional_Expressions"><span style="font-size: 15px; font-family: Arial; color: #1155cc; text-decoration: underline; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">MultiDimensional eXpressions (MDX)</span></a><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">, a query language for specifying selections and aggregations in a natural way over the multidimensional structure of a cube. And here comes Saiku! Saiku is an OLAP front-end for visualizing the results of MDX queries, both in tabular format or as different types of charts, and that also offers a drag and drop interface for generating MDX queries.</span></p>
<p></span><span id="docs-internal-guid-763736e9-4186-3bf8-8e7d-9d785a1a32bc"> </p>
<p><img width="550" height="425" src="http://phoenix.incubator.apache.org/images/1_Saiku_drag_and_drop_query.png" /></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">Saiku accepts several </span><a href="http://docs.analytical-labs.com/saiku/documentation/configuration/2013/08/15/datasources.html"><span style="font-size: 15px; font-family: Arial; color: #1155cc; text-decoration: underline; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">data sources</span></a><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">, and in particular it is able to use the </span><a href="http://community.pentaho.com/projects/mondrian/"><span style="font-size: 15px; font-family: Arial; color: #1155cc; text-decoration: underline; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">Mondrian</span></a><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"> server to implement </span><a href="http://en.wikipedia.org/wiki/ROLAP"><span style="font-size: 15px; font-family: Arial; color: #1155cc; text-decoration: underline; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">ROLAP</span></a><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">, which is a popular technique for OLAP that uses a relational database to store and compute the cubes. Did I say relational? Well, in fact all that Mondrian needs is a JDBC driver ... And this leads us to this post, where I'll share my experiences combining Phoenix with Mondrian to use HBase as the analytical database in the backend of an OLAP system with Saiku as the front-end. As there are a few layers in this setting, let's describe the flow of a query in this system before entering into more details:</span></p>
<ol style="margin-top: 0pt; margin-bottom: 0pt;">
<li dir="ltr" style="list-style-type: decimal; font-family: 'Times New Roman'; vertical-align: baseline; margin-left: 24px; background-color: transparent;">
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">Saiku uses an schema file provided during configuration that contains the declarations of some OLAP cubes, and displays the dimensions and measures of the cubes to the user.</span></p>
</li>
<li dir="ltr" style="list-style-type: decimal; font-family: 'Times New Roman'; vertical-align: baseline; margin-left: 24px; background-color: transparent;">
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">The user selects a cube and builds a query using Saiku&rsquo;s drag and drop interface over the cube.</span></p>
</li>
<li dir="ltr" style="list-style-type: decimal; font-family: 'Times New Roman'; vertical-align: baseline; margin-left: 24px; background-color: transparent;">
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">Saiku generates an MDX expression and passes it to Mondrian for execution.</span></p>
</li>
<li dir="ltr" style="list-style-type: decimal; font-family: 'Times New Roman'; vertical-align: baseline; margin-left: 24px; background-color: transparent;">
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">Mondrian compiles the MDX expression into an SQL query, and then uses Phoenix JDBC to execute it.</span></p>
</li>
<li dir="ltr" style="list-style-type: decimal; font-family: 'Times New Roman'; vertical-align: baseline; margin-left: 24px; background-color: transparent;">
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">HBase executes the query and then gives the results back to Phoenix.</span></p>
</li>
<li dir="ltr" style="list-style-type: decimal; font-family: 'Times New Roman'; vertical-align: baseline; margin-left: 24px; background-color: transparent;">
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">Phoenix passes the results to Mondrian, which passes them to Saiku, which then renders the results as a table in the user interface. &nbsp;</span></p>
</li>
</ol>
<p> </p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 15px; font-family: Arial; font-weight: bold; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">Setup and example</span></p>
<p></span> </p>
<p><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">We&rsquo;ll see how to setup Saiku to work with Phoenix with a simple example. This procedure has been tested in a Cloudera Quickstart VM for CDH 4.4.0, which is shipped with HBase 0.94.6, therefore we&rsquo;ll be using Phoenix 3. First of all we have to </span><a href="http://www.apache.org/dyn/closer.cgi/incubator/phoenix/"><span style="font-size: 15px; font-family: Arial; color: #1155cc; text-decoration: underline; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">download phoenix 3</span></a><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"> and install it by copying phoenix-core-*.jar in the classpath of each region server (for example at /usr/lib/hbase/lib/) and then restarting them. Regarding Saiku, it can be installed as a Pentaho BA Server plugin, or as a stand alone application as we'll do in this tutorial. To do that just download </span><a href="http://meteorite.bi/saiku/download"><span style="font-size: 15px; font-family: Arial; color: #1155cc; text-decoration: underline; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">Saiku Server 2.5</span></a><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"> (including Foodmart DB) and extract the compressed file, which contains a Tomcat distribution with Saiku installed as a webapp. To start and stop Saiku use the scripts </span><span style="font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">start-saiku.sh</span><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"> and </span><span style="font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">stop-saiku.sh</span><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">. By default Saiku runs at port 8080 and uses &lsquo;admin&rsquo; as both user and password for the login page. After login you should see be able to select one of the cubes of the Foodmart DB at the combo at the upper left corner of the UI.</span></p>
<p><img width="550" height="425" src="http://phoenix.incubator.apache.org/images/2_Saiku_select_cube.png" /></p>
<p><span style="font-size: 15px;"></span><span id="docs-internal-guid-763736e9-41a7-dff7-da6b-2e0d894ad340"><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">Now it&rsquo;s time to connect Saiku to Phoenix. The first step is defining the structure of the OLAP cube we are going to analyze. In the example above we considered analyzing the traffic of a website by measuring quantities like the number of visitors along dimensions like the date of the visit or the part of the site that was visited. This happens to correspond to the structure of the </span><span style="font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">PERFORMANCE </span><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">tables created by the script </span><span style="font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">bin/performance.py</span><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"> shipped with Phoenix. So let&rsquo;s run the command </span><span style="font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">bin/performance.py localhost 100000</span><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"> so a table </span><span style="font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">PERFORMANCE_100000 </span><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">with 100.000 rows with the following schema is created:</span></span></p>
<p><span id="docs-internal-guid-763736e9-4186-9f29-f6db-05e752925b23"> </p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">CREATE TABLE IF NOT EXISTS PERFORMANCE_100000 (</span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"> &nbsp;&nbsp;&nbsp;HOST CHAR(2) NOT NULL, DOMAIN VARCHAR NOT NULL, </span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"> &nbsp;&nbsp;&nbsp;FEATURE VARCHAR NOT NULL, DATE DATE NOT NULL,</span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"> &nbsp;&nbsp;&nbsp;USAGE.CORE BIGINT, USAGE.DB BIGINT, STATS.ACTIVE_VISITOR INTEGER </span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"> &nbsp;CONSTRAINT PK PRIMARY KEY (HOST, DOMAIN, FEATURE, DATE)</span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">) SPLIT ON ('CSGoogle','CSSalesforce','EUApple','EUGoogle',</span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt; margin-left: 36pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"> &nbsp;&nbsp;&nbsp;&nbsp;'EUSalesforce', 'NAApple','NAGoogle','NASalesforce');</span></p>
<p> </p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">In this table the 4 columns that compose the primary key correspond to the dimensions of the cube, while the other 3 columns are the quantities to be measured. That is a fact table with with 4 degenerate dimensions (see e.g. </span><a href="http://books.google.es/books/about/Star_Schema_The_Complete_Reference.html?id=jMAFcuyVSt0C"><span style="font-size: 15px; font-family: Arial; color: #1155cc; text-decoration: underline; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">Star Schema The Complete Reference</span></a><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"> for more details about dimensional modeling), that represents and OLAP cube. Nevertheless there is a problem with this cube: the granularity for the time dimension it&rsquo;s too fine, as we can see in the following query.</span></p>
<p> </p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">0: jdbc:phoenix:localhost> SELECT TO_CHAR(DATE) FROM PERFORMANCE_1000000 LIMIT 5;</span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">+---------------+</span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">| TO_CHAR(DATE) |</span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">+---------------+</span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">| 2014-05-15 09:47:42 |</span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">| 2014-05-15 09:47:50 |</span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">| 2014-05-15 09:49:09 |</span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">| 2014-05-15 09:49:23 |</span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">| 2014-05-15 09:49:44 |</span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">+---------------+</span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">5 rows selected (0.161 seconds)</span></p>
<p> </p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span id="docs-internal-guid-763736e9-41a8-6547-ebca-7266e8e46487"><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">We have a resolution of seconds in the </span><span style="font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">DATE </span><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">column, so if we grouped values by date we would end up with a group per record, hence this dimensions is useless. To fix this we just have to add a new column with a coarser granularity, for example of days. To do that we can use the following script, that should be invoked as </span><span style="font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">bash proc_performance_table.sh
<path to phoenix bin directory> PERFORMANCE_100000</span><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">.</span></span></p>
<p> </p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">#!/bin/bash</span></p>
<p> </p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">if [ $# -ne 2 ]</span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">then</span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"><span class="Apple-tab-span" style="white-space: pre;"> </span></span><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">echo "Usage: $0
<phoenix bin directory>
<table name>"</span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"><span class="Apple-tab-span" style="white-space: pre;"> </span></span><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">exit 1</span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">fi</span></p>
<p> </p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">PHOENIX_BIN_DIR=$1</span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">IN_TABLE=$2</span></p>
<p> </p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">OUT_TABLE="${IN_TABLE}_PROC"</span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">echo "Table $OUT_TABLE will be created"</span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">pushd $PHOENIX_BIN_DIR</span></p>
<p> </p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">./sqlline.py localhost <<END</span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">CREATE TABLE IF NOT EXISTS $OUT_TABLE (</span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"><span class="Apple-tab-span" style="white-space: pre;"> </span></span><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">HOST CHAR(2) NOT NULL,</span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"><span class="Apple-tab-span" style="white-space: pre;"> </span></span><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">DOMAIN VARCHAR NOT NULL,</span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"><span class="Apple-tab-span" style="white-space: pre;"> </span></span><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">FEATURE VARCHAR NOT NULL,</span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"><span class="Apple-tab-span" style="white-space: pre;"> </span></span><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">DATE DATE NOT NULL,</span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"><span class="Apple-tab-span" style="white-space: pre;"> </span></span><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">DATE_DAY DATE NOT NULL,</span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"><span class="Apple-tab-span" style="white-space: pre;"> </span></span><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">USAGE.CORE BIGINT,</span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"><span class="Apple-tab-span" style="white-space: pre;"> </span></span><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">USAGE.DB BIGINT,</span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"><span class="Apple-tab-span" style="white-space: pre;"> </span></span><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">STATS.ACTIVE_VISITOR INTEGER</span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"><span class="Apple-tab-span" style="white-space: pre;"> </span></span><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">CONSTRAINT PK PRIMARY KEY (HOST, DOMAIN, FEATURE, DATE))</span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">SPLIT ON</span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">('CSGoogle','CSSalesforce','EUApple','EUGoogle','EUSalesforce', 'NAApple','NAGoogle','NASalesforce');</span></p>
<p> </p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">!autocommit on</span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">UPSERT INTO $OUT_TABLE</span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">SELECT HOST, DOMAIN, FEATURE, DATE,</span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"><span class="Apple-tab-span" style="white-space: pre;"> </span></span><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">TRUNC(DATE, 'DAY') as DATE_DAY,</span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"><span class="Apple-tab-span" style="white-space: pre;"> </span></span><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">USAGE.CORE, USAGE.DB, STATS.ACTIVE_VISITOR</span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">FROM $IN_TABLE;</span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">!quit</span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">END</span></p>
<p> </p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">echo "Done"</span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">popd</span></p>
<p> </p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">That creates a new table </span><span style="font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">PERFORMANCE_100000_PROC</span><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"> with an extra column </span><span style="font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">DATE_DAY</span><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"> </span><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">for the date with a resolution of days. We&rsquo;ll perform the analysis over this table. The next step is creating a Mondrian schema that maps an OLAP cube to this table, for Mondrian to know which column to use as a dimension, and how to define the measures. Create a file </span><span style="font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">Phoenix.xml </span><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">with the following contents:</span></p>
<p> </p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"><?xml version="1.0"?></span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"><Schema name="Phoenix"></span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"> <Cube name="PERFORMANCE_100000_PROC"></span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"><span class="Apple-tab-span" style="white-space: pre;"> </span> </span><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"><Table name="PERFORMANCE_100000_PROC"/></span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"><span class="Apple-tab-span" style="white-space: pre;"> </span> </span><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"><Dimension name="HOST"></span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"> </span><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"><span class="Apple-tab-span" style="white-space: pre;"> </span></span><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"> &nbsp;<Hierarchy hasAll="true" allMemberName="All Types"></span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"> </span><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"><span class="Apple-tab-span" style="white-space: pre;"> </span></span><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"> &nbsp;&nbsp;&nbsp;<Level name="HOST" column="HOST" uniqueMembers="false"/></span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"> </span><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"><span class="Apple-tab-span" style="white-space: pre;"> </span></span><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"> &nbsp;</Hierarchy></span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"><span class="Apple-tab-span" style="white-space: pre;"> </span> </span><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"></Dimension></span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"><span class="Apple-tab-span" style="white-space: pre;"> </span> </span><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"><Dimension name="DOMAIN"></span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"> </span><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"><span class="Apple-tab-span" style="white-space: pre;"> </span></span><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"> &nbsp;<Hierarchy hasAll="true" allMemberName="All Types"></span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"> </span><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"><span class="Apple-tab-span" style="white-space: pre;"> </span></span><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"> &nbsp;&nbsp;&nbsp;<Level name="DOMAIN" column="DOMAIN" uniqueMembers="false"/></span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"> </span><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"><span class="Apple-tab-span" style="white-space: pre;"> </span></span><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"> &nbsp;</Hierarchy></span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"><span class="Apple-tab-span" style="white-space: pre;"> </span> </span><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"></Dimension></span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"><span class="Apple-tab-span" style="white-space: pre;"> </span> </span><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"><Dimension name="FEATURE"></span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"> </span><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"><span class="Apple-tab-span" style="white-space: pre;"> </span></span><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"> &nbsp;<Hierarchy hasAll="true" allMemberName="All Types"></span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"> </span><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"><span class="Apple-tab-span" style="white-space: pre;"> </span></span><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"> &nbsp;&nbsp;&nbsp;<Level name="FEATURE" column="FEATURE" uniqueMembers="false"/></span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"> </span><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"><span class="Apple-tab-span" style="white-space: pre;"> </span></span><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"> &nbsp;</Hierarchy></span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"><span class="Apple-tab-span" style="white-space: pre;"> </span> </span><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"></Dimension></span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"><span class="Apple-tab-span" style="white-space: pre;"> </span> </span><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"><Dimension name="DATE"></span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"> </span><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"><span class="Apple-tab-span" style="white-space: pre;"> </span></span><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"> &nbsp;<Hierarchy hasAll="true" allMemberName="All Types"></span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"> </span><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"><span class="Apple-tab-span" style="white-space: pre;"> </span></span><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"> &nbsp;&nbsp;&nbsp;<Level name="DAY" column="DATE_DAY" uniqueMembers="false"/></span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"> </span><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"><span class="Apple-tab-span" style="white-space: pre;"> </span></span><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"> &nbsp;</Hierarchy></span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"><span class="Apple-tab-span" style="white-space: pre;"> </span> </span><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"></Dimension></span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"><span class="Apple-tab-span" style="white-space: pre;"> </span> </span><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"><Measure name="CORE" column="CORE" aggregator="sum" formatString="Standard"/></span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"><span class="Apple-tab-span" style="white-space: pre;"> </span> </span><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"><Measure name="DB" column="DB" aggregator="sum" formatString="Standard"/></span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"><span class="Apple-tab-span" style="white-space: pre;"> </span> </span><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"><Measure name="ACTIVE_VISITOR" column="ACTIVE_VISITOR" aggregator="sum" formatString="Standard"/></span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"> </Cube></span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"></Schema></span></p>
<p> </p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">There we have declared an schema &ldquo;</span><span style="font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">Phoenix</span><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">&rdquo; containing a single cube &ldquo;</span><span style="font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">PERFORMANCE_100000_PROC</span><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">&rdquo; defined over the table &ldquo;</span><span style="font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">PERFORMANCE_100000_PROC</span><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">&rdquo;. This cube has 4 dimensions with a single level, that corresponds to the columns </span><span style="font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">HOST</span><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">, </span><span style="font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">DOMAIN</span><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">, </span><span style="font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">FEATURE </span><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">and </span><span style="font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">DATE_DAY</span><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">, and 3 metrics that are computed adding the values in the groups determined by the dimensions, over the columns &nbsp;</span><span style="font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">CORE</span><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">, </span><span style="font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">DB </span><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">and </span><span style="font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">ACTIVE_VISITOR</span><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">. As we can see in </span><span style="font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">tomcat/webapps/saiku/WEB-INF/lib/mondrian-3.5.7.jar</span><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">, this version of &nbsp;Saiku (2.5) uses Mondrian 3, so take a look at the </span><a href="http://mondrian.pentaho.com/documentation/schema.php"><span style="font-size: 15px; font-family: Arial; color: #1155cc; text-decoration: underline; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">Mondrian 3 documentation</span></a><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"> or to </span><a href="http://www.manning.com/back/"><span style="font-size: 15px; font-family: Arial; color: #1155cc; text-decoration: underline; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">Mondrian in Action</span></a><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"> for more information about Mondrian schemas if you are interested. </span></p>
<p><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">Now we have to create a new Saiku data source that uses this schema, by creating a file </span><span style="line-height: 1.15; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"><saiku install directory>/tomcat/webapps/saiku/WEB-INF/classes/saiku-datasources/phoenix</span><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"> with the following contents:</span></p>
<p> </p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">type=OLAP</span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">name=phoenix</span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">driver=mondrian.olap4j.MondrianOlap4jDriver</span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">location=jdbc:mondrian:Jdbc=jdbc:phoenix:localhost;Catalog=res:phoenix/Phoenix.xml;JdbcDrivers=org.apache.phoenix.jdbc.PhoenixDriver</span></p>
<p> </p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">That declares an OLAP connection named phoenix that uses Mondrian as the driver, and Phoenix as JDBC. We just need to do a couple more things for this to work:</span></p>
<p> </p>
<ul style="margin-top: 0pt; margin-bottom: 0pt;">
<li dir="ltr" style="list-style-type: disc; font-family: 'Times New Roman'; vertical-align: baseline; margin-left: 24px; background-color: transparent;">
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">Add the jars for Phoenix, HBase and Hadoop to Saiku&rsquo;s classpath, by copying </span><span style="font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">phoenix-*client-without-hbase.jar</span><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">,</span><span style="font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"> /usr/lib/hbase/hbase.jar</span><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">, </span><span style="font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">/usr/lib/hadoop/hadoop-common.jar</span><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"> and </span><span style="font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">/usr/lib/hadoop/hadoop-auth.jar</span><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"> into &nbsp;</span><span style="font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"><saiku install directory>/tomcat/lib</span><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">.</span></p>
</li>
<li dir="ltr" style="list-style-type: disc; font-family: 'Times New Roman'; vertical-align: baseline; margin-left: 24px; background-color: transparent;">
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">Create a directory </span><span style="font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"><saiku install directory>/tomcat/webapps/saiku/WEB-INF/classes/phoenix</span><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"> and copy the mapping file </span><span style="font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">Phoenix.xml</span><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"> into it.</span></p>
</li>
</ul>
<p><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">Now restart Saiku and the new cube should appear. I suggest watching </span><span style="font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">tomcat/logs/catalina.out</span><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"> and </span><span style="font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">tomcat/logs/saiku.log</span><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"> at the Saiku install path for possible errors and other information.</span></p>
<p></span><span id="docs-internal-guid-763736e9-4186-e7b8-b321-e7eea4151f29"> </p>
<p><img width="550" height="425" src="http://phoenix.incubator.apache.org/images/3_Saiku_performance_100000_cube.png" /></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">If we take a look to </span><span style="font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">saiku.log</span><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"> we can see the MDX query generated by Saiku, and the running time for the query in HBase. These execution times are for a Cloudera Quickstart VM running on VMware Player with 4448 MB RAM and 4 cores, in a laptop with an i7 processor and 8 GB RAM, and with default settings for HBase, Phoenix and Saiku.</span></p>
<p> </p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">2014-05-18 09:20:58,225 DEBUG [org.saiku.web.rest.resources.QueryResource] TRACK &nbsp;&nbsp;</span><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"><span class="Apple-tab-span" style="white-space: pre;"> </span></span><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;"> /query/CC92DB19-D97E-E68D-B927-E6259DB6BF70/resultflattened &nbsp;&nbsp;&nbsp;GET</span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">2014-05-18 09:20:58,226 INFO &nbsp;[org.saiku.service.olap.OlapQueryService] runId:2 &nbsp;&nbsp;&nbsp;Type:QM:</span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">SELECT</span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">NON EMPTY {[Measures].[CORE], [Measures].[DB], [Measures].[ACTIVE_VISITOR]} ON COLUMNS,</span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">NON EMPTY CrossJoin([DATE].[DAY].Members, CrossJoin([DOMAIN].[DOMAIN].Members, CrossJoin([FEATURE].[FEATURE].Members, [HOST].[HOST].Members))) ON ROWS</span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">FROM [PERFORMANCE_100000_PROC]</span></p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 12px; font-family: Consolas; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">2014-05-18 09:20:59,220 INFO &nbsp;[org.saiku.service.olap.OlapQueryService] runId:2 &nbsp;&nbsp;&nbsp;Size: 7/55 &nbsp;&nbsp;&nbsp;Execute: &nbsp;&nbsp;&nbsp;970ms &nbsp;&nbsp;&nbsp;Format: &nbsp;&nbsp;&nbsp;24ms &nbsp;&nbsp;&nbsp;&nbsp;Total: 994ms</span></p>
<p> </p>
<p dir="ltr" style="line-height: 1.15; margin-top: 0pt; margin-bottom: 0pt;"><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">The same query for a performance table of 1 million records is completed in an order of 8 to 18 seconds in the same setting.</span></p>
<p><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">That's all! The next natural step would be defining a richer star schema with independent dimension tables, and testing the limits of </span><a href="http://phoenix.incubator.apache.org/joins.html"><span style="font-size: 15px; font-family: Arial; color: #1155cc; text-decoration: underline; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">Phoenix's star-join optimization</span></a><span style="font-size: 15px; font-family: Arial; vertical-align: baseline; white-space: pre-wrap; background-color: transparent;">. I hope this post has encouraged you to try it yourself.</span></p>
<p></span> </p>
<table name="PERFORMANCE_100000_PROC"> </table></p>
