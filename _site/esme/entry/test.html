<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>LDAP-based Authentication with Apache ESME and Apache Directory Server | Blogs Archive</title>
<meta name="generator" content="Jekyll v3.9.3" />
<meta property="og:title" content="LDAP-based Authentication with Apache ESME and Apache Directory Server" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="This blog was written by our new committer&nbsp;Vladimir Ivanov&nbsp;who implemented a feature that users have been wanting for a long time.&nbsp; In this blog, I&#39;ll discuss how container-managed authentication works with an LDAP server and how to connect and get additional information from it. I&#39;ll use Jetty and Apache Tomcat web servers with Apache Directory Server (ADS) 1.5.7 - a certified LDAPv3 compatible server. It is also possible to use different LDAP compatible server such as a 389 Directory Server or MS Active Directory. An LDAP server is a directory service that contains objects organized in a hierarchical manner. Apache Directory Server (ADS) The ADS project page provides a detailed server installation and configuration guide, but here are the basic steps: during the installation, the default server instance will be created. The configuration settings for this instance are defined in the server.xml file as Spring bean definitions. Below is an excerpt from the configuration file that was used for this blog. server.xml First of all, it is necessary to create a new partition: ... &lt;/span&gt;&lt;/p&gt; ... &lt;jdbmPartition id=&quot;lester&quot; suffix=&quot;dc=lester,dc=org&quot; /&gt; &lt;/partitions&gt; &lt;/blockquote&gt; Ports that LDAP server will use are specified as tcpTransport elements: &lt;ldapServer id=&quot;ldapServer&quot; &lt;/p&gt; allowAnonymousAccess=&quot;false&quot; saslHost=&quot;ldap.example.com&quot; saslPrincipal=&quot;ldap/ldap.example.com@EXAMPLE.COM&quot; searchBaseDn=&quot;ou=users,ou=system&quot; maxTimeLimit=&quot;15000&quot; maxSizeLimit=&quot;1000&quot;&gt; &lt;/span&gt;&lt;/p&gt; &lt;tcpTransport address=&quot;0.0.0.0&quot; port=&quot;10389&quot; nbThreads=&quot;8&quot; backLog=&quot;50&quot; enableSSL=&quot;false&quot;/&gt; &lt;tcpTransport address=&quot;localhost&quot; port=&quot;10636&quot; enableSSL=&quot;true&quot;/&gt; &lt;/transports&gt; &lt;/ldapServer&gt; &lt;/font&gt; &lt;/p&gt; &lt;/blockquote&gt; The local path to the directory containing LDIF files should also be specified: &lt;apacheDS id=&quot;apacheDS&quot;&gt; &lt;/p&gt; #ldapServer PATH_TO_ADS_INSTALL_DIR/instances/default/ldif &lt;/apacheDS&gt;&nbsp; &lt;/font&gt; &lt;/blockquote&gt; Other configuration settings were left unchanged. Now It is time to create the directory structure. I used the popular open source tool JXplorer for this task. It is possible to export the directory structure from the JXplorer tool to the LDIF file &mdash; directory content in text format. Let&#39;s review the generated file. lester.ldif Below is a record list beginning from the top. Note that each record has specific set of object classes defined in this schema. Each object class defines specific set of attributes, for example, person class defines Surname (sn) and Given Name (givenName) attributes. One object class can extend another, for example organizationalPerson class extends person class. top is a superclass for all other classes. Domain lester.org is the root of this hierarchy: dn: dc=lester,dc=org objectClass: extensibleObject objectClass: domain objectClass: top dc: lester The Organizational Unit esme is placed one level lower: dn: ou=esme,dc=lester,dc=org objectClass: organizationalUnit objectClass: top ou: esme The Organizational Unit Groups resides under the esme Organizational Unit: dn: ou=Groups,ou=esme,dc=lester,dc=org objectClass: organizationalUnit objectClass: top ou: Groups There is only one group esme-users on the lowest level of the hierarchy and it has the vivanov user (specified by a full path) as a unique member: dn: cn=esme-users,ou=Groups,ou=esme,dc=lester,dc=org objectClass: groupOfUniqueNames objectClass: top cn: esme-users ou: Groups uniqueMember: uid=vivanov,ou=Users,ou=esme,dc=lester,dc=org The Organizational Unit Users resides under the esme organizational unit: dn: ou=Users,ou=esme,dc=lester,dc=org objectClass: organizationalUnit objectClass: top ou: Users The user vivanov and its corresponding attributes are defined on the lowest level of the hierarchy: dn: uid=vivanov,ou=Users,ou=esme,dc=lester,dc=org objectClass: organizationalPerson objectClass: person objectClass: uidObject objectClass: inetOrgPerson objectClass: top cn: vivanov givenName: Vladimir mail: vivanov@lester.org ou: Users sn: Ivanov telephoneNumber: +7 111 222 33 44 uid: vivanov userPassword:: cXdlcnR5 There is also a special user with administrative rights: uid=admin,ou=system (default password: secret) defined in system schema. It was used to connect to ADS from JXplorer. Those were all basic steps necessary to configure ADS for purpose of this b log. Let&#39;s move to the configuration of the web servers. Configuration Before digging into the configuration details specific for each web server, let&#39;s review the common properties used to connect to the LDAP server. First of all, it is necessary to specify the hostname / ip address and the port of our LDAP server &mdash; localhost:10389, as well as the credentials for an account that has rights to perform search operation and get attributes for users and roles in a directory tree. The special admin user described in previous section was also used for this purpose in this blog. Sometimes anonymous access is also permitted. The next set of properties, user base and group base, specify the base context with which to lookup users and groups. For our configuration web server will search users under ou=Users,ou=esme,dc=lester,dc=org and groups under ou=Groups,ou=esme,dc=lester,dc=org paths in the directory tree accordingly. The user id and role name attributes specify the prefix for user/group search filter. In our example, it has the uid value for users and the cn value for groups. The uniqueMember attribute is used to check whether the user belongs to the specified group. Now it is time to review the configuration for each of the web servers. Note: The required lift-ldap dependency has been already included in pom.xml. Jetty In order to configure Jetty to use LDAP server, two additional Maven dependencies: jetty-plus and jetty-ldap-jaas should be added to the pom.xml file. Configuration of maven-jetty-plugin includes the following steps: set the JAASUserRealm as an user realm implementation and specify the ldaploginmodule as the login module name. It is also necessary to set the system property java.security.auth.login.config with the ldap-loginModule.conf value: pom.xml &lt;/span&gt;&lt;/p&gt; org.mortbay.jetty jetty-plus [6.1.6,) compile &lt;/dependency&gt; &lt;/span&gt;&lt;/p&gt; org.mortbay.jetty jetty-ldap-jaas [6.1.6,) compile &lt;/dependency&gt; &lt;/span&gt;&lt;/p&gt; org.mortbay.jetty maven-jetty-plugin &lt;/span&gt;&lt;/p&gt; / 0 &lt;/span&gt;&lt;/p&gt; &lt;userRealm implementation=&quot;org.mortbay.jetty.plus.jaas.JAASUserRealm&quot;&gt; ESMERealm ldaploginmodule &lt;/userRealm&gt; &lt;/userRealms&gt; &lt;/span&gt;&lt;/p&gt; &lt;/span&gt;&lt;/p&gt; java.security.auth.login.config ldap-loginModule.conf &lt;/systemProperty&gt; &lt;/systemProperties&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;/blockquote&gt; The file ldap-loginModule.conf is placed under the ESME_ROOT/server folder. It specifies login module implementation class - LdapLoginModule as well as LDAP-specific connection properties: ldap-loginModule.conf ldaploginmodule { org.mortbay.jetty.plus.jaas.ldap.LdapLoginModule required debug=&quot;true&quot; useLdaps=&quot;false&quot; contextFactory=&quot;com.sun.jndi.ldap.LdapCtxFactory&quot; hostname=&quot;localhost&quot; port=&quot;10389&quot; bindDn=&quot;uid=admin,ou=system&quot; bindPassword=&quot;secret&quot; authenticationMethod=&quot;simple&quot; forceBindingLogin=&quot;false&quot; userBaseDn=&quot;ou=Users,ou=esme,dc=lester,dc=org&quot; userRdnAttribute=&quot;uid&quot; userIdAttribute=&quot;uid&quot; userPasswordAttribute=&quot;userPassword&quot; userObjectClass=&quot;inetOrgPerson&quot; roleBaseDn=&quot;ou=Groups,ou=esme,dc=lester,dc=org&quot; roleNameAttribute=&quot;cn&quot; roleMemberAttribute=&quot;uniqueMember&quot; roleObjectClass=&quot;groupOfUniqueNames&quot;; }; Note that for some environments forceBindingLogin attribute must also be set to true. Tomcat The only required change in the Tomcat&#39;s server.xml configuration file (compared to the changes described in the last blog) is a different realm - JNDIRealm. This realm is used to connect to LDAP server and search users/groups: server.xml ... &lt;Realm className=&quot;org.apache.catalina.realm.JNDIRealm&quot; connectionName=&quot;uid=admin,ou=system&quot; connectionPassword=&quot;secret&quot; connectionURL=&quot;ldap://localhost:10389&quot; debug=&quot;99&quot; referrals=&quot;follow&quot; roleBase=&quot;ou=Groups,ou=esme,dc=lester,dc=org&quot; roleName=&quot;cn&quot; roleSearch=&quot;(uniqueMember={0})&quot; roleSubtree=&quot;true&quot; userBase=&quot;ou=Users,ou=esme,dc=lester,dc=org&quot; userSearch=&quot;(uid={0})&quot; userSubtree=&quot;true&quot;/&gt; &hellip; LDAPVendor and ESMELdap.properties file The web server is now configured to perform CMA. But the Servlet API makes only the user principal available for application. In order to fill ESME user&#39;s profile, additional attributes such as firstname, lastname and email are needed. We will use LDAP server to retrieve these attributes. Let&#39;s review changes in UserAuth.scala, specifically in ContainerManagedAuthModule object: UserAuth.scala To connect to the LDAP server from application first of all, it is necessary to create aq subclass of net.lift.ldap.LDAPVendor class: object myLdapVendor extends LDAPVendor All LDAP-specific connection properties are placed into a resource bundle &mdash; plaintext property file with key-value pairs. It is possible to get property values by key with the S.? method: def myLdap : LDAPVendor = { val ldapSrvHost = S.?(&quot;ldap.server.host&quot;) val ldapSrvPort = S.?(&quot;ldap.server.port&quot;) val ldapSrvBase = S.?(&quot;ldap.server.base&quot;) val ldapSrvUsrName = S.?(&quot;ldap.server.userName&quot;) val ldapSrvPwd = S.?(&quot;ldap.server.password&quot;) val ldapSrvAuthType = S.?(&quot;ldap.server.authType&quot;) val ldapSrvReferral= S.?(&quot;ldap.server.referral&quot;) val ldapSrvCtxFactory = S.?(&quot;ldap.server.initial_context_factory&quot;) The next step is to configure the LDAPVendor subclass with these values: myLdapVendor.configure(Map(&quot;ldap.url&quot; -&gt; &quot;ldap://%s:%s&quot;.format(ldapSrvHost, ldapSrvPort), &quot;ldap.base&quot; -&gt; ldapSrvBase, &quot;ldap.userName&quot; -&gt; ldapSrvUsrName, &quot;ldap.password&quot; -&gt; ldapSrvPwd, &quot;ldap.authType&quot; -&gt; ldapSrvAuthType, &quot;referral&quot; -&gt; ldapSrvReferral, &quot;ldap.initial_context_factory&quot; -&gt; ldapSrvCtxFactory)) myLdapVendor } The method getAttrs takes the username as a parameter and returns a map of [attribute name / list of attribute values] pairs (attribute in LDAP might contain more than one value) for this user. Let&#39;s review the method definition. It is possible to get attributes for user with LDAPVendor.attributesFromDn() method. It takes the distinguished name as a parameter, so it is necessary to append the prefix and the user base from the property file to the username to construct it. Note that the attributesFromDn method returns javax.naming.directory.Attributes therefore the interfaces from javax.naming.directory package must be imported correctly: import _root_.javax.naming.directory.{Attributes, Attribute =&gt; Attr} The shorthand Attr is used for the javax.naming.directory.Attribute because the scala.xml.Attribute trait has already been imported and placed in scope. Then attribute&#39;s id and values are used to populate the result map. The getAttrs method definition is shown below: def getAttrs(who : String) : Map[String, List[String]] = { &lt;/p&gt; val uidPrefix = S.?(&quot;ldap.uidPrefix&quot;) val userBase = S.?(&quot;ldap.userBase&quot;) var attrsMap = Map.empty[String, List[String]] val dn = &quot;%s=%s,%s&quot;.format(uidPrefix, who, userBase) val attrs : Attributes = myLdap.attributesFromDn(dn) if (attrs != null) { val allAttrs = attrs.getAll(); if (allAttrs != null) { while(allAttrs.hasMore()) { val attribute = allAttrs.next().asInstanceOf[Attr]; var attrValues = List.empty[String] for(i &lt;- 0 until attribute.size()) { attrValues ::= attribute.get(i).toString } attrsMap += (attribute.getID() -&gt; attrValues) } } } attrsMap } &lt;/font&gt; &lt;/blockquote&gt; The last step is to modify the performInit method. First of all, it is necessary to check if LDAP is enabled as configured in the property file. Then the values for attributes givenName, sn and mail are extracted from the map, returned via the getAttrs method call and then used to populate User instance. def performInit(): Unit = { &lt;/p&gt; ... val usr = User.createAndPopulate.nickname(username).saveMe //find and save additional attributes in LDAP if It is enabled val ldapEnabled = S.?(&quot;ldap.enabled&quot;) if(ldapEnabled.toBoolean) { val ldapAttrs = getAttrs(username) val firstName = ldapAttrs(&quot;givenName&quot;).head val lastName = ldapAttrs(&quot;sn&quot;).head val mail = ldapAttrs(&quot;mail&quot;).head usr.firstName(firstName).lastName(lastName).save } ... } &lt;/font&gt; The ESMELdap property file is shown below. It essentially resembles connection properties in web server configuration files that we have seen previously. ESMELdap.properties file #This flag specifies whether LDAP should be used ldap.enabled=true # Hostname or IP of LDAP server ldap.server.host=localhost # Port of LDAP server ldap.server.port=10389 # Base DN from the LDAP Server ldap.server.base=ou=esme,dc=lester,dc=org # User that has access to LDAP server to perform search operations ldap.server.userName=uid=admin,ou=system # Password for user above ldap.server.password=secret # Authentication type ldap.server.authType=simple # Referral ldap.server.referral=follow # Initial context factory class ldap.server.initial_context_factory=com.sun.jndi.ldap.LdapCtxFactory # Prefix for user to whom additional LDAP attributes belong, for example &#39;uid&#39; or &#39;sAMAccountName&#39; ldap.cnPrefix=uid # User base DN for user to whom additional LDAP attributes belong ldap.userBase=ou=Users,ou=esme,dc=lester,dc=org The last thing that must be done is to tell Lift where to look for the ESMELdap.properties file. The list of resource file names is assigned to LiftRules.resourceNames var in Boot.scala: Boot.scala LiftRules.resourceNames = &quot;ESMELdap&quot; :: &quot;ESMECustom&quot; :: &quot;ESMEBase&quot; :: &quot;ESMEUI&quot; :: Nil Conclusion We have just configured both web servers - Jetty and Tomcat - to perform authentication and authorization via LDAP. We have also improved ContainerManagedAuthModule to get additional attributes for authenticated user from LDAP with Lift LDAP API. Links 1. Apache Directory Server: http://directory.apache.org/apacheds/1.5/ 2. Jxplorer: http://jxplorer.org/ 3. Jetty login modules:&nbsp;http://docs.codehaus.org/display/JETTY/JAAS http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html 4. Tomcat user realms: http://tomcat.apache.org/tomcat-6.0-doc/realm-howto.html 5. Lift API: http://scala-tools.org/mvnsites/liftweb-2.3/ &lt;/p&gt;&lt;/p&gt;" />
<meta property="og:description" content="This blog was written by our new committer&nbsp;Vladimir Ivanov&nbsp;who implemented a feature that users have been wanting for a long time.&nbsp; In this blog, I&#39;ll discuss how container-managed authentication works with an LDAP server and how to connect and get additional information from it. I&#39;ll use Jetty and Apache Tomcat web servers with Apache Directory Server (ADS) 1.5.7 - a certified LDAPv3 compatible server. It is also possible to use different LDAP compatible server such as a 389 Directory Server or MS Active Directory. An LDAP server is a directory service that contains objects organized in a hierarchical manner. Apache Directory Server (ADS) The ADS project page provides a detailed server installation and configuration guide, but here are the basic steps: during the installation, the default server instance will be created. The configuration settings for this instance are defined in the server.xml file as Spring bean definitions. Below is an excerpt from the configuration file that was used for this blog. server.xml First of all, it is necessary to create a new partition: ... &lt;/span&gt;&lt;/p&gt; ... &lt;jdbmPartition id=&quot;lester&quot; suffix=&quot;dc=lester,dc=org&quot; /&gt; &lt;/partitions&gt; &lt;/blockquote&gt; Ports that LDAP server will use are specified as tcpTransport elements: &lt;ldapServer id=&quot;ldapServer&quot; &lt;/p&gt; allowAnonymousAccess=&quot;false&quot; saslHost=&quot;ldap.example.com&quot; saslPrincipal=&quot;ldap/ldap.example.com@EXAMPLE.COM&quot; searchBaseDn=&quot;ou=users,ou=system&quot; maxTimeLimit=&quot;15000&quot; maxSizeLimit=&quot;1000&quot;&gt; &lt;/span&gt;&lt;/p&gt; &lt;tcpTransport address=&quot;0.0.0.0&quot; port=&quot;10389&quot; nbThreads=&quot;8&quot; backLog=&quot;50&quot; enableSSL=&quot;false&quot;/&gt; &lt;tcpTransport address=&quot;localhost&quot; port=&quot;10636&quot; enableSSL=&quot;true&quot;/&gt; &lt;/transports&gt; &lt;/ldapServer&gt; &lt;/font&gt; &lt;/p&gt; &lt;/blockquote&gt; The local path to the directory containing LDIF files should also be specified: &lt;apacheDS id=&quot;apacheDS&quot;&gt; &lt;/p&gt; #ldapServer PATH_TO_ADS_INSTALL_DIR/instances/default/ldif &lt;/apacheDS&gt;&nbsp; &lt;/font&gt; &lt;/blockquote&gt; Other configuration settings were left unchanged. Now It is time to create the directory structure. I used the popular open source tool JXplorer for this task. It is possible to export the directory structure from the JXplorer tool to the LDIF file &mdash; directory content in text format. Let&#39;s review the generated file. lester.ldif Below is a record list beginning from the top. Note that each record has specific set of object classes defined in this schema. Each object class defines specific set of attributes, for example, person class defines Surname (sn) and Given Name (givenName) attributes. One object class can extend another, for example organizationalPerson class extends person class. top is a superclass for all other classes. Domain lester.org is the root of this hierarchy: dn: dc=lester,dc=org objectClass: extensibleObject objectClass: domain objectClass: top dc: lester The Organizational Unit esme is placed one level lower: dn: ou=esme,dc=lester,dc=org objectClass: organizationalUnit objectClass: top ou: esme The Organizational Unit Groups resides under the esme Organizational Unit: dn: ou=Groups,ou=esme,dc=lester,dc=org objectClass: organizationalUnit objectClass: top ou: Groups There is only one group esme-users on the lowest level of the hierarchy and it has the vivanov user (specified by a full path) as a unique member: dn: cn=esme-users,ou=Groups,ou=esme,dc=lester,dc=org objectClass: groupOfUniqueNames objectClass: top cn: esme-users ou: Groups uniqueMember: uid=vivanov,ou=Users,ou=esme,dc=lester,dc=org The Organizational Unit Users resides under the esme organizational unit: dn: ou=Users,ou=esme,dc=lester,dc=org objectClass: organizationalUnit objectClass: top ou: Users The user vivanov and its corresponding attributes are defined on the lowest level of the hierarchy: dn: uid=vivanov,ou=Users,ou=esme,dc=lester,dc=org objectClass: organizationalPerson objectClass: person objectClass: uidObject objectClass: inetOrgPerson objectClass: top cn: vivanov givenName: Vladimir mail: vivanov@lester.org ou: Users sn: Ivanov telephoneNumber: +7 111 222 33 44 uid: vivanov userPassword:: cXdlcnR5 There is also a special user with administrative rights: uid=admin,ou=system (default password: secret) defined in system schema. It was used to connect to ADS from JXplorer. Those were all basic steps necessary to configure ADS for purpose of this b log. Let&#39;s move to the configuration of the web servers. Configuration Before digging into the configuration details specific for each web server, let&#39;s review the common properties used to connect to the LDAP server. First of all, it is necessary to specify the hostname / ip address and the port of our LDAP server &mdash; localhost:10389, as well as the credentials for an account that has rights to perform search operation and get attributes for users and roles in a directory tree. The special admin user described in previous section was also used for this purpose in this blog. Sometimes anonymous access is also permitted. The next set of properties, user base and group base, specify the base context with which to lookup users and groups. For our configuration web server will search users under ou=Users,ou=esme,dc=lester,dc=org and groups under ou=Groups,ou=esme,dc=lester,dc=org paths in the directory tree accordingly. The user id and role name attributes specify the prefix for user/group search filter. In our example, it has the uid value for users and the cn value for groups. The uniqueMember attribute is used to check whether the user belongs to the specified group. Now it is time to review the configuration for each of the web servers. Note: The required lift-ldap dependency has been already included in pom.xml. Jetty In order to configure Jetty to use LDAP server, two additional Maven dependencies: jetty-plus and jetty-ldap-jaas should be added to the pom.xml file. Configuration of maven-jetty-plugin includes the following steps: set the JAASUserRealm as an user realm implementation and specify the ldaploginmodule as the login module name. It is also necessary to set the system property java.security.auth.login.config with the ldap-loginModule.conf value: pom.xml &lt;/span&gt;&lt;/p&gt; org.mortbay.jetty jetty-plus [6.1.6,) compile &lt;/dependency&gt; &lt;/span&gt;&lt;/p&gt; org.mortbay.jetty jetty-ldap-jaas [6.1.6,) compile &lt;/dependency&gt; &lt;/span&gt;&lt;/p&gt; org.mortbay.jetty maven-jetty-plugin &lt;/span&gt;&lt;/p&gt; / 0 &lt;/span&gt;&lt;/p&gt; &lt;userRealm implementation=&quot;org.mortbay.jetty.plus.jaas.JAASUserRealm&quot;&gt; ESMERealm ldaploginmodule &lt;/userRealm&gt; &lt;/userRealms&gt; &lt;/span&gt;&lt;/p&gt; &lt;/span&gt;&lt;/p&gt; java.security.auth.login.config ldap-loginModule.conf &lt;/systemProperty&gt; &lt;/systemProperties&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;/blockquote&gt; The file ldap-loginModule.conf is placed under the ESME_ROOT/server folder. It specifies login module implementation class - LdapLoginModule as well as LDAP-specific connection properties: ldap-loginModule.conf ldaploginmodule { org.mortbay.jetty.plus.jaas.ldap.LdapLoginModule required debug=&quot;true&quot; useLdaps=&quot;false&quot; contextFactory=&quot;com.sun.jndi.ldap.LdapCtxFactory&quot; hostname=&quot;localhost&quot; port=&quot;10389&quot; bindDn=&quot;uid=admin,ou=system&quot; bindPassword=&quot;secret&quot; authenticationMethod=&quot;simple&quot; forceBindingLogin=&quot;false&quot; userBaseDn=&quot;ou=Users,ou=esme,dc=lester,dc=org&quot; userRdnAttribute=&quot;uid&quot; userIdAttribute=&quot;uid&quot; userPasswordAttribute=&quot;userPassword&quot; userObjectClass=&quot;inetOrgPerson&quot; roleBaseDn=&quot;ou=Groups,ou=esme,dc=lester,dc=org&quot; roleNameAttribute=&quot;cn&quot; roleMemberAttribute=&quot;uniqueMember&quot; roleObjectClass=&quot;groupOfUniqueNames&quot;; }; Note that for some environments forceBindingLogin attribute must also be set to true. Tomcat The only required change in the Tomcat&#39;s server.xml configuration file (compared to the changes described in the last blog) is a different realm - JNDIRealm. This realm is used to connect to LDAP server and search users/groups: server.xml ... &lt;Realm className=&quot;org.apache.catalina.realm.JNDIRealm&quot; connectionName=&quot;uid=admin,ou=system&quot; connectionPassword=&quot;secret&quot; connectionURL=&quot;ldap://localhost:10389&quot; debug=&quot;99&quot; referrals=&quot;follow&quot; roleBase=&quot;ou=Groups,ou=esme,dc=lester,dc=org&quot; roleName=&quot;cn&quot; roleSearch=&quot;(uniqueMember={0})&quot; roleSubtree=&quot;true&quot; userBase=&quot;ou=Users,ou=esme,dc=lester,dc=org&quot; userSearch=&quot;(uid={0})&quot; userSubtree=&quot;true&quot;/&gt; &hellip; LDAPVendor and ESMELdap.properties file The web server is now configured to perform CMA. But the Servlet API makes only the user principal available for application. In order to fill ESME user&#39;s profile, additional attributes such as firstname, lastname and email are needed. We will use LDAP server to retrieve these attributes. Let&#39;s review changes in UserAuth.scala, specifically in ContainerManagedAuthModule object: UserAuth.scala To connect to the LDAP server from application first of all, it is necessary to create aq subclass of net.lift.ldap.LDAPVendor class: object myLdapVendor extends LDAPVendor All LDAP-specific connection properties are placed into a resource bundle &mdash; plaintext property file with key-value pairs. It is possible to get property values by key with the S.? method: def myLdap : LDAPVendor = { val ldapSrvHost = S.?(&quot;ldap.server.host&quot;) val ldapSrvPort = S.?(&quot;ldap.server.port&quot;) val ldapSrvBase = S.?(&quot;ldap.server.base&quot;) val ldapSrvUsrName = S.?(&quot;ldap.server.userName&quot;) val ldapSrvPwd = S.?(&quot;ldap.server.password&quot;) val ldapSrvAuthType = S.?(&quot;ldap.server.authType&quot;) val ldapSrvReferral= S.?(&quot;ldap.server.referral&quot;) val ldapSrvCtxFactory = S.?(&quot;ldap.server.initial_context_factory&quot;) The next step is to configure the LDAPVendor subclass with these values: myLdapVendor.configure(Map(&quot;ldap.url&quot; -&gt; &quot;ldap://%s:%s&quot;.format(ldapSrvHost, ldapSrvPort), &quot;ldap.base&quot; -&gt; ldapSrvBase, &quot;ldap.userName&quot; -&gt; ldapSrvUsrName, &quot;ldap.password&quot; -&gt; ldapSrvPwd, &quot;ldap.authType&quot; -&gt; ldapSrvAuthType, &quot;referral&quot; -&gt; ldapSrvReferral, &quot;ldap.initial_context_factory&quot; -&gt; ldapSrvCtxFactory)) myLdapVendor } The method getAttrs takes the username as a parameter and returns a map of [attribute name / list of attribute values] pairs (attribute in LDAP might contain more than one value) for this user. Let&#39;s review the method definition. It is possible to get attributes for user with LDAPVendor.attributesFromDn() method. It takes the distinguished name as a parameter, so it is necessary to append the prefix and the user base from the property file to the username to construct it. Note that the attributesFromDn method returns javax.naming.directory.Attributes therefore the interfaces from javax.naming.directory package must be imported correctly: import _root_.javax.naming.directory.{Attributes, Attribute =&gt; Attr} The shorthand Attr is used for the javax.naming.directory.Attribute because the scala.xml.Attribute trait has already been imported and placed in scope. Then attribute&#39;s id and values are used to populate the result map. The getAttrs method definition is shown below: def getAttrs(who : String) : Map[String, List[String]] = { &lt;/p&gt; val uidPrefix = S.?(&quot;ldap.uidPrefix&quot;) val userBase = S.?(&quot;ldap.userBase&quot;) var attrsMap = Map.empty[String, List[String]] val dn = &quot;%s=%s,%s&quot;.format(uidPrefix, who, userBase) val attrs : Attributes = myLdap.attributesFromDn(dn) if (attrs != null) { val allAttrs = attrs.getAll(); if (allAttrs != null) { while(allAttrs.hasMore()) { val attribute = allAttrs.next().asInstanceOf[Attr]; var attrValues = List.empty[String] for(i &lt;- 0 until attribute.size()) { attrValues ::= attribute.get(i).toString } attrsMap += (attribute.getID() -&gt; attrValues) } } } attrsMap } &lt;/font&gt; &lt;/blockquote&gt; The last step is to modify the performInit method. First of all, it is necessary to check if LDAP is enabled as configured in the property file. Then the values for attributes givenName, sn and mail are extracted from the map, returned via the getAttrs method call and then used to populate User instance. def performInit(): Unit = { &lt;/p&gt; ... val usr = User.createAndPopulate.nickname(username).saveMe //find and save additional attributes in LDAP if It is enabled val ldapEnabled = S.?(&quot;ldap.enabled&quot;) if(ldapEnabled.toBoolean) { val ldapAttrs = getAttrs(username) val firstName = ldapAttrs(&quot;givenName&quot;).head val lastName = ldapAttrs(&quot;sn&quot;).head val mail = ldapAttrs(&quot;mail&quot;).head usr.firstName(firstName).lastName(lastName).save } ... } &lt;/font&gt; The ESMELdap property file is shown below. It essentially resembles connection properties in web server configuration files that we have seen previously. ESMELdap.properties file #This flag specifies whether LDAP should be used ldap.enabled=true # Hostname or IP of LDAP server ldap.server.host=localhost # Port of LDAP server ldap.server.port=10389 # Base DN from the LDAP Server ldap.server.base=ou=esme,dc=lester,dc=org # User that has access to LDAP server to perform search operations ldap.server.userName=uid=admin,ou=system # Password for user above ldap.server.password=secret # Authentication type ldap.server.authType=simple # Referral ldap.server.referral=follow # Initial context factory class ldap.server.initial_context_factory=com.sun.jndi.ldap.LdapCtxFactory # Prefix for user to whom additional LDAP attributes belong, for example &#39;uid&#39; or &#39;sAMAccountName&#39; ldap.cnPrefix=uid # User base DN for user to whom additional LDAP attributes belong ldap.userBase=ou=Users,ou=esme,dc=lester,dc=org The last thing that must be done is to tell Lift where to look for the ESMELdap.properties file. The list of resource file names is assigned to LiftRules.resourceNames var in Boot.scala: Boot.scala LiftRules.resourceNames = &quot;ESMELdap&quot; :: &quot;ESMECustom&quot; :: &quot;ESMEBase&quot; :: &quot;ESMEUI&quot; :: Nil Conclusion We have just configured both web servers - Jetty and Tomcat - to perform authentication and authorization via LDAP. We have also improved ContainerManagedAuthModule to get additional attributes for authenticated user from LDAP with Lift LDAP API. Links 1. Apache Directory Server: http://directory.apache.org/apacheds/1.5/ 2. Jxplorer: http://jxplorer.org/ 3. Jetty login modules:&nbsp;http://docs.codehaus.org/display/JETTY/JAAS http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html 4. Tomcat user realms: http://tomcat.apache.org/tomcat-6.0-doc/realm-howto.html 5. Lift API: http://scala-tools.org/mvnsites/liftweb-2.3/ &lt;/p&gt;&lt;/p&gt;" />
<link rel="canonical" href="http://localhost:4000/esme/entry/test" />
<meta property="og:url" content="http://localhost:4000/esme/entry/test" />
<meta property="og:site_name" content="Blogs Archive" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2011-04-13T07:12:33-04:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="LDAP-based Authentication with Apache ESME and Apache Directory Server" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2011-04-13T07:12:33-04:00","datePublished":"2011-04-13T07:12:33-04:00","description":"This blog was written by our new committer&nbsp;Vladimir Ivanov&nbsp;who implemented a feature that users have been wanting for a long time.&nbsp; In this blog, I&#39;ll discuss how container-managed authentication works with an LDAP server and how to connect and get additional information from it. I&#39;ll use Jetty and Apache Tomcat web servers with Apache Directory Server (ADS) 1.5.7 - a certified LDAPv3 compatible server. It is also possible to use different LDAP compatible server such as a 389 Directory Server or MS Active Directory. An LDAP server is a directory service that contains objects organized in a hierarchical manner. Apache Directory Server (ADS) The ADS project page provides a detailed server installation and configuration guide, but here are the basic steps: during the installation, the default server instance will be created. The configuration settings for this instance are defined in the server.xml file as Spring bean definitions. Below is an excerpt from the configuration file that was used for this blog. server.xml First of all, it is necessary to create a new partition: ... &lt;/span&gt;&lt;/p&gt; ... &lt;jdbmPartition id=&quot;lester&quot; suffix=&quot;dc=lester,dc=org&quot; /&gt; &lt;/partitions&gt; &lt;/blockquote&gt; Ports that LDAP server will use are specified as tcpTransport elements: &lt;ldapServer id=&quot;ldapServer&quot; &lt;/p&gt; allowAnonymousAccess=&quot;false&quot; saslHost=&quot;ldap.example.com&quot; saslPrincipal=&quot;ldap/ldap.example.com@EXAMPLE.COM&quot; searchBaseDn=&quot;ou=users,ou=system&quot; maxTimeLimit=&quot;15000&quot; maxSizeLimit=&quot;1000&quot;&gt; &lt;/span&gt;&lt;/p&gt; &lt;tcpTransport address=&quot;0.0.0.0&quot; port=&quot;10389&quot; nbThreads=&quot;8&quot; backLog=&quot;50&quot; enableSSL=&quot;false&quot;/&gt; &lt;tcpTransport address=&quot;localhost&quot; port=&quot;10636&quot; enableSSL=&quot;true&quot;/&gt; &lt;/transports&gt; &lt;/ldapServer&gt; &lt;/font&gt; &lt;/p&gt; &lt;/blockquote&gt; The local path to the directory containing LDIF files should also be specified: &lt;apacheDS id=&quot;apacheDS&quot;&gt; &lt;/p&gt; #ldapServer PATH_TO_ADS_INSTALL_DIR/instances/default/ldif &lt;/apacheDS&gt;&nbsp; &lt;/font&gt; &lt;/blockquote&gt; Other configuration settings were left unchanged. Now It is time to create the directory structure. I used the popular open source tool JXplorer for this task. It is possible to export the directory structure from the JXplorer tool to the LDIF file &mdash; directory content in text format. Let&#39;s review the generated file. lester.ldif Below is a record list beginning from the top. Note that each record has specific set of object classes defined in this schema. Each object class defines specific set of attributes, for example, person class defines Surname (sn) and Given Name (givenName) attributes. One object class can extend another, for example organizationalPerson class extends person class. top is a superclass for all other classes. Domain lester.org is the root of this hierarchy: dn: dc=lester,dc=org objectClass: extensibleObject objectClass: domain objectClass: top dc: lester The Organizational Unit esme is placed one level lower: dn: ou=esme,dc=lester,dc=org objectClass: organizationalUnit objectClass: top ou: esme The Organizational Unit Groups resides under the esme Organizational Unit: dn: ou=Groups,ou=esme,dc=lester,dc=org objectClass: organizationalUnit objectClass: top ou: Groups There is only one group esme-users on the lowest level of the hierarchy and it has the vivanov user (specified by a full path) as a unique member: dn: cn=esme-users,ou=Groups,ou=esme,dc=lester,dc=org objectClass: groupOfUniqueNames objectClass: top cn: esme-users ou: Groups uniqueMember: uid=vivanov,ou=Users,ou=esme,dc=lester,dc=org The Organizational Unit Users resides under the esme organizational unit: dn: ou=Users,ou=esme,dc=lester,dc=org objectClass: organizationalUnit objectClass: top ou: Users The user vivanov and its corresponding attributes are defined on the lowest level of the hierarchy: dn: uid=vivanov,ou=Users,ou=esme,dc=lester,dc=org objectClass: organizationalPerson objectClass: person objectClass: uidObject objectClass: inetOrgPerson objectClass: top cn: vivanov givenName: Vladimir mail: vivanov@lester.org ou: Users sn: Ivanov telephoneNumber: +7 111 222 33 44 uid: vivanov userPassword:: cXdlcnR5 There is also a special user with administrative rights: uid=admin,ou=system (default password: secret) defined in system schema. It was used to connect to ADS from JXplorer. Those were all basic steps necessary to configure ADS for purpose of this b log. Let&#39;s move to the configuration of the web servers. Configuration Before digging into the configuration details specific for each web server, let&#39;s review the common properties used to connect to the LDAP server. First of all, it is necessary to specify the hostname / ip address and the port of our LDAP server &mdash; localhost:10389, as well as the credentials for an account that has rights to perform search operation and get attributes for users and roles in a directory tree. The special admin user described in previous section was also used for this purpose in this blog. Sometimes anonymous access is also permitted. The next set of properties, user base and group base, specify the base context with which to lookup users and groups. For our configuration web server will search users under ou=Users,ou=esme,dc=lester,dc=org and groups under ou=Groups,ou=esme,dc=lester,dc=org paths in the directory tree accordingly. The user id and role name attributes specify the prefix for user/group search filter. In our example, it has the uid value for users and the cn value for groups. The uniqueMember attribute is used to check whether the user belongs to the specified group. Now it is time to review the configuration for each of the web servers. Note: The required lift-ldap dependency has been already included in pom.xml. Jetty In order to configure Jetty to use LDAP server, two additional Maven dependencies: jetty-plus and jetty-ldap-jaas should be added to the pom.xml file. Configuration of maven-jetty-plugin includes the following steps: set the JAASUserRealm as an user realm implementation and specify the ldaploginmodule as the login module name. It is also necessary to set the system property java.security.auth.login.config with the ldap-loginModule.conf value: pom.xml &lt;/span&gt;&lt;/p&gt; org.mortbay.jetty jetty-plus [6.1.6,) compile &lt;/dependency&gt; &lt;/span&gt;&lt;/p&gt; org.mortbay.jetty jetty-ldap-jaas [6.1.6,) compile &lt;/dependency&gt; &lt;/span&gt;&lt;/p&gt; org.mortbay.jetty maven-jetty-plugin &lt;/span&gt;&lt;/p&gt; / 0 &lt;/span&gt;&lt;/p&gt; &lt;userRealm implementation=&quot;org.mortbay.jetty.plus.jaas.JAASUserRealm&quot;&gt; ESMERealm ldaploginmodule &lt;/userRealm&gt; &lt;/userRealms&gt; &lt;/span&gt;&lt;/p&gt; &lt;/span&gt;&lt;/p&gt; java.security.auth.login.config ldap-loginModule.conf &lt;/systemProperty&gt; &lt;/systemProperties&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;/blockquote&gt; The file ldap-loginModule.conf is placed under the ESME_ROOT/server folder. It specifies login module implementation class - LdapLoginModule as well as LDAP-specific connection properties: ldap-loginModule.conf ldaploginmodule { org.mortbay.jetty.plus.jaas.ldap.LdapLoginModule required debug=&quot;true&quot; useLdaps=&quot;false&quot; contextFactory=&quot;com.sun.jndi.ldap.LdapCtxFactory&quot; hostname=&quot;localhost&quot; port=&quot;10389&quot; bindDn=&quot;uid=admin,ou=system&quot; bindPassword=&quot;secret&quot; authenticationMethod=&quot;simple&quot; forceBindingLogin=&quot;false&quot; userBaseDn=&quot;ou=Users,ou=esme,dc=lester,dc=org&quot; userRdnAttribute=&quot;uid&quot; userIdAttribute=&quot;uid&quot; userPasswordAttribute=&quot;userPassword&quot; userObjectClass=&quot;inetOrgPerson&quot; roleBaseDn=&quot;ou=Groups,ou=esme,dc=lester,dc=org&quot; roleNameAttribute=&quot;cn&quot; roleMemberAttribute=&quot;uniqueMember&quot; roleObjectClass=&quot;groupOfUniqueNames&quot;; }; Note that for some environments forceBindingLogin attribute must also be set to true. Tomcat The only required change in the Tomcat&#39;s server.xml configuration file (compared to the changes described in the last blog) is a different realm - JNDIRealm. This realm is used to connect to LDAP server and search users/groups: server.xml ... &lt;Realm className=&quot;org.apache.catalina.realm.JNDIRealm&quot; connectionName=&quot;uid=admin,ou=system&quot; connectionPassword=&quot;secret&quot; connectionURL=&quot;ldap://localhost:10389&quot; debug=&quot;99&quot; referrals=&quot;follow&quot; roleBase=&quot;ou=Groups,ou=esme,dc=lester,dc=org&quot; roleName=&quot;cn&quot; roleSearch=&quot;(uniqueMember={0})&quot; roleSubtree=&quot;true&quot; userBase=&quot;ou=Users,ou=esme,dc=lester,dc=org&quot; userSearch=&quot;(uid={0})&quot; userSubtree=&quot;true&quot;/&gt; &hellip; LDAPVendor and ESMELdap.properties file The web server is now configured to perform CMA. But the Servlet API makes only the user principal available for application. In order to fill ESME user&#39;s profile, additional attributes such as firstname, lastname and email are needed. We will use LDAP server to retrieve these attributes. Let&#39;s review changes in UserAuth.scala, specifically in ContainerManagedAuthModule object: UserAuth.scala To connect to the LDAP server from application first of all, it is necessary to create aq subclass of net.lift.ldap.LDAPVendor class: object myLdapVendor extends LDAPVendor All LDAP-specific connection properties are placed into a resource bundle &mdash; plaintext property file with key-value pairs. It is possible to get property values by key with the S.? method: def myLdap : LDAPVendor = { val ldapSrvHost = S.?(&quot;ldap.server.host&quot;) val ldapSrvPort = S.?(&quot;ldap.server.port&quot;) val ldapSrvBase = S.?(&quot;ldap.server.base&quot;) val ldapSrvUsrName = S.?(&quot;ldap.server.userName&quot;) val ldapSrvPwd = S.?(&quot;ldap.server.password&quot;) val ldapSrvAuthType = S.?(&quot;ldap.server.authType&quot;) val ldapSrvReferral= S.?(&quot;ldap.server.referral&quot;) val ldapSrvCtxFactory = S.?(&quot;ldap.server.initial_context_factory&quot;) The next step is to configure the LDAPVendor subclass with these values: myLdapVendor.configure(Map(&quot;ldap.url&quot; -&gt; &quot;ldap://%s:%s&quot;.format(ldapSrvHost, ldapSrvPort), &quot;ldap.base&quot; -&gt; ldapSrvBase, &quot;ldap.userName&quot; -&gt; ldapSrvUsrName, &quot;ldap.password&quot; -&gt; ldapSrvPwd, &quot;ldap.authType&quot; -&gt; ldapSrvAuthType, &quot;referral&quot; -&gt; ldapSrvReferral, &quot;ldap.initial_context_factory&quot; -&gt; ldapSrvCtxFactory)) myLdapVendor } The method getAttrs takes the username as a parameter and returns a map of [attribute name / list of attribute values] pairs (attribute in LDAP might contain more than one value) for this user. Let&#39;s review the method definition. It is possible to get attributes for user with LDAPVendor.attributesFromDn() method. It takes the distinguished name as a parameter, so it is necessary to append the prefix and the user base from the property file to the username to construct it. Note that the attributesFromDn method returns javax.naming.directory.Attributes therefore the interfaces from javax.naming.directory package must be imported correctly: import _root_.javax.naming.directory.{Attributes, Attribute =&gt; Attr} The shorthand Attr is used for the javax.naming.directory.Attribute because the scala.xml.Attribute trait has already been imported and placed in scope. Then attribute&#39;s id and values are used to populate the result map. The getAttrs method definition is shown below: def getAttrs(who : String) : Map[String, List[String]] = { &lt;/p&gt; val uidPrefix = S.?(&quot;ldap.uidPrefix&quot;) val userBase = S.?(&quot;ldap.userBase&quot;) var attrsMap = Map.empty[String, List[String]] val dn = &quot;%s=%s,%s&quot;.format(uidPrefix, who, userBase) val attrs : Attributes = myLdap.attributesFromDn(dn) if (attrs != null) { val allAttrs = attrs.getAll(); if (allAttrs != null) { while(allAttrs.hasMore()) { val attribute = allAttrs.next().asInstanceOf[Attr]; var attrValues = List.empty[String] for(i &lt;- 0 until attribute.size()) { attrValues ::= attribute.get(i).toString } attrsMap += (attribute.getID() -&gt; attrValues) } } } attrsMap } &lt;/font&gt; &lt;/blockquote&gt; The last step is to modify the performInit method. First of all, it is necessary to check if LDAP is enabled as configured in the property file. Then the values for attributes givenName, sn and mail are extracted from the map, returned via the getAttrs method call and then used to populate User instance. def performInit(): Unit = { &lt;/p&gt; ... val usr = User.createAndPopulate.nickname(username).saveMe //find and save additional attributes in LDAP if It is enabled val ldapEnabled = S.?(&quot;ldap.enabled&quot;) if(ldapEnabled.toBoolean) { val ldapAttrs = getAttrs(username) val firstName = ldapAttrs(&quot;givenName&quot;).head val lastName = ldapAttrs(&quot;sn&quot;).head val mail = ldapAttrs(&quot;mail&quot;).head usr.firstName(firstName).lastName(lastName).save } ... } &lt;/font&gt; The ESMELdap property file is shown below. It essentially resembles connection properties in web server configuration files that we have seen previously. ESMELdap.properties file #This flag specifies whether LDAP should be used ldap.enabled=true # Hostname or IP of LDAP server ldap.server.host=localhost # Port of LDAP server ldap.server.port=10389 # Base DN from the LDAP Server ldap.server.base=ou=esme,dc=lester,dc=org # User that has access to LDAP server to perform search operations ldap.server.userName=uid=admin,ou=system # Password for user above ldap.server.password=secret # Authentication type ldap.server.authType=simple # Referral ldap.server.referral=follow # Initial context factory class ldap.server.initial_context_factory=com.sun.jndi.ldap.LdapCtxFactory # Prefix for user to whom additional LDAP attributes belong, for example &#39;uid&#39; or &#39;sAMAccountName&#39; ldap.cnPrefix=uid # User base DN for user to whom additional LDAP attributes belong ldap.userBase=ou=Users,ou=esme,dc=lester,dc=org The last thing that must be done is to tell Lift where to look for the ESMELdap.properties file. The list of resource file names is assigned to LiftRules.resourceNames var in Boot.scala: Boot.scala LiftRules.resourceNames = &quot;ESMELdap&quot; :: &quot;ESMECustom&quot; :: &quot;ESMEBase&quot; :: &quot;ESMEUI&quot; :: Nil Conclusion We have just configured both web servers - Jetty and Tomcat - to perform authentication and authorization via LDAP. We have also improved ContainerManagedAuthModule to get additional attributes for authenticated user from LDAP with Lift LDAP API. Links 1. Apache Directory Server: http://directory.apache.org/apacheds/1.5/ 2. Jxplorer: http://jxplorer.org/ 3. Jetty login modules:&nbsp;http://docs.codehaus.org/display/JETTY/JAAS http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html 4. Tomcat user realms: http://tomcat.apache.org/tomcat-6.0-doc/realm-howto.html 5. Lift API: http://scala-tools.org/mvnsites/liftweb-2.3/ &lt;/p&gt;&lt;/p&gt;","headline":"LDAP-based Authentication with Apache ESME and Apache Directory Server","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/esme/entry/test"},"url":"http://localhost:4000/esme/entry/test"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Blogs Archive" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Blogs Archive</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">LDAP-based Authentication with Apache ESME and Apache Directory Server </h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2011-04-13T07:12:33-04:00" itemprop="datePublished">Apr 13, 2011
      </time>• <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">{"display_name"=>"Richard Hirsch", "login"=>"rhirsch", "email"=>"rhirsch@apache.org"}</span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p class=" "><span>This blog was written by our new committer&nbsp;<i>Vladimir Ivanov</i>&nbsp;who implemented a feature that users have been wanting for a long time.&nbsp;</span> </p>
<p class=" "><span>In this blog, I'll discuss how container-managed authentication works<br />
with an LDAP server and how to connect and get additional information from it.<br />
I'll use Jetty and Apache Tomcat web servers with Apache Directory Server (ADS)<br />
1.5.7 - a certified LDAPv3 compatible server. It is also possible to use<br />
different LDAP compatible server such as a 389 Directory Server or MS Active<br />
Directory.</span></p>
<p class=" "><span> </span></p>
<p class=" "><span>An LDAP server is a directory service that contains objects organized in<br />
a hierarchical manner.</span></p>
<h2><span>Apache Directory Server (ADS)</span></h2>
<p class=" "><span> </span></p>
<p class=" "><span>The ADS project page provides a detailed server installation and<br />
configuration guide, but here are the basic steps: during the installation, the<br />
default server instance will be created. The configuration settings for this<br />
instance are defined in the <em>server.xml</em> file as Spring bean definitions.<br />
Below is an excerpt from the configuration file that was used for this<br />
blog.<span> </span></span></p>
<p class=" "><span> </span></p>
<p class=" "><u><span>server.xml</span></u></p>
<p class=" "><u><span> </span></u></p>
<p class=" "><span>First of all, it is necessary to create a new partition:</span></p>
<blockquote class="webkit-indent-blockquote" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 40px; border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; ">
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">...</span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">
<partitions>
</span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">... </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "><jdbmPartition id="lester"<br />
suffix="dc=lester,dc=org" /> </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "></partitions> </span></p>
</blockquote>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "> </span></p>
<p class=" "><span>Ports that LDAP server will use are specified as tcpTransport elements:</span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "> </span></p>
<blockquote class="webkit-indent-blockquote" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 40px; border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; ">
<p class=" "><font face="'Courier New'"><span style="font-size: 12px; "> </span></font></p>
<p class="MsoNormal"><font face="'Courier New'"><span style="font-size: 12px; "> </span></font></p>
<p><font face="'Courier New'"><span style="font-size: 12px; "> </span></font></p>
<p class="MsoNormal"><font face="'Courier New'"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span><ldapServer<br />
id="ldapServer" <o:p /></span></font></p>
<p><font face="'Courier New'"> </p>
<p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>allowAnonymousAccess="false" <o:p /></span></p>
<p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span><span> </span>saslHost="ldap.example.com" <o:p /></span></p>
<p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>saslPrincipal="ldap/ldap.example.com@EXAMPLE.COM" <o:p /></span></p>
<p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>searchBaseDn="ou=users,ou=system" <o:p /></span></p>
<p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>maxTimeLimit="15000" <o:p /></span></p>
<p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>maxSizeLimit="1000"> <o:p /></span></p>
<p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span><br />
<transports> <o:p /></span></p>
<p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span><tcpTransport address="0.0.0.0" port="10389"<br />
nbThreads="8" backLog="50" enableSSL="false"/><br />
<o:p /></span></p>
<p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span><tcpTransport address="localhost" port="10636"<br />
enableSSL="true"/> <o:p /></span></p>
<p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span></transports> <o:p /></span></p>
<p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span></ldapServer><o:p /></span></p>
<p></font> </p></p>
</blockquote>
<p>The local path to the directory containing LDIF files should also be<br />
specified: </p>
<blockquote class="webkit-indent-blockquote" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 40px; border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; ">
<p class=" "><font face="'Courier New'"><span style="font-size: 12px; "> </span></font></p>
<p class="MsoNormal"><font face="'Courier New'"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span><apacheDS<br />
id="apacheDS"> <o:p /></span></font></p>
<p><font face="'Courier New'"> </p>
<p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span><ldapServer>#ldapServer</ldapServer> <o:p /></span></p>
<p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span><ldifDirectory><b>PATH_TO_ADS_INSTALL_DIR/instances/default/ldif</b></ldifDirectory><br />
<o:p /></span></p>
<p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span></apacheDS>&nbsp;<o:p /></span></p>
<p></font> </p>
</blockquote>
<p class=" "><em><span> </span></em></p>
<p class=" "><span> </span></p>
<p class=" "><em><span> </span></em></p>
<p class=" "><span>Other configuration settings were left unchanged.</span></p>
<p class=" "><span> </span></p>
<p class=" "><span>Now It is time to create the directory structure. I used the popular<br />
open source tool JXplorer for this task.</span></p>
<p class=" "><span> </span></p>
<p class=" "><span> </span></p>
<p class=" "><span>It is possible to export the directory structure from the JXplorer tool<br />
to the LDIF file &mdash; directory content in text format. Let's review the generated<br />
file.</span></p>
<p class=" "><span> </span></p>
<p class=" "><u><span>lester.ldif</span></u></p>
<p class=" "><u><span> </span></u></p>
<p class=" "><span>Below is a record list beginning from the top. Note that each record has<br />
specific set of object classes defined in this schema. Each object class<br />
defines specific set of attributes, for example, <em>person</em> class defines <em>Surname</em><br />
(<em>sn</em>) and <em>Given Name</em> (<em>givenName</em>) attributes. One object<br />
class can extend another, for example <em>organizationalPerson </em>class extends<br />
<em>person </em>class. <em>top</em> is a superclass for all other classes.</span></p>
<p class=" "><span> </span></p>
<p class=" "><span>Domain <em>lester.org</em> is the root of this hierarchy:<span> </span></span></p>
<p class=" "><span> </span></p>
<blockquote class="webkit-indent-blockquote" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 40px; border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; ">
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">dn: dc=lester,dc=org </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">objectClass: extensibleObject </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">objectClass: domain </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">objectClass: top </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">dc: lester </span></p>
</blockquote>
<p class=" "><em><span> </span></em></p>
<p class=" "><em><span> </span></em></p>
<p class=" "><span>The Organizational Unit <em>esme </em>is placed one level lower:</span></p>
<p class=" "><span> </span></p>
<blockquote class="webkit-indent-blockquote" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 40px; border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; ">
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">dn: ou=esme,dc=lester,dc=org </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">objectClass: organizationalUnit </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">objectClass: top </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">ou: esme </span></p>
</blockquote>
<p class=" "><em><span> </span></em></p>
<p class=" "><span>The Organizational Unit<em> Groups </em>resides under the <em>esme</em><br />
Organizational Unit:</span></p>
<p class=" "><span> </span></p>
<blockquote class="webkit-indent-blockquote" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 40px; border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; ">
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">dn: ou=Groups,ou=esme,dc=lester,dc=org </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">objectClass: organizationalUnit </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">objectClass: top </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">ou: Groups </span></p>
</blockquote>
<p class=" "><em><span> </span></em></p>
<p class=" "><span>There is only one group <em>esme-users</em> on the lowest level of the hierarchy<br />
and it has the <em>vivanov</em> user (specified by a <span> </span>full path) as a unique member:</span></p>
<p class=" "><span> </span></p>
<blockquote class="webkit-indent-blockquote" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 40px; border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; ">
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">dn: cn=esme-users,ou=Groups,ou=esme,dc=lester,dc=org </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">objectClass: groupOfUniqueNames </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">objectClass: top </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">cn: esme-users </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">ou: Groups </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">uniqueMember:<br />
uid=vivanov,ou=Users,ou=esme,dc=lester,dc=org </span></p>
</blockquote>
<p class=" "><em><span> </span></em></p>
<p class=" "><span>The Organizational Unit<em> Users </em>resides under the <em>esme</em><br />
organizational unit:</span></p>
<p class=" "><span> </span></p>
<blockquote class="webkit-indent-blockquote" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 40px; border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; ">
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">dn: ou=Users,ou=esme,dc=lester,dc=org </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">objectClass: organizationalUnit </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">objectClass: top </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">ou: Users </span></p>
</blockquote>
<p class=" "><em><span> </span></em></p>
<p class=" "><span>The user <em>vivanov </em>and its corresponding attributes are defined on the<br />
lowest level of the hierarchy:</span></p>
<p class=" "><span> </span></p>
<blockquote class="webkit-indent-blockquote" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 40px; border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; ">
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">dn: uid=vivanov,ou=Users,ou=esme,dc=lester,dc=org </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">objectClass: organizationalPerson </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">objectClass: person </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">objectClass: uidObject </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">objectClass: inetOrgPerson </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">objectClass: top </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">cn: vivanov </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">givenName: Vladimir </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">mail: vivanov@lester.org </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">ou: Users </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">sn: Ivanov </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">telephoneNumber: +7 111 222 33 44 </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">uid: vivanov </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">userPassword:: cXdlcnR5 </span></p>
</blockquote>
<p class=" "><em><span> </span></em></p>
<p class=" "><span>There is also a special user with administrative rights: <em>uid=admin,ou=system<br />
</em>(default password: <em>secret</em>) defined in <em>system</em> schema. It was<br />
used to connect to ADS from JXplorer.</span></p>
<p class=" "><span> </span></p>
<p class=" "><span>Those were all basic steps necessary to configure ADS for purpose of<br />
this b log. Let's move to the configuration of the web servers.</span></p>
<h2><span>Configuration</span></h2>
<p class=" "><strong><span> </span></strong></p>
<p class=" "><span>Before digging into the configuration details specific for each web<br />
server, let's review the common properties used to connect to the LDAP server.</span></p>
<p class=" "><span> </span></p>
<p class=" "><span>First of all, it is necessary to specify the hostname / ip address and the<br />
port of our LDAP server &mdash; <em>localhost:10389</em>, as well as the credentials<br />
for an account that has rights to perform search operation and get attributes<br />
for users and roles in a directory tree. The special <em>admin</em> user<br />
described in previous section was also used for this purpose in this blog.<br />
Sometimes anonymous access is also permitted.</span></p>
<p class=" "><span> </span></p>
<p class=" "><span>The next set of properties, user base and group base, specify the base<br />
context with which to lookup users and groups. For our configuration web server<br />
will search users under <em>ou=Users,ou=esme,dc=lester,dc=org</em> and groups<br />
under <em>ou=Groups,ou=esme,dc=lester,dc=org</em> paths in the directory tree<br />
accordingly.<span> </span></span></p>
<p class=" "><span> </span></p>
<p class=" "><span>The user id and role name attributes specify the prefix for user/group<br />
search filter. In our example, it has the <span> </span><em>uid</em> value for users and the <em>cn </em>value<br />
for groups.</span></p>
<p class=" "><span> </span></p>
<p class=" "><span>The <em>uniqueMember</em> attribute is<br />
used to check whether the user belongs to the specified group.</span></p>
<p class=" "><span> </span></p>
<p class=" "><span>Now it is time to review the configuration for each of the web servers.</span></p>
<p class=" "><span> </span></p>
<p class=" "><strong><span>Note:</span></strong><span> The required <em>lift-ldap</em><br />
dependency has been already included in <em>pom.xml</em>.</span></p>
<h3><span>Jetty</span></h3>
<p class=" "><span>In order to configure Jetty to use LDAP server, two additional Maven<br />
dependencies: <em>jetty-plus</em> and <em>jetty-ldap-jaas</em> should be added to<br />
the <em>pom.xml </em><span>file</span>.<br />
Configuration of <em>maven-jetty-plugin </em>includes the following steps: set the<br />
<em>JAASUserRealm<strong> </strong></em>as an user realm implementation and specify the <span> </span><em>ldaploginmodule </em>as the login module<br />
name. It is also necessary to set the system property <em>java.security.auth.login.config<br />
</em>with the<em> ldap-loginModule.conf </em>value:</span></p>
<p class=" "><span> </span></p>
<p class=" "><u><span>pom.xml</span></u></p>
<p class=" "><u><span> </span></u></p>
<blockquote class="webkit-indent-blockquote" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 40px; border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; ">
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "><dependency></span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "><groupId>org.mortbay.jetty</groupId></span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "><artifactId>jetty-plus</artifactId></span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "><version>[6.1.6,)</version></span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "><scope>compile</scope></span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "></dependency></span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "><dependency></span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "><groupId>org.mortbay.jetty</groupId></span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "><artifactId><strong>jetty-ldap-jaas</strong></artifactId></span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "><version>[6.1.6,)</version></span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "><scope>compile</scope></span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "></dependency></span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">
<plugin></span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "><groupId>org.mortbay.jetty</groupId></span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "><artifactId>maven-jetty-plugin</artifactId></span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "><configuration></span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "><contextPath>/</contextPath></span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "><scanIntervalSeconds>0</scanIntervalSeconds></span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "><userRealms></span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "><userRealm<br />
implementation="org.mortbay.jetty.plus.jaas.JAASUserRealm"></span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "><name>ESMERealm</name></span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "><loginModuleName><strong>ldaploginmodule</strong></loginModuleName></span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "></userRealm></span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "></userRealms></span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "><systemProperties></span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "><systemProperty></span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "><name>java.security.auth.login.config</name></span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "><value>ldap-loginModule.conf</value></span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "></systemProperty></span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "></systemProperties></span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "></configuration></span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "></plugin></span></p>
</blockquote>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "> </span></p>
<p class=" "><em><span> </span></em></p>
<p class=" "><span>The file <em>ldap-loginModule.conf</em> is placed under the <em>ESME_ROOT/server</em><br />
folder. It specifies login module implementation class - <em>LdapLoginModule </em>as<br />
well as LDAP-specific connection properties:</span></p>
<p class=" "><span> </span></p>
<p class=" "><u><span>ldap-loginModule.conf</span></u></p>
<p class=" "><u><span> </span></u></p>
<blockquote class="webkit-indent-blockquote" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 40px; border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; ">
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">ldaploginmodule {</span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">org.mortbay.jetty.plus.jaas.ldap.LdapLoginModule<br />
required</span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">debug="true"</span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">useLdaps="false"</span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">contextFactory="com.sun.jndi.ldap.LdapCtxFactory"</span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">hostname="localhost"</span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">port="10389"</span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">bindDn="uid=admin,ou=system"</span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">bindPassword="secret"</span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">authenticationMethod="simple"</span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">forceBindingLogin="false"</span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">userBaseDn="ou=Users,ou=esme,dc=lester,dc=org"</span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">userRdnAttribute="uid"</span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">userIdAttribute="uid"</span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">userPasswordAttribute="userPassword"</span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">userObjectClass="inetOrgPerson"</span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">roleBaseDn="ou=Groups,ou=esme,dc=lester,dc=org"</span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">roleNameAttribute="cn"</span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">roleMemberAttribute="uniqueMember"</span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">roleObjectClass="groupOfUniqueNames";</span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">};</span></p>
</blockquote>
<p class=" "><font face="'Courier New'"><span style="font-size: 12px; "><a name="id.85a2218e86a9"></a></span></font></p>
<p class=" "><em><span> </span></em></p>
<p class=" "><span>Note that for some environments <em>forceBindingLogin </em>attribute<em> </em>must<br />
also be set to <em>true</em>.</span></p>
<h3><span>Tomcat</span></h3>
<p class=" "><strong><span> </span></strong></p>
<p class=" "><span>The only required change in the Tomcat's <em>server.xml</em> configuration<br />
file (compared to the changes described in the last blog) is a different realm<br />
-<span> </span><em>JNDIRealm</em>. This realm is used<br />
to connect to LDAP server and search users/groups:</span></p>
<p class=" "><span> </span></p>
<p class=" "><u><span>server.xml</span></u></p>
<p class=" "><u><span> </span></u></p>
<blockquote class="webkit-indent-blockquote" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 40px; border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; ">
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">...</span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "><Realm<br />
className="org.apache.catalina.realm.JNDIRealm" </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">connectionName="uid=admin,ou=system" </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">connectionPassword="secret" </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">connectionURL="ldap://localhost:10389" debug="99" </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">referrals="follow" </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">roleBase="ou=Groups,ou=esme,dc=lester,dc=org" </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">roleName="cn" </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">roleSearch="(uniqueMember={0})" </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">roleSubtree="true" </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">userBase="ou=Users,ou=esme,dc=lester,dc=org" </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">userSearch="(uid={0})" </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">userSubtree="true"/> </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">&hellip;</span></p>
</blockquote>
<p class=" "><span> </span></p>
<h3><span>LDAPVendor and ESMELdap.properties<br />
file</span></h3>
<p class=" "><strong><span> </span></strong></p>
<p class=" "><span>The web server is now configured to perform CMA. But the Servlet API<br />
makes only the user principal available for application. In order to fill ESME<br />
user's profile, additional attributes such as firstname, lastname and email are<br />
needed. We will use LDAP server to retrieve these attributes. Let's review<br />
changes in UserAuth.scala, specifically in <em>ContainerManagedAuthModule </em>object:</span></p>
<p class=" "><span> </span></p>
<p class=" "><u><span>UserAuth.scala</span></u></p>
<p class=" "><u><span> </span></u></p>
<p class=" "><span>To connect to the LDAP server from application first of all, <span> </span>it is necessary to create aq subclass of <em>net.lift.ldap.LDAPVendor</em><br />
class:</span></p>
<p class=" "><span> </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>object<br />
myLdapVendor extends LDAPVendor</span></p>
<p class=" "><em><span> </span></em></p>
<p class=" "><span>All LDAP-specific connection properties are placed into a resource<br />
bundle &mdash; plaintext property file with key-value pairs. It is possible to get<br />
property values by key with the <em>S.?</em> method:</span></p>
<p class=" "><span> </span></p>
<blockquote class="webkit-indent-blockquote" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 40px; border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; ">
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">def myLdap :<br />
LDAPVendor = {</span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">val<br />
ldapSrvHost = S.?("ldap.server.host")</span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">val<br />
ldapSrvPort = S.?("ldap.server.port")</span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">val<br />
ldapSrvBase = S.?("ldap.server.base")</span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">val<br />
ldapSrvUsrName = S.?("ldap.server.userName")</span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">val<br />
ldapSrvPwd = S.?("ldap.server.password")</span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">val<br />
ldapSrvAuthType = S.?("ldap.server.authType")</span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">val<br />
ldapSrvReferral= S.?("ldap.server.referral")</span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">val<br />
ldapSrvCtxFactory = S.?("ldap.server.initial_context_factory")</span></p>
</blockquote>
<p class=" "><em><span> </span></em></p>
<p class=" "><span>The next step is to configure the <em>LDAPVendor </em>subclass with these<br />
values:</span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "> </span></p>
<blockquote class="webkit-indent-blockquote" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 40px; border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; ">
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">myLdapVendor.configure(Map("ldap.url" -><br />
"ldap://%s:%s".format(ldapSrvHost, ldapSrvPort),</span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">"ldap.base" -> ldapSrvBase,</span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">"ldap.userName" -> ldapSrvUsrName,</span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">"ldap.password" -><br />
ldapSrvPwd,</span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">"ldap.authType" -> ldapSrvAuthType,</span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">"referral" -> ldapSrvReferral,</span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">"ldap.initial_context_factory" -> ldapSrvCtxFactory))</span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">myLdapVendor</span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">}</span></p>
</blockquote>
<p class=" "><em><span> </span></em></p>
<p class=" "><span>The method <em>getAttrs</em> takes the username as a parameter and returns<br />
a map of [attribute name / list of attribute values] pairs (attribute in LDAP<br />
might contain more than one value) for this user. Let's review the method<br />
definition. It is possible to get attributes for user with <em>LDAPVendor.attributesFromDn()</em><br />
method.<span> </span>It takes the distinguished name<br />
as a parameter, so it is necessary to append the prefix and the user base from the<br />
property file to the username to construct it. Note that the <em>attributesFromDn</em><br />
method returns <em>javax.naming.directory.Attributes</em> therefore the interfaces<br />
from <a name="id.e82d238b7d29"></a><em>javax.naming.directory </em>package must be<br />
imported correctly:</span></p>
<p class=" "><span> </span></p>
<blockquote class="webkit-indent-blockquote" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 40px; border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; ">
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">import _root_.javax.naming.directory.{Attributes,<br />
Attribute => Attr}</span></p>
</blockquote>
<p class=" "><em><span> </span></em></p>
<p class=" "><span>The shorthand <em>Attr </em>is used for the <em>javax.naming.directory.Attribute</em><br />
because the <em>scala.xml.Attribute</em> trait<em> </em>has already been imported<br />
and placed in scope.</span></p>
<p class=" "><span> </span></p>
<p class=" "><span>Then attribute's id and values are used to populate the result map. </span></p>
<p class=" "><span> </span></p>
<p class=" "><span>The<em> getAttrs</em></span><span> method definition<br />
is shown below:<span> </span><em></em></span></p>
<p class=" "><span> </span></p>
<blockquote class="webkit-indent-blockquote" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 40px; border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; ">
<p class=" "><font face="'Courier New'"><span style="font-size: 12px; "> </span></font></p>
<p class="MsoNormal"><font face="'Courier New'"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>def<br />
getAttrs(who : String) : Map[String, List[String]] = {<o:p /></span></font></p>
<p><font face="'Courier New'"> </p>
<p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><o:p> </o:p></span></p>
<p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>val<br />
uidPrefix = S.?("ldap.uidPrefix")<o:p /></span></p>
<p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>val userBase<br />
= S.?("ldap.userBase")<o:p /></span></p>
<p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><o:p> </o:p></span></p>
<p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>var attrsMap<br />
= Map.empty[String, List[String]]<o:p /></span></p>
<p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>val dn =<br />
"%s=%s,%s".format(uidPrefix, who, userBase)<o:p /></span></p>
<p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><o:p> </o:p></span></p>
<p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>val attrs :<br />
Attributes = myLdap.attributesFromDn(dn)<o:p /></span></p>
<p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>if (attrs !=<br />
null) {<o:p /></span></p>
<p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>val<br />
allAttrs = attrs.getAll();<o:p /></span></p>
<p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>if<br />
(allAttrs != null) {<o:p /></span></p>
<p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>while(allAttrs.hasMore()) {<o:p /></span></p>
<p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>val<br />
attribute = allAttrs.next().asInstanceOf[Attr];<o:p /></span></p>
<p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>var<br />
attrValues = List.empty[String]<o:p /></span></p>
<p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>for(i<br />
<- 0 until attribute.size()) {<o:p /></span></p>
<p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>attrValues ::= attribute.get(i).toString<o:p /></span></p>
<p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>}<o:p /></span></p>
<p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>attrsMap += (attribute.getID() -> attrValues)<o:p /></span></p>
<p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>}<o:p /></span></p>
<p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>}<o:p /></span></p>
<p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>}<o:p /></span></p>
<p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>attrsMap<o:p /></span></p>
<p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>}<o:p /></span></p>
<p></font> </p>
</blockquote>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "> </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "> </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "> </span></p>
<p class=" "><em><span> </span></em></p>
<p class=" "><span>The last step is to modify the <em>performInit</em> method. First of all, it<br />
is necessary to check if LDAP is enabled as configured in the property file.<br />
Then the values for attributes <em>givenName</em>, <em>sn</em> and <em>mail</em> are<br />
extracted from the map, returned via the <em>getAttrs</em> method call and then used<br />
to populate <em>User</em> instance.</span></p>
<p class=" "><span> </span></p>
<p class=" "><font face="'Courier New'"> </font></p>
<p class="MsoNormal" style="font-size: 12px; "><font face="'Courier New'"><span style="font-size: 9pt; font-family: 'Courier New'; ">def performInit(): Unit = {<o:p /></span></font></p>
<p><font face="'Courier New'"><span style="font-size: 12px; "> </span> </p>
<p class="MsoNormal" style="font-size: 12px; "><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>...<o:p /></span></p>
<p><span style="font-size: 12px; "> </span> </p>
<p class="MsoNormal" style="font-size: 12px; "><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>val usr =<br />
User.createAndPopulate.nickname(username).saveMe<o:p /></span></p>
<p><span style="font-size: 12px; "> </span> </p>
<p class="MsoNormal" style="font-size: 12px; "><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>//find and<br />
save additional attributes in LDAP if It is enabled<o:p /></span></p>
<p><span style="font-size: 12px; "> </span> </p>
<p class="MsoNormal" style="font-size: 12px; "><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>val<br />
ldapEnabled = S.?("ldap.enabled")<o:p /></span></p>
<p><span style="font-size: 12px; "> </span> </p>
<p class="MsoNormal" style="font-size: 12px; "><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>if(ldapEnabled.toBoolean) {<o:p /></span></p>
<p><span style="font-size: 12px; "> </span> </p>
<p class="MsoNormal" style="font-size: 12px; "><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>val<br />
ldapAttrs = getAttrs(username)<o:p /></span></p>
<p><span style="font-size: 12px; "> </span> </p>
<p class="MsoNormal" style="font-size: 12px; "><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>val<br />
firstName = ldapAttrs("givenName").head<o:p /></span></p>
<p><span style="font-size: 12px; "> </span> </p>
<p class="MsoNormal" style="font-size: 12px; "><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>val<br />
lastName = ldapAttrs("sn").head<o:p /></span></p>
<p><span style="font-size: 12px; "> </span> </p>
<p class="MsoNormal" style="font-size: 12px; "><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>val mail<br />
= ldapAttrs("mail").head<o:p /></span></p>
<p><span style="font-size: 12px; "> </span> </p>
<p class="MsoNormal" style="font-size: 12px; "><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>usr.firstName(firstName).lastName(lastName).save<o:p /></span></p>
<p><span style="font-size: 12px; "> </span> </p>
<p class="MsoNormal" style="font-size: 12px; "><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>}<o:p /></span></p>
<p><span style="font-size: 12px; "> </span> </p>
<p class="MsoNormal" style="font-size: 12px; "><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>...<o:p /></span></p>
<p><span style="font-size: 12px; "> </span> </p>
<p class="MsoNormal" style="font-size: 12px; "><span style="font-size: 9pt; font-family: 'Courier New'; ">}<o:p /></span></p>
<p></font> </p>
<p class=" "><em><span> </span></em></p>
<p class=" "><span>The<em> ESMELdap </em></span><span>property file is<br />
shown below. It essentially resembles connection properties in web server<br />
configuration files that we have seen previously.<em></em></span></p>
<p class=" "><span> </span></p>
<p class=" "><u><span>ESMELdap.properties file</span></u></p>
<p class=" "><u><span> </span></u></p>
<blockquote class="webkit-indent-blockquote" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 40px; border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; ">
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">#This flag specifies whether LDAP should be used </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">ldap.enabled=true </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "># Hostname or IP of LDAP server </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">ldap.server.host=localhost </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "># Port<br />
 of LDAP server </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">ldap.server.port=10389 </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "># Base DN from the LDAP Server </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">ldap.server.base=ou=esme,dc=lester,dc=org </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "># User that has access to LDAP server to perform<br />
search operations </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">ldap.server.userName=uid=admin,ou=system </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "># Password for user above </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">ldap.server.password=secret </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "># Authentication type </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">ldap.server.authType=simple </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "># Referral </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">ldap.server.referral=follow </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "># Initial context factory class </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">ldap.server.initial_context_factory=com.sun.jndi.ldap.LdapCtxFactory<br />
</span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "># Prefix for user to whom additional LDAP attributes<br />
belong, for example 'uid' or 'sAMAccountName' </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">ldap.cnPrefix=uid </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "># User base DN for user to whom additional LDAP<br />
attributes belong </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">ldap.userBase=ou=Users,ou=esme,dc=lester,dc=org</span></p>
</blockquote>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "> </span></p>
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "> </span></p>
<p class=" "><em><span> </span></em></p>
<p class=" "><span>The last thing that must be done is to tell Lift where to look for the <em>ESMELdap.properties</em><br />
file. The list of resource file names is assigned to <em>LiftRules.resourceNames<br />
</em>var<em> </em>in<em> Boot.scala</em>:</span></p>
<p class=" "><span> </span></p>
<p class=" "><u><span>Boot.scala</span></u></p>
<p class=" "><u><span> </span></u></p>
<blockquote class="webkit-indent-blockquote" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 40px; border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; ">
<p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">LiftRules.resourceNames = "ESMELdap" :: "ESMECustom"<br />
:: "ESMEBase" :: "ESMEUI" :: Nil</span></p>
</blockquote>
<p class=" "><em><span> </span></em></p>
<h2><span>Conclusion</span></h2>
<p class=" "><strong><span> </span></strong></p>
<p class=" "><span>We have just configured both web servers - Jetty and Tomcat - to perform<br />
authentication and authorization via LDAP. We have also improved <em>ContainerManagedAuthModule</em><br />
to get additional attributes for authenticated user from LDAP with Lift LDAP<br />
API.</span></p>
<p class=" "><span> </span></p>
<h2><span>Links</span></h2>
<p class=" " style="margin-left: 0cm; text-indent: 0cm; "><!--[if !supportLists]--><strong><span style="font-size: 10pt; font-family: 'Times New Roman'; "><span>1.<span style="font: normal normal normal 7pt/normal 'Times New Roman'; "> </span></span></span></strong><!--[endif]--><strong><span>Apache Directory Server: </span></strong><span><a href="http://directory.apache.org/apacheds/1.5/"><span style="color: black; text-decoration: none; ">http</span></a><a href="http://directory.apache.org/apacheds/1.5/"><span style="color: black; text-decoration: none; ">://</span></a><a href="http://directory.apache.org/apacheds/1.5/"><span style="color: black; text-decoration: none; ">directory</span></a><a href="http://directory.apache.org/apacheds/1.5/"><span style="color: black; text-decoration: none; ">.</span></a><a href="http://directory.apache.org/apacheds/1.5/"><span style="color: black; text-decoration: none; ">apache</span></a><a href="http://directory.apache.org/apacheds/1.5/"><span style="color: black; text-decoration: none; ">.</span></a><a href="http://directory.apache.org/apacheds/1.5/"><span style="color: black; text-decoration: none; ">org</span></a><a href="http://directory.apache.org/apacheds/1.5/"><span style="color: black; text-decoration: none; ">/</span></a><a href="http://directory.apache.org/apacheds/1.5/"><span style="color: black; text-decoration: none; ">apacheds</span></a><a href="http://directory.apache.org/apacheds/1.5/"><span style="color: black; text-decoration: none; ">/1.5/</span></a></span><strong><span></span></strong></p>
<p class=" " style="margin-left: 0cm; text-indent: 0cm; "><!--[if !supportLists]--><strong><span style="font-size: 10pt; font-family: 'Times New Roman'; "><span>2.<span style="font: normal normal normal 7pt/normal 'Times New Roman'; "> </span></span></span></strong><!--[endif]--><strong><span>Jxplorer: </span></strong><span><a href="http://jxplorer.org/"><span style="color: black; text-decoration: none; ">http</span></a><a href="http://jxplorer.org/"><span style="color: black; text-decoration: none; ">://</span></a><a href="http://jxplorer.org/"><span style="color: black; text-decoration: none; ">jxplorer</span></a><a href="http://jxplorer.org/"><span style="color: black; text-decoration: none; ">.</span></a><a href="http://jxplorer.org/"><span style="color: black; text-decoration: none; ">org</span></a><a href="http://jxplorer.org/"><span style="color: black; text-decoration: none; ">/</span></a></span><strong><span></span></strong></p>
<p class=" " style="margin-left: 0cm; text-indent: 0cm; "><!--[if !supportLists]--><strong><span style="font-size: 10pt; font-family: 'Times New Roman'; "><span>3.<span style="font: normal normal normal 7pt/normal 'Times New Roman'; "> </span></span></span></strong><!--[endif]--><strong><span>Jetty login modules:&nbsp;</span></strong><a href="http://docs.codehaus.org/display/JETTY/JAAS"><span style="color: black; text-decoration: none; ">http</span></a><a href="http://docs.codehaus.org/display/JETTY/JAAS"><span style="color: black; text-decoration: none; ">://</span></a><a href="http://docs.codehaus.org/display/JETTY/JAAS"><span style="color: black; text-decoration: none; ">docs</span></a><a href="http://docs.codehaus.org/display/JETTY/JAAS"><span style="color: black; text-decoration: none; ">.</span></a><a href="http://docs.codehaus.org/display/JETTY/JAAS"><span style="color: black; text-decoration: none; ">codehaus</span></a><a href="http://docs.codehaus.org/display/JETTY/JAAS"><span style="color: black; text-decoration: none; ">.</span></a><a href="http://docs.codehaus.org/display/JETTY/JAAS"><span style="color: black; text-decoration: none; ">org</span></a><a href="http://docs.codehaus.org/display/JETTY/JAAS"><span style="color: black; text-decoration: none; ">/</span></a><a href="http://docs.codehaus.org/display/JETTY/JAAS"><span style="color: black; text-decoration: none; ">display</span></a><a href="http://docs.codehaus.org/display/JETTY/JAAS"><span style="color: black; text-decoration: none; ">/</span></a><a href="http://docs.codehaus.org/display/JETTY/JAAS"><span style="color: black; text-decoration: none; ">JETTY</span></a><a href="http://docs.codehaus.org/display/JETTY/JAAS"><span style="color: black; text-decoration: none; ">/</span></a><a href="http://docs.codehaus.org/display/JETTY/JAAS"><span style="color: black; text-decoration: none; ">JAAS</span></a></p>
<p class=" "><span></span></p>
<p class=" "><span><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">http</span></a><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">://</span></a><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">jetty</span></a><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">.</span></a><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">codehaus</span></a><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">.</span></a><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">org</span></a><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">/</span></a><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">jetty</span></a><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">/</span></a><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">jetty</span></a><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">-6/</span></a><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">apidocs</span></a><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">/</span></a><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">org</span></a><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">/</span></a><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">mortbay</span></a><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">/</span></a><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">jetty</span></a><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">/</span></a><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">plus</span></a><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">/</span></a><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">jaas</span></a><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">/</span></a><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">ldap</span></a><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">/</span></a><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">LdapLoginModule</span></a><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">.</span></a><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">html</span></a></span><span></span></p>
<p class=" " style="margin-left: 0cm; text-indent: 0cm; "><!--[if !supportLists]--><strong><span style="font-size: 10pt; font-family: 'Times New Roman'; "><span>4.<span style="font: normal normal normal 7pt/normal 'Times New Roman'; "> </span></span></span></strong><!--[endif]--><strong><span>Tomcat user realms: </span></strong><span><a href="http://tomcat.apache.org/tomcat-6.0-doc/realm-howto.html"><span style="color: black; text-decoration: none; ">http</span></a><a href="http://tomcat.apache.org/tomcat-6.0-doc/realm-howto.html"><span style="color: black; text-decoration: none; ">://</span></a><a href="http://tomcat.apache.org/tomcat-6.0-doc/realm-howto.html"><span style="color: black; text-decoration: none; ">tomcat</span></a><a href="http://tomcat.apache.org/tomcat-6.0-doc/realm-howto.html"><span style="color: black; text-decoration: none; ">.</span></a><a href="http://tomcat.apache.org/tomcat-6.0-doc/realm-howto.html"><span style="color: black; text-decoration: none; ">apache</span></a><a href="http://tomcat.apache.org/tomcat-6.0-doc/realm-howto.html"><span style="color: black; text-decoration: none; ">.</span></a><a href="http://tomcat.apache.org/tomcat-6.0-doc/realm-howto.html"><span style="color: black; text-decoration: none; ">org</span></a><a href="http://tomcat.apache.org/tomcat-6.0-doc/realm-howto.html"><span style="color: black; text-decoration: none; ">/</span></a><a href="http://tomcat.apache.org/tomcat-6.0-doc/realm-howto.html"><span style="color: black; text-decoration: none; ">tomcat</span></a><a href="http://tomcat.apache.org/tomcat-6.0-doc/realm-howto.html"><span style="color: black; text-decoration: none; ">-6.0-</span></a><a href="http://tomcat.apache.org/tomcat-6.0-doc/realm-howto.html"><span style="color: black; text-decoration: none; ">doc</span></a><a href="http://tomcat.apache.org/tomcat-6.0-doc/realm-howto.html"><span style="color: black; text-decoration: none; ">/</span></a><a href="http://tomcat.apache.org/tomcat-6.0-doc/realm-howto.html"><span style="color: black; text-decoration: none; ">realm</span></a><a href="http://tomcat.apache.org/tomcat-6.0-doc/realm-howto.html"><span style="color: black; text-decoration: none; ">-</span></a><a href="http://tomcat.apache.org/tomcat-6.0-doc/realm-howto.html"><span style="color: black; text-decoration: none; ">howto</span></a><a href="http://tomcat.apache.org/tomcat-6.0-doc/realm-howto.html"><span style="color: black; text-decoration: none; ">.</span></a><a href="http://tomcat.apache.org/tomcat-6.0-doc/realm-howto.html"><span style="color: black; text-decoration: none; ">html</span></a></span><strong><span></span></strong></p>
<p><strong><span style="font-size: 10pt; font-family: 'Times New Roman'; "><span>5.<span style="font: normal normal normal 7pt/normal 'Times New Roman'; "> </span></span></span></strong><strong><span>Lift API:</span></strong><span> </span><span><a href="http://scala-tools.org/mvnsites/liftweb-2.3/"><span style="color: black; text-decoration: none; ">http</span></a><a href="http://scala-tools.org/mvnsites/liftweb-2.3/"><span style="color: black; text-decoration: none; ">://</span></a><a href="http://scala-tools.org/mvnsites/liftweb-2.3/"><span style="color: black; text-decoration: none; ">scala</span></a><a href="http://scala-tools.org/mvnsites/liftweb-2.3/"><span style="color: black; text-decoration: none; ">-</span></a><a href="http://scala-tools.org/mvnsites/liftweb-2.3/"><span style="color: black; text-decoration: none; ">tools</span></a><a href="http://scala-tools.org/mvnsites/liftweb-2.3/"><span style="color: black; text-decoration: none; ">.</span></a><a href="http://scala-tools.org/mvnsites/liftweb-2.3/"><span style="color: black; text-decoration: none; ">org</span></a><a href="http://scala-tools.org/mvnsites/liftweb-2.3/"><span style="color: black; text-decoration: none; ">/</span></a><a href="http://scala-tools.org/mvnsites/liftweb-2.3/"><span style="color: black; text-decoration: none; ">mvnsites</span></a><a href="http://scala-tools.org/mvnsites/liftweb-2.3/"><span style="color: black; text-decoration: none; ">/</span></a><a href="http://scala-tools.org/mvnsites/liftweb-2.3/"><span style="color: black; text-decoration: none; ">liftweb</span></a><a href="http://scala-tools.org/mvnsites/liftweb-2.3/"><span style="color: black; text-decoration: none; ">-2.3/</span></a></span> </p></p></p>

  </div><a class="u-url" href="/esme/entry/test" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Blogs Archive</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Blogs Archive</li><li><a class="u-email" href="mailto:issues@infra.apache.org">issues@infra.apache.org</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/jekyll"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">jekyll</span></a></li><li><a href="https://www.twitter.com/jekyllrb"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">jekyllrb</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>This is an archive of the Roller blogs that were previously hosted on blogs.apache.org</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
