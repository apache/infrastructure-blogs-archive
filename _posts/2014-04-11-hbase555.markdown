---
layout: post
title: The Effect of ColumnFamily, RowKey and KeyValue Design on HFile Size
date: '2014-04-11T18:29:54+00:00'
categories: hbase
---
<p>By Doug Meil, HBase Committer and Thomas Murphy</p> 
  <p> </p> 
  <p style="margin-bottom: 0in; line-height: 100%;"><i><b>Intro</b></i></p> 
  <p style="margin-bottom: 0in; line-height: 100%;"><span style="line-height: 100%;">One of the most
common questions in the HBase user community is estimating disk
footprint of tables, which translates into HFile size – the
internal file format in HBase.</span></p> 
  <p style="margin-bottom: 0in; line-height: 100%;"><span style="line-height: 100%;">We designed an
experiment at Explorys where we ran combinations of design time
options (rowkey length, column name length, row storage approach) and
runtime options (HBase ColumnFamily compression, HBase data block
encoding options) to determine these factors’ effects on the
resultant HFile size in HDFS.</span></p> 
  <p> </p> 
  <p style="margin-bottom: 0in; line-height: 100%;"><b>HBase Environment</b></p> 
  <p style="margin-bottom: 0in; line-height: 100%;">CDH4.3.0 (HBase
0.94.6.1)</p> 
  <p style="margin-bottom: 0in; line-height: 100%;"><b>Design Time
Choices</b></p> 
  <ol> 
    <li> 
      <p style="margin-bottom: 0in; line-height: 100%;"><u>Rowkey</u></p> 
      <ol type="a"> 
        <li> 
          <p style="margin-bottom: 0in; line-height: 100%;">Thin</p> 
          <ol type="i"> 
            <li> 
              <p style="margin-bottom: 0in; line-height: 100%;">16-byte MD5
			hash of an integer.  
			</p> 
            </li> 
          </ol> 
        </li> 
        <li> 
          <p style="margin-bottom: 0in; line-height: 100%;">Fat 
		</p> 
          <ol type="i"> 
            <li> 
              <p style="margin-bottom: 0in; line-height: 100%;">64-byte
			SHA-256 hash of an integer.</p> 
            </li> 
          </ol> 
        </li> 
      </ol> 
    </li> 
  </ol> 
  <ol> 
    <ol type="a" start="3"> 
      <li> 
        <p style="margin-bottom: 0in; line-height: 100%;">Note:  neither
		of these are realistic rowkeys for real applications, but they
		chosen because they are easy to generate and one is a lot bigger
		than the other.</p> 
      </li> 
    </ol> 
  </ol> 
  <ol start="2"> 
    <li> 
      <p style="margin-bottom: 0in; line-height: 100%;"><u>Column Names</u></p> 
      <ol type="a"> 
        <li> 
          <p style="margin-bottom: 0in; line-height: 100%;">Thin</p> 
          <ol type="i"> 
            <li> 
              <p style="margin-bottom: 0in; line-height: 100%;">2-3 character
			column names (c1, c2).</p> 
            </li> 
          </ol> 
        </li> 
        <li> 
          <p style="margin-bottom: 0in; line-height: 100%;">Fat</p> 
          <ol type="i"> 
            <li> 
              <p style="margin-bottom: 0in; line-height: 100%;">10
			characters, randomly chosen but consistent for all rows.</p> 
            </li> 
          </ol> 
        </li> 
      </ol> 
    </li> 
  </ol> 
  <ol> 
    <ol type="a" start="3"> 
      <li> 
        <p style="margin-bottom: 0in; line-height: 100%;">Note:  it is
		advisable to have small column names, but most people don’t start
		that way so we have this as an option.</p> 
      </li> 
    </ol> 
  </ol> 
  <ol start="3"> 
    <li> 
      <p style="margin-bottom: 0in; line-height: 100%;"><u>Row Storage
	Approach</u></p> 
      <ol type="a"> 
        <li> 
          <p style="margin-bottom: 0in; line-height: 100%;">Key Value Per
		Column</p> 
          <ol type="i"> 
            <li> 
              <p style="margin-bottom: 0in; line-height: 100%;">This is the
			traditional way of storing data in HBase.</p> 
            </li> 
          </ol> 
        </li> 
        <li> 
          <p style="margin-bottom: 0in; line-height: 100%;">One Key Value
		per row.</p> 
          <ol type="i"> 
            <li> 
              <p style="margin-bottom: 0in; line-height: 100%;">Actually,
			two.  
			</p> 
            </li> 
            <li> 
              <p style="margin-bottom: 0in; line-height: 100%;">One KV has an
			Avro serialized byte array containing all the data from the row.</p> 
            </li> 
            <li> 
              <p style="margin-bottom: 0in; line-height: 100%;">Another KV
			holds an MD5 hash of the version of the Avro schema.</p> 
            </li> 
          </ol> 
        </li> 
      </ol> 
    </li> 
  </ol> 
  <p style="margin-bottom: 0in; line-height: 100%;"><b>Run Time</b></p> 
  <ol> 
    <li> 
      <p style="margin-bottom: 0in; line-height: 100%;"><u>Column
	Family Compression</u></p> 
      <ol type="a"> 
        <li> 
          <p style="margin-bottom: 0in; line-height: 100%;">None</p> 
        </li> 
        <li> 
          <p style="margin-bottom: 0in; line-height: 100%;">GZ</p> 
        </li> 
        <li> 
          <p style="margin-bottom: 0in; line-height: 100%;">LZ4</p> 
        </li> 
        <li> 
          <p style="margin-bottom: 0in; line-height: 100%;">LZO</p> 
        </li> 
        <li> 
          <p style="margin-bottom: 0in; line-height: 100%;">Snappy</p> 
        </li> 
      </ol> 
    </li> 
  </ol> 
  <p style="margin-left: 1in; margin-bottom: 0in; line-height: 100%;"><br /> </p> 
  <ol> 
    <ol type="a" start="6"> 
      <li> 
        <p style="margin-bottom: 0in; line-height: 100%;">Note:  it is
		generally advisable to use compression, but what if you didn’t? 
		So we tested that too.</p> 
      </li> 
    </ol> 
  </ol> 
  <ol start="2"> 
    <li> 
      <p style="margin-bottom: 0in; line-height: 100%;"><u>HBase Block
	Encoding</u></p> 
      <ol type="a"> 
        <li> 
          <p style="margin-bottom: 0in; line-height: 100%;">None</p> 
        </li> 
        <li> 
          <p style="margin-bottom: 0in; line-height: 100%;">Prefix</p> 
        </li> 
        <li> 
          <p style="margin-bottom: 0in; line-height: 100%;">Diff</p> 
        </li> 
        <li> 
          <p style="margin-bottom: 0in; line-height: 100%;">Fast Diff</p> 
        </li> 
      </ol> 
    </li> 
  </ol> 
  <ol> 
    <ol type="a" start="5"> 
      <li> 
        <p style="margin-bottom: 0in; line-height: 100%;">Note:  most
		people aren’t familiar with HBase Data Block Encoding.  Primarily
		intended for squeezing more data into the block cache, it has
		effects on HFile size too.  See HBASE-4218 for more detail.</p> 
      </li> 
    </ol> 
  </ol> 
  <p style="margin-bottom: 0in; line-height: 100%;">1000 rows were
generated for each combination of table parameters.  Not a ton of
data, but we don’t necessarily need a ton of data to see the
varying size of the table.  There were 30 columns per row comprised
of 10 strings (each filled with 20 bytes of random characters), 10
integers (random numbers) and 10 longs (also random numbers).</p> 
  <p style="margin-bottom: 0in; line-height: 100%;">HBase blocksize was
128k.</p> 
  <p style="margin-bottom: 0in; line-height: 100%;"><br /></p> 
  <p style="margin-bottom: 0in; line-height: 100%;"><i><b>Results</b></i></p> 
  <p style="margin-bottom: 0in; line-height: 100%;">The easiest way to
navigate the results is to compare specific cases, progressing from
an initial implementation of a table to options for production.</p> 
  <p style="margin-bottom: 0in; line-height: 100%;"><b>Case #1:  Fat
Rowkey and Fat Column Names, Now What?</b></p> 
  <p style="margin-bottom: 0in; line-height: 100%;">This is where most
people start with HBase.  Rowkeys are not as optimal as they should
be (i.e., the Fat rowkey case) and column names are also inflated
(Fat column-names).</p> 
  <p style="margin-bottom: 0in; line-height: 100%;">Without CF
Compression or Data Block Encoding, the baseline is:</p> 
  <table width="712" cellpadding="8" cellspacing="0"> <colgroup><col width="299" /> <col width="83" /> <col width="83" /> <col width="83" /> <col width="83" /> </colgroup> 
    <tbody> 
      <tr valign="bottom"> 
        <td width="299" height="7" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">psudorandom-table-R1000-i10-s10_20-l10-NONE-NONE-FATKEY-FATCOL</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">6,293,670</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1000</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">NONE</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">NONE</font></font></p> 
        </td> 
      </tr> 
    </tbody> 
  </table> 
  <p style="margin-bottom: 0in; line-height: 100%;"><i>What if we just
changed CF compression?</i></p> 
  <p style="margin-bottom: 0in; line-height: 100%;">This drastically
changes the HFile footprint.  Snappy compression reduces the HFile
size from 6.2 Mb to 1.8 Mb, for example.</p> 
  <table width="397" cellpadding="8" cellspacing="0"> <colgroup><col width="83" /> <col width="83" /> <col width="83" /> <col width="83" /> </colgroup> 
    <tbody> 
      <tr valign="bottom"> 
        <td width="83" height="7" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1,362,033</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1000</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">GZ</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">NONE</font></font></p> 
        </td> 
      </tr> 
      <tr valign="bottom"> 
        <td width="83" height="7" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1,803,240</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1000</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">SNAPPY</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">NONE</font></font></p> 
        </td> 
      </tr> 
      <tr valign="bottom"> 
        <td width="83" height="7" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1,919,265</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1000</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">LZ4</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">NONE</font></font></p> 
        </td> 
      </tr> 
      <tr valign="bottom"> 
        <td width="83" height="7" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1,950,306</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1000</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">LZO</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">NONE</font></font></p> 
        </td> 
      </tr> 
    </tbody> 
  </table> 
  <p style="margin-bottom: 0in; line-height: 100%;">However, we
shouldn’t be <i>too</i> quick to celebrate.  Remember that this is
just the <i>disk</i> footprint.  Over the wire the data is
uncompressed, so 6.2 Mb is still being transferred from RegionServer
to Client when doing a Scan over the entire table.</p> 
  <p style="margin-bottom: 0in; line-height: 100%;"><i>What if we just
changed data block encoding?</i></p> 
  <p style="margin-bottom: 0in; line-height: 100%;">Compression isn’t
the only option though.   Even without compression, we can change the
data block encoding and also achieve HFile reduction.  All options
are an improvement over the 6.2 Mb baseline.</p> 
  <p style="margin-bottom: 0in; line-height: 100%;"><br /> </p> 
  <table width="397" cellpadding="8" cellspacing="0"> <colgroup><col width="83" /> <col width="83" /> <col width="83" /> <col width="83" /> </colgroup> 
    <tbody> 
      <tr valign="bottom"> 
        <td width="83" height="7" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1,491,000</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1000</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">NONE</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">DIFF</font></font></p> 
        </td> 
      </tr> 
      <tr valign="bottom"> 
        <td width="83" height="7" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1,492,155</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1000</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">NONE</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">FAST_DIFF</font></font></p> 
        </td> 
      </tr> 
      <tr valign="bottom"> 
        <td width="83" height="7" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">2,244,963</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1000</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">NONE</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">PREFIX</font></font></p> 
        </td> 
      </tr> 
    </tbody> 
  </table> 
  <p style="margin-bottom: 0in; line-height: 100%;"><i>Combination</i></p> 
  <p style="margin-bottom: 0in; line-height: 100%;">The following table
shows the results of all remaining CF compression / data block
encoding combinations.</p> 
  <table width="397" cellpadding="8" cellspacing="0"> <colgroup><col width="83" /> <col width="83" /> <col width="83" /> <col width="83" /> </colgroup> 
    <tbody> 
      <tr valign="bottom"> 
        <td width="83" height="7" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1,146,675</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1000</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">GZ</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">DIFF</font></font></p> 
        </td> 
      </tr> 
      <tr valign="bottom"> 
        <td width="83" height="7" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1,200,471</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1000</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">GZ</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">FAST_DIFF</font></font></p> 
        </td> 
      </tr> 
      <tr valign="bottom"> 
        <td width="83" height="7" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1,274,265</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1000</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">GZ</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">PREFIX</font></font></p> 
        </td> 
      </tr> 
      <tr valign="bottom"> 
        <td width="83" height="7" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1,350,483</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1000</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">SNAPPY</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">DIFF</font></font></p> 
        </td> 
      </tr> 
      <tr valign="bottom"> 
        <td width="83" height="7" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1,358,190</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1000</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">LZ4</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">DIFF</font></font></p> 
        </td> 
      </tr> 
      <tr valign="bottom"> 
        <td width="83" height="7" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1,391,016</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1000</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">SNAPPY</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">FAST_DIFF</font></font></p> 
        </td> 
      </tr> 
      <tr valign="bottom"> 
        <td width="83" height="7" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1,402,614</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1000</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">LZ4</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">FAST_DIFF</font></font></p> 
        </td> 
      </tr> 
      <tr valign="bottom"> 
        <td width="83" height="7" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1,406,334</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1000</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">LZO</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">FAST_DIFF</font></font></p> 
        </td> 
      </tr> 
      <tr valign="bottom"> 
        <td width="83" height="7" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1,541,151</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1000</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">SNAPPY</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">PREFIX</font></font></p> 
        </td> 
      </tr> 
      <tr valign="bottom"> 
        <td width="83" height="7" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1,597,440</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1000</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">LZO</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">PREFIX</font></font></p> 
        </td> 
      </tr> 
      <tr valign="bottom"> 
        <td width="83" height="7" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1,622,313</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1000</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">LZ4</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">PREFIX</font></font></p> 
        </td> 
      </tr> 
    </tbody> 
  </table> 
  <p style="margin-bottom: 0in; line-height: 100%;"><b>Case #2:  What if
we re-designed the column names (and left the rowkey alone)?</b></p> 
  <p style="margin-bottom: 0in; line-height: 100%;">Let’s assume that
we re-designed our column names but left the rowkey alone.  After
using the “thin” column-names without CF compression or data
block encoding it results in an HFile 5.8 Mb in size.  This is an
improvement from the original 6.2 Mb baseline.  It doesn’t seem
like much, but it’s still a 6.5% reduction in the eventual
wire-transfer footprint.</p> 
  <table width="712" cellpadding="8" cellspacing="0"> <colgroup><col width="299" /> <col width="83" /> <col width="83" /> <col width="83" /> <col width="83" /> </colgroup> 
    <tbody> 
      <tr valign="bottom"> 
        <td width="299" height="7" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">psudorandom-table-R1000-i10-s10_20-l10-NONE-NONE-FATKEY</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">5,778,888</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1000</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">NONE</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">NONE</font></font></p> 
        </td> 
      </tr> 
    </tbody> 
  </table> 
  <p style="margin-bottom: 0in; line-height: 100%;">Applying Snappy
compression can reduce the HFile size further:</p> 
  <table width="397" cellpadding="8" cellspacing="0"> <colgroup><col width="83" /> <col width="83" /> <col width="83" /> <col width="83" /> </colgroup> 
    <tbody> 
      <tr valign="bottom"> 
        <td width="83" height="7" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1,349,451</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1000</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">SNAPPY</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">DIFF</font></font></p> 
        </td> 
      </tr> 
      <tr valign="bottom"> 
        <td width="83" height="7" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1,390,422</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1000</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">SNAPPY</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">FAST_DIFF</font></font></p> 
        </td> 
      </tr> 
      <tr valign="bottom"> 
        <td width="83" height="7" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1,536,540</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1000</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">SNAPPY</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">PREFIX</font></font></p> 
        </td> 
      </tr> 
      <tr valign="bottom"> 
        <td width="83" height="7" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1,785,480</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1000</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">SNAPPY</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">NONE</font></font></p> 
        </td> 
      </tr> 
    </tbody> 
  </table> 
  <p style="margin-bottom: 0in; line-height: 100%;"><b>Case #3:  What if
we re-designed the rowkey (and left the column names alone)?</b></p> 
  <p style="margin-bottom: 0in; line-height: 100%;">In this example,
what if we only redesigned the rowkey?  After using the “thin”
rowkey the result is an HFile size that is 4.9 Mb down from the 6.2
Mb baseline, a 21% reduction.   Not a small savings!</p> 
  <table width="712" cellpadding="8" cellspacing="0"> <colgroup><col width="299" /> <col width="83" /> <col width="83" /> <col width="83" /> <col width="83" /> </colgroup> 
    <tbody> 
      <tr valign="bottom"> 
        <td width="299" height="7" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">psudorandom-table-R1000-i10-s10_20-l10-NONE-NONE-FATCOL</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">4,920,984</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1000</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">NONE</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">NONE</font></font></p> 
        </td> 
      </tr> 
    </tbody> 
  </table> 
  <p style="margin-bottom: 0in; line-height: 100%;">Applying Snappy
compression can reduce the HFile size further:</p> 
  <table width="397" cellpadding="8" cellspacing="0"> <colgroup><col width="83" /> <col width="83" /> <col width="83" /> <col width="83" /> </colgroup> 
    <tbody> 
      <tr valign="bottom"> 
        <td width="83" height="7" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1,295,895</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1000</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">SNAPPY</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">DIFF</font></font></p> 
        </td> 
      </tr> 
      <tr valign="bottom"> 
        <td width="83" height="7" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1,337,112</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1000</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">SNAPPY</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">FAST_DIFF</font></font></p> 
        </td> 
      </tr> 
      <tr valign="bottom"> 
        <td width="83" height="7" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1,489,446</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1000</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">SNAPPY</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">PREFIX</font></font></p> 
        </td> 
      </tr> 
      <tr valign="bottom"> 
        <td width="83" height="7" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1,739,871</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1000</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">SNAPPY</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">NONE</font></font></p> 
        </td> 
      </tr> 
    </tbody> 
  </table> 
  <p style="margin-bottom: 0in; line-height: 100%;">However, note that
the resulting HFile size with Snappy and no data block encoding (1.7
Mb) is very similar in size to the baseline approach (i.e., fat
rowkeys, fat column-names) with Snappy and no data block encoding
(1.8 Mb).  Why?  The CF compression can compensate on disk for a lot
of bloat in rowkeys and column names.</p> 
  <p style="margin-bottom: 0in; line-height: 100%;"><b>Case #4:  What if
we re-designed both the rowkey and the column names?</b></p> 
  <p style="margin-bottom: 0in; line-height: 100%;">By this time we’ve
learned enough HBase to know that we need to have efficient rowkeys
and column-names.  This produces an HFile that is 4.4 Mb, a 29%
savings over the baseline of 6.2 Mb.</p> 
  <table width="397" cellpadding="8" cellspacing="0"> <colgroup><col width="83" /> <col width="83" /> <col width="83" /> <col width="83" /> </colgroup> 
    <tbody> 
      <tr valign="bottom"> 
        <td width="83" height="7" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">4,406,418</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1000</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">NONE</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">NONE</font></font></p> 
        </td> 
      </tr> 
    </tbody> 
  </table> 
  <p style="margin-bottom: 0in; line-height: 100%;">Applying Snappy
compression can reduce the HFile size further:</p> 
  <table width="397" cellpadding="8" cellspacing="0"> <colgroup><col width="83" /> <col width="83" /> <col width="83" /> <col width="83" /> </colgroup> 
    <tbody> 
      <tr valign="bottom"> 
        <td width="83" height="7" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1,296,402</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1000</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">SNAPPY</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">DIFF</font></font></p> 
        </td> 
      </tr> 
      <tr valign="bottom"> 
        <td width="83" height="7" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1,338,135</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1000</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">SNAPPY</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">FAST_DIFF</font></font></p> 
        </td> 
      </tr> 
      <tr valign="bottom"> 
        <td width="83" height="7" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1,485,192</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><a name="_GoBack"></a><font face="Calibri, serif"><font style="font-size: 12pt;">1000</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">SNAPPY</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">PREFIX</font></font></p> 
        </td> 
      </tr> 
      <tr valign="bottom"> 
        <td width="83" height="7" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1,732,746</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1000</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">SNAPPY</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">NONE</font></font></p> 
        </td> 
      </tr> 
    </tbody> 
  </table> 
  <p style="margin-bottom: 0in; line-height: 100%;">Again, the on-disk
footprint with compression isn’t radically different from the
others, as Compression can compensate to large degree for rowkey and
column name bloat.</p> 
  <p style="margin-bottom: 0in; line-height: 100%;"><b>Case #5: 
KeyValue Storage Approach (e.g., 1 KV vs. KV-per-Column)</b></p> 
  <p style="margin-bottom: 0in; line-height: 100%;">What if we did
something radical and changed how we stored the data in HBase?  With
this approach, we are using a single KeyValue per row holding <i>all</i>
of the columns of data for the row instead of a KeyValue per column
(the traditional way).</p> 
  <p style="margin-bottom: 0in; line-height: 100%;">The resulting HFile,
even uncompressed and without Data Block Encoding, is radically
smaller at 1.4 Mb compared to 6.2 Mb.</p> 
  <table width="712" cellpadding="8" cellspacing="0"> <colgroup><col width="299" /> <col width="83" /> <col width="83" /> <col width="83" /> <col width="83" /> </colgroup> 
    <tbody> 
      <tr valign="bottom"> 
        <td width="299" height="7" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">psudorandom-table-R1000-i10-s10_20-l10-NONE-NONE-AVRO</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1,374,465</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1000</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">NONE</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">NONE</font></font></p> 
        </td> 
      </tr> 
    </tbody> 
  </table> 
  <p style="margin-bottom: 0in; line-height: 100%;">Adding Snappy
compression and Data Block Encoding makes the resulting HFile size
even smaller.</p> 
  <table width="397" cellpadding="8" cellspacing="0"> <colgroup><col width="83" /> <col width="83" /> <col width="83" /> <col width="83" /> </colgroup> 
    <tbody> 
      <tr valign="bottom"> 
        <td width="83" height="7" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1,119,330</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1000</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">SNAPPY</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">DIFF</font></font></p> 
        </td> 
      </tr> 
      <tr valign="bottom"> 
        <td width="83" height="7" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1,129,209</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1000</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">SNAPPY</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">FAST_DIFF</font></font></p> 
        </td> 
      </tr> 
      <tr valign="bottom"> 
        <td width="83" height="7" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1,133,613</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1000</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">SNAPPY</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">PREFIX</font></font></p> 
        </td> 
      </tr> 
      <tr valign="bottom"> 
        <td width="83" height="7" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1,150,779</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p align="right"><font face="Calibri, serif"><font style="font-size: 12pt;">1000</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">SNAPPY</font></font></p> 
        </td> 
        <td width="83" bgcolor="#ffffff" style="border: none; padding: 0in;"> 
          <p><font face="Calibri, serif"><font style="font-size: 12pt;">NONE</font></font></p> 
        </td> 
      </tr> 
    </tbody> 
  </table> 
  <p style="margin-bottom: 0in; line-height: 100%;">Compare the 1.1 Mb
Snappy without encoding to the 1.7 Snappy encoded Thin rowkey/Thin
column-name.</p> 
  <p style="margin-bottom: 0in; line-height: 100%;"><b>Summary</b></p> 
  <p style="margin-bottom: 0in; line-height: 100%;">Although Compression
and Data Block Encoding can wallpaper over bad rowkey and column-name
decisions in terms of HFile size, you will pay the price for this in
terms of data transfer from RegionServer to Client.  Also, concealing
the size penalty brings with it a performance penalty each time the
data is accessed or manipulated.  So, the old advice about correctly
designing rowkeys and column names still holds.</p> 
  <p style="margin-bottom: 0in; line-height: 100%;">In terms of KeyValue
approach, having a single KeyValue per row presents significant
savings both in terms of data transfer (RegionServer to Client) as
well as HFile size.  <i>However</i>, there is a consequence with this
approach in having to update each row <i>entirely</i>, and that old
versions of rows <i>also</i> be stored in their entirety (i.e., as
opposed to column-by-column changes).  Furthermore, it is impossible
to scan on select columns; the whole row must be retrieved and
deserialized to access any information stored in the row.  The
importance of understanding this tradeoff cannot be over-stated, and
is something that must be evaluated on an application-by-application
basis.</p> 
  <p style="margin-bottom: 0in; line-height: 100%;">Software engineering
is an art of managing tradeoffs, so there isn’t necessarily one
“best” answer.  Importantly, this experiment only measures the
file size and not the time or processor load penalties imposed by the
use of compression, encoding, or Avro.  The results generated in this
test are still based on certain assumptions and your mileage may
vary.</p>
  <p> </p>
  <p>Here is the data if interested:&nbsp;<a href="http://people.apache.org/~dmeil/HBase_HFile_Size_2014_04.csv" target="_blank" style="color: #1155cc; font-family: Calibri, sans-serif; font-size: 14px;">http://people.apache.org/~<wbr />dmeil/HBase_HFile_Size_2014_<wbr />04.csv</a> </p> 
  <p> </p>
