---
layout: post
status: PUBLISHED
published: true
title: apache.org incident report for 04/09/2010
author:
  display_name: Philip Gollucci
  login: pgollucc1
  email: pgollucci@apache.org
author_login: pgollucc1
author_email: pgollucci@apache.org
id: 48bb57d4-d8f7-44ee-a754-c25762a997a3
date: '2012-04-12 03:45:59 -0400'
categories:
- General
tags:
- security
- crypt
- attack
- breakin
- jira
- downtime
- passwords
comments:
- id: 0
  author: francisdb
  author_email: ''
  author_url: ''
  date: '2010-04-13 06:36:17 -0400'
  content: Thorough research, openness, good to see that we have a professional team
    taking care of infrastructure!
- id: 0
  author: Noam Rathaus
  author_email: noamr@beyondsecurity.com
  author_url: ''
  date: '2010-04-13 07:14:54 -0400'
  content: Minor spelling mistake = applcaiton should be application
- id: 0
  author: Max Kanat-Alexander
  author_email: mkanat@bugzilla.org
  author_url: http://avatraxiom.livejournal.com/102080.html
  date: '2010-04-13 11:37:32 -0400'
  content: "In response to this, I wrote a bit about how attacks like this one can
    be prevented by web applications, here:\r\n\r\nhttp://avatraxiom.livejournal.com/102080.html"
- id: 0
  author: Archie Cobbs
  author_email: archie@dellroad.org
  author_url: ''
  date: '2010-04-13 15:11:41 -0400'
  content: "I would like to see one-time passwords much more widely used, especially
    now that there are several software \"tokens\" available for mobile phones (toward
    this end I've written an Apache authentication module mod-authn-otp and an iPhone
    software token \"OATH Token\", both of which follow the RFC 4226 (OATH) standard).\r\n\r\nUse
    of two-factor authentication everywhere would have stopped this attack in its
    tracks.\r\n\r\nThe problem is that even if you are ready and able with your own
    software token running the OATH standard algorithm, virtually no web sites allow
    you to enable requiring two-factor authentication for your account.\r\n"
- id: 0
  author: www.meneame.net
  author_email: ''
  author_url: http://www.meneame.net/story/servidor-jira-apache-hackeado-instan-cambiar-passwords-eng
  date: '2010-04-13 16:54:46 -0400'
  content: "[Trackback] El servidor de consulta / post de bugs de apache (basado en
    jira) ha sido hackeado entre el 6 y 9 de abril, y apache.org se ha visto obligado
    a enviar un correo a todos los usuarios registrados para que cambien sus contrase&ntilde;as,
    informando de que la..."
- id: 0
  author: mw
  author_email: ''
  author_url: ''
  date: '2010-04-13 16:55:50 -0400'
  content: So how do I know whether this is not a hacker still in control of the system,
    rushing us to change passwords to get them all in plaintext ;-)
- id: 0
  author: 'Martin '
  author_email: martin@stenderup.dk
  author_url: ''
  date: '2010-04-13 17:58:55 -0400'
  content: "MW: \"So how do I know whether this is not a hacker still in control of
    the system, rushing us to change passwords to get them all in plaintext ;-) \"\r\n-
    My thoughts exactly!\r\n"
- id: 0
  author: Sebastian
  author_email: poisonclub@gmail.com
  author_url: http://www.hoteles-islascanarias.com
  date: '2010-04-13 19:14:43 -0400'
  content: "I'm a little impressed, makes me think even more that I must be very careful
    about XSS on my sites.\r\nI like the commitment to apache.org to publish it and
    explain it.\r\nStill gives me more confidence than before!\r\ngood job"
- id: 0
  author: Jan Schaumann
  author_email: jschauma@netmeister.org
  author_url: ''
  date: '2010-04-13 19:35:02 -0400'
  content: If the attackers got root on a shared shell server, and svn auth credentials
    there may have been cached, would it have been possible for the attackers to modify
    sources in the svn repositories?
- id: 0
  author: Kevin
  author_email: kpfleming@digium.com
  author_url: ''
  date: '2010-04-13 20:51:36 -0400'
  content: Yes, JIRA (and Confluence) can authenticate via LDAP, either directly or
    through Crowd (another Atlassian product), and in this case that that would have
    kept the attackers from obtaining password hashes, although it wouldn't have stopped
    the other exploits they achieved.
- id: 0
  author: Ryan Brown
  author_email: tent101010@gmail.com
  author_url: ''
  date: '2010-04-13 21:24:26 -0400'
  content: Extremely instructive. Thank you.
- id: 0
  author: Mark
  author_email: mvyver@gmail.com
  author_url: ''
  date: '2010-04-13 23:13:14 -0400'
  content: No mention, anywhere, of how to delete my Apache JIRA account... come on!
- id: 0
  author: Anonymous
  author_email: ''
  author_url: ''
  date: '2010-04-14 00:07:38 -0400'
  content: Some say that is not Ubuntu's fault, but I think it is. Browser without
    NoScript and sudo? Great pair, thank Ubuntu for this; sudo shouldn't be set the
    way Ubuntu does it. If the system wouldn't have had sudo setup the Ubuntu way,
    it wouldn't have been rooted. Full sudo access of that user that used the same
    password for local account and for administrative JIRA acount, should be revoked
    for good. Using same password for more accounts is just plain stupid; how many
    years long have this thing be shown and proven bad? Also, using https but encrypting
    only some of the content is just plain stupid.
- id: 0
  author: James
  author_email: ''
  author_url: ''
  date: '2010-04-14 00:09:42 -0400'
  content: Well you fucked that one up didn't you, you useless fuckers! I'm not impressed.
- id: 0
  author: smartgeek
  author_email: ''
  author_url: http://smartgeek.status.net/notice/508
  date: '2010-04-14 04:10:26 -0400'
  content: "[Trackback] !Apache's Atlassian #JIRA system compromised https://blogs.apache.org/infra/entry/apache_org_04_09_2010"
- id: 0
  author: Zeke Weeks
  author_email: apache@zekeweeks.com
  author_url: http://zekeweeks.com
  date: '2010-04-14 06:07:40 -0400'
  content: 'Thanks for the transparency on the whole story behind this. A lot to learn
    from this: the power of XSS, obfuscated URLs and social engineering... And how
    easily security precautions can be circumvented by not doing due diligence in
    an administrative role. Hopefully you''ll be just as transparent about the measures
    taken to prevent such a failure in the future. :-)'
- id: 0
  author: Wilson
  author_email: wilsonaikeda@gmail.com
  author_url: ''
  date: '2010-04-14 07:00:52 -0400'
  content: ASF running ubuntu on their servers...LOL. During years working with big
    companies it's the first time i hear such thing, an organization as big as ASF
    running ubuntu on their servers. Don't tell the people here that it was running
    kde and have doom 3 and all the games installed too.
- id: 0
  author: haley
  author_email: haley.1601@rediffmail.com
  author_url: http://www.howtoloseweightfastest.com/
  date: '2010-04-14 11:39:30 -0400'
  content: Me too. I was pretty close to buying a slice last night too. But now I'm
    slightly worried that if a large organization like Apache waited two days for
    action, how long would a small fry like me wait?
- id: 0
  author: 'JIRA: Kafahali'
  author_email: ''
  author_url: http://www.ticketsysadmin.com/jira/browse/KH-48
  date: '2010-04-14 12:41:43 -0400'
  content: "[Trackback] Read about the latest security breach on Apache and JIRA:\r\nhttp://www.theregister.co.uk/2010/04/13/apache_website_breach_postmortem/\r\nhttp://blogs.atlassian.com/news/2010/04/oh_man_what_a_day_an_update_on_our_security_breach.html\r\nhttps://blogs.apache..."
- id: 0
  author: Peter Odding
  author_email: peter@peterodding.com
  author_url: http://peterodding.com
  date: '2010-04-14 16:48:38 -0400'
  content: "&laquo;\"We use Fail2Ban for many services, but we did not have it configured
    to track JIRA login failures.\" Is this even possible? If so, how are you doing
    it ASF?&raquo;\r\n\r\nI have no experience with JIRA but fail2ban works by matching
    lines in log files against user-defined regular expressions, so it should be able
    to work with most log files out there as long as you manage to write the required
    regex. You can use the fail2ban-regex command to test your regex on existing log
    files."
- id: 0
  author: 'Confluence: Jonathan Stern'
  author_email: ''
  author_url: http://confluence/display/~jstern/2010/04/14/JIRA+vulnerabilities
  date: '2010-04-14 17:17:04 -0400'
  content: "[Trackback] There have been two recent exploits against JIRA and Atlassian,
    which, though they have no direct effect on us, should be kept in mind as we consider
    opening JIRA to support integrations with other tools.  An XSS attach against
    https://issues.apache...."
- id: 0
  author: Lance R
  author_email: ''
  author_url: ''
  date: '2010-04-14 17:20:26 -0400'
  content: "The coordinated multi-vector attack is what I find most interesting.  XSS,
    Bruteforce, jsp backdoors, phishing, social engineering.\r\n\r\nAnd why would
    the attacker(s) spend so much effort on attacking ASF?   To find all those private
    bugs? I doubt it.  Get the source code? oh wait, it's already open source. \r\n\r\nThe
    only real value I see in the attack is the passwords.  How many apache contributors
    also work for the DOD or other companies with valuable intellectual property?\r\n\r\nI
    bet the attackers got paid for this attack.  Either contracted out by a firm,
    or on the payroll for a government. "
- id: 0
  author: lou martin
  author_email: ''
  author_url: ''
  date: '2010-04-14 17:31:50 -0400'
  content: "the question is: why should a person hack apache's server knowing that
    this is an open source community things? If it for learning  purpose, the person
    should not attack the site till it break(just browsing through things is fine
    i guess). \r\n\r\nif the person who hacked the server is  a good samaritan, s/he
    should raise the security issue to apache team"
- id: 0
  author: ''
  author_email: ''
  author_url: ''
  date: '2010-04-14 20:01:57 -0400'
  content: "Don't you shame some kind of shame for saying:\r\n\r\n\"The attackers
    had root access on brutus.apache.org for several hours, and we could no longer
    trust the operating system on the original machine.\"\r\n\r\nAre you unable to
    ensure that a given machine is secure or not?"
- id: 0
  author: Tomas Mraz
  author_email: t8m@centrum.cz
  author_url: ''
  date: '2010-04-15 09:26:17 -0400'
  content: "You should learn more about OpenSSH sshd configuration and do not put
    wrong statements like \"having UsePAM yes set meant that password-based logins
    were still possible\". There is nothing wrong with UsePAM yes, but you probably
    did not set both PasswordAuthentication and ChallengeResponseAuthentication to
    no.\r\n"
- id: 0
  author: Just Another Hacker
  author_email: ''
  author_url: http://www.justanotherhacker.com/2010/04/from-xss-to-root---the-apache-post-mortem.html
  date: '2010-04-15 11:20:26 -0400'
  content: "[Trackback] In the spirit of openness the Apache foundation has released
    an excellent post mortem write up of their recent compromise. It started with
    a XSS attack leveraged through the issue tracking software they use (JIRA) and
    ended with complete root..."
- id: 0
  author: Ben
  author_email: box@yeleek.co.uk
  author_url: ''
  date: '2010-04-15 11:50:43 -0400'
  content: Good to see an honest open review.  Scary how far they got...
- id: 0
  author: Nathan
  author_email: nreese@integrity-apps.com
  author_url: ''
  date: '2010-04-15 14:52:37 -0400'
  content: Great post.  Any idea who was behind the attacks, country of origin, or
    motive?
- id: 0
  author: 'Confluence: Mo Barger'
  author_email: ''
  author_url: https://confluence.cornell.edu/display/~mf12/Jira+XSS+Vulnerability
  date: '2010-04-15 18:37:09 -0400'
  content: "[Trackback] Background:"
- id: 0
  author: phil
  author_email: ''
  author_url: ''
  date: '2010-04-16 19:08:42 -0400'
  content: Thanks for the excellent writeup of this incident. Now, if we can get more
    companies to disclose this information.....
- id: 0
  author: Jonathon
  author_email: ''
  author_url: ''
  date: '2010-04-16 20:18:31 -0400'
  content: It takes courage and humility to write up an investigation like this and
    share it with us.  Obviously there have been those who have taken the opportunity
    to shame and belittle you for it.  But as for me, you guys have gained my respect.  You
    have allowed us all to learn from your experience.  Thank you.
- id: 0
  author: Michael Starks
  author_email: apache-blog@michaelstarks.com
  author_url: http://www.immutablesecurity.com
  date: '2010-04-19 00:00:34 -0400'
  content: "If you had been using OSSEC rather than Fail2Ban, you would have the benefit
    of file integrity monitoring and it might have detected the XSS attack and blocked
    the attacker. Also, I'm sure it would be relatively trivial to write a decoder
    for JIRA. It would be an interesting exercise to run your logs through ossec-logtest
    to see what it would have alerted you on.\r\n\r\nMay I also suggest a bit of awareness
    training for the administrators? You have listed several technical solutions but
    the root cause of the attack being successful was people clicking on untrusted
    links."
- id: 1
  author: Joe Schaefer
  author_email: joes@apache.org
  author_url: ''
  date: '2010-04-14 01:12:39 -0400'
  content: "To request that your JIRA account be deleted, please send an email request
    to infrastructure@apache.org.\r\n"
- id: 1
  author: IcE
  author_email: sorry@hotmail.com
  author_url: ''
  date: '2010-04-14 15:12:57 -0400'
  content: Apache and Linux have been fooled? Another account goes, the game really
    opens up and says it was a human error.
- id: 2
  author: nobody
  author_email: ''
  author_url: ''
  date: '2010-04-13 19:12:15 -0400'
  content: "Great story, thanks for posting.\r\n\r\nIf you are using FireFox you may
    want to install NoScript (noscript.net) to prevent XSS attacks!"
- id: 2
  author: remin
  author_email: ''
  author_url: http://remin.status.net/notice/613
  date: '2010-04-14 04:10:26 -0400'
  content: "[Trackback] !Apache's Atlassian #JIRA system compromised https://blogs.apache.org/infra/entry/apache_org_04_09_2010"
- id: 3
  author: 'Confluence: Uutiset'
  author_email: ''
  author_url: https://pro.ambientia.fi/cf/display/news/2010/04/13/XSS-haavoittuvuus+Jirassa
  date: '2010-04-13 14:32:07 -0400'
  content: "[Trackback] Moi,  Jirasta on l&ouml;ydetty kaksi haavoittuvuutta, jotka
    mahdollistavat k&auml;ytt&auml;j&auml;n session kaappaamisen XSShaavoittuvuuden
    kautta, ja hy&ouml;kk&auml;&auml;j&auml;n saatua haltuunsa administratortason
    oikeudet mielivaltaisten tiedostojen siirt&auml;miseen palvelimelle,..."
- id: 3
  author: Steve Holden
  author_email: steve@holdenweb.com
  author_url: http://holdenweb.com/
  date: '2010-04-14 00:53:47 -0400'
  content: James (above) may not be impressed, but I believe this is pretty much a
    model response to a nasty attack (and I *really* hope James gets rooted real soon).
- id: 3
  author: Jay
  author_email: jsensarma@yahoo.com
  author_url: ''
  date: '2010-04-14 04:47:09 -0400'
  content: how was the compromised slicehost node essential to this hack? couldn't
    anyone have opened the jira that had the tinyurl that led to the XSS attack that
    led to everything else?
- id: 4
  author: Federico
  author_email: federico.grilli@gmail.com
  author_url: ''
  date: '2010-04-13 20:21:26 -0400'
  content: 'A literary masterpiece! '
- id: 5
  author: Ariel Rivera
  author_email: rivera.ariel@gmail.com
  author_url: ''
  date: '2010-04-13 14:50:14 -0400'
  content: "Great post, thanks.\r\nBut, why explain in detail what your security measures
    are ?, let the hackers discover them....\r\n"
- id: 5
  author: fakhrime
  author_email: mailbox@fakhri.me
  author_url: http://fakhri.me
  date: '2010-04-14 06:50:44 -0400'
  content: "i just want share this link.\r\nhttp://tinyurl.com/preview.php?enable=1\r\nhttp://is.gd/setcookie.php\r\nit's
    will expand the short url before it's visited.\r\n#thinkbeforeryouclick #apacheisgreat"
- id: 5
  author: JD
  author_email: ''
  author_url: ''
  date: '2010-04-14 14:53:29 -0400'
  content: "\"We use Fail2Ban for many services, but we did not have it configured
    to track JIRA login failures.\"\r\n\r\nIs this even possible? If so, how are you
    doing it ASF?"
- id: 7
  author: Frederik
  author_email: anonymous@cowa.rd
  author_url: ''
  date: '2010-04-13 10:48:44 -0400'
  content: "An interesting case where someone got root starting from XSS..Thank you
    for this elaborate explanation :)\r\n"
- id: 7
  author: James Woods
  author_email: james@hkdtn.net
  author_url: ''
  date: '2010-04-13 22:22:10 -0400'
  content: "Leave it to big organizations to allow something this massive to occur
    un-noticed.\r\n\r\nIt's why we have the stupid PCI standards we have today that
    do nothing but take the time out of businesses that always played by the security
    rules while the big guys were careless.\r\n\r\nTheres alot of blame and fingerpointing
    from who-ever wrote this but all the blame and fingerpointing should be pointing
    right at Apache.\r\n\r\nThis attack had nothing to do with Linux, Slicehost, or
    whatever else is thrown in to tell a story.\r\n\r\nWho doesn't block brute force
    attacks in 2010?\r\nWho doesn't use real password encryption?\r\n\r\nIts mindblowing,
    but im not surprised the big guys always make a muck of things and then the little
    guys are stuck dealing with the aftermath."
- id: 7
  author: genehack.org
  author_email: ''
  author_url: http://genehack.org/2010/04/a_glimpse_into_the_current_state_of_internet_secur/index.html
  date: '2010-04-14 10:37:59 -0400'
  content: "[Trackback] The Apache Software Foundation was recently the victim of
    a targeted attack, which they&#8217;ve detailed at great length. It&#8217;s a
    fascinating read, and somewhat depressing, and also awesome in a completely evil
    way, all at the same time. For the..."
- id: 7
  author: 'JIRA: IT Systems'
  author_email: ''
  author_url: http://jira.carbonplanet.com/jira/browse/IT-641
  date: '2010-04-14 13:29:20 -0400'
  content: "[Trackback] This issue affects only the the passwords of atlassian client
    accounts, it doesn't affect any passwords of any users on our own Jira installation.
    \r\n\r\nThere is a XSS vulnerability that was used to compromise the apache software
    foundation's jira insta..."
- id: 8
  author: Jacob Appelbaum
  author_email: jacob@appelbaum.net
  author_url: http://www.appelbaum.net
  date: '2010-04-14 01:32:19 -0400'
  content: How many private bugs did they gain access too by compromising the bug
    database systems? Also, why are you guys using proprietary software?
- id: 8
  author: Fernando
  author_email: ''
  author_url: ''
  date: '2010-04-14 10:17:32 -0400'
  content: "Hey Wilson, I think you were indeed working with big companies for years...
    as the lobby shoe polish boy! \r\nHav you heard of Wikimedia Foundation? How about
    Wikipedia? \r\nWell you ignorant, they use Ubuntu for many of their servers."
- id: 8
  author: Bjorn
  author_email: ''
  author_url: ''
  date: '2010-04-15 06:55:31 -0400'
  content: 'Nice work (- and report), and a nice display of preventing a spread (but
    a shame that the reciver did not act in time). '
- id: 8
  author: Richard
  author_email: fred@foo.com
  author_url: ''
  date: '2010-04-15 07:14:23 -0400'
  content: 'When are you going to require that salt is used for all Apache site password
    hashes (possibly by going to LDAP authentication)?  '
- id: 8
  author: 'Confluence: Jonathan Stern'
  author_email: ''
  author_url: http://confluence/display/~jstern/2010/04/14/JIRA+vulnerabilities
  date: '2010-04-16 16:40:05 -0400'
  content: "[Trackback] There have been two recent exploits against JIRA and Atlassian,
    which, though they have no direct effect on us, should be kept in mind as we consider
    opening JIRA to support integrations with other tools.  An XSS attach against
    https://issues.apache...."
- id: 9
  author: Jens
  author_email: ''
  author_url: ''
  date: '2010-04-14 07:26:29 -0400'
  content: 'looks like we have a problem with the email addresses. ''@'' and ''.''
    have been replaced by ''at'' and ''dot''. '
- id: 9
  author: Fernando
  author_email: ''
  author_url: ''
  date: '2010-04-14 10:12:33 -0400'
  content: "Long live ASF!\r\nGreat incident report; I wish other orgs that suffered
    a breach will be that forthcoming with the whole set of details!\r\n"
- id: 9
  author: msj
  author_email: ''
  author_url: http://www.negativespace.net/msj/2010/04/links_for_20100414.html
  date: '2010-04-14 17:03:54 -0400'
  content: "[Trackback]  zomigi.com &raquo; Deal-breaker problems with CSS3 multi-columns
    The first problem is how the browser should handle one or more extra lines of
    content if the amount of content cannot fill up each column equally. In my opinion,
    the extra..."
- id: 9
  author: Steve
  author_email: stevehunter_1@hotmail.com
  author_url: ''
  date: '2010-04-15 17:28:17 -0400'
  content: "What is the motive behind these attacks?  I mean this looks like someone
    spent 50 hours of their time on this.. and for what?  is the ultimate goal to
    obtain email addresses and passwords and then try to compromise individuals on
    a one-on-one basis or is there some other motive?  seems kind of futile to steal
    from apache.org ... since someone could legally become an \"administrator\" with
    some simple efforts and some simple conning and display of knowledge (it is not
    like these people arent computer EXPERTS) and then have access to the data anyways
    !!???\r\n\r\n\r\nWHATS THE MOTIVE !!!"
- id: 24
  author: bryan hunt
  author_email: mafubryan@gmail.com
  author_url: ''
  date: '2010-04-13 11:06:15 -0400'
  content: "I knew not to trust Atlassian. Check out this bug report I opened months\r\nago
    for Jira....\r\n\r\nThe application should have been able to run under a security
    manager,\r\nhowever there existed\r\na caught security manager exception deep
    in the code that prevented it\r\nrunning with security,\r\nthey couldn't identify
    or explain it to me either... how odd ???\r\n\r\nAtlassian's response was... \"just
    turn the security manager off\"\r\n\r\nSo I didn't install it, instead insisted
    on installing it on it's own\r\nisolated VM.\r\n\r\nhttps://support.atlassian.com/browse/JSP-52900\r\n\r\nHa
    ha ha ha ha ha ha\r\n\r\nAnd people call me paranoid!!!!!"
- id: 24
  author: Adrian Colomitchi
  author_email: ''
  author_url: ''
  date: '2010-04-15 21:39:33 -0400'
  content: "@Mo Barger\r\nMotive? What about getting COMMIT access to subversion,
    then sliping in some buffer overflow in the httpd code?\r\nI mean, the apache
    Web server runs on quite a number of high profile places.\r\n\r\nMaybe the entire
    username, passwords and emails is smoke and mirrors?\r\n\r\nAdrian"
- id: 53
  author: free
  author_email: dorinn@download4a.com
  author_url: http://www.download4a.com
  date: '2010-04-13 18:24:05 -0400'
  content: did they steal any code ? or only passwords ?
- id: 53
  author: Anonymous
  author_email: ''
  author_url: ''
  date: '2010-04-14 00:07:02 -0400'
  content: 'There are so many other issue trackers out there, some of them much better
    and many more open than JIRA. Why don''t you use one of those? Is not the first
    time when Apache.org get''s hacked. Why don''t you learn from your own mistakes
    and why don''t you prevent this kind of attacks doing things the right way? What
    you said in your post makes me think that those that should take care of the security
    of your systems are not doing their job as they should. What took them so long
    to figure out; have you fired any of them? '
- id: 59
  author: SteveL
  author_email: steve.loughran@gmail.com
  author_url: ''
  date: '2010-04-14 19:07:27 -0400'
  content: "The target was not the passwords. They were going after the SVN server,
    and since the source is all public there, it wasn't to see it and file bug reports
    containing patches.\r\n\r\nGiven past attacks against the Linux source, the likely
    goal was to put a back door into HTTPD, the https support, or similar, something
    that lets you either onto the sites running the daemon, or that makes encrypted
    communication easier to read. "
- id: 75
  author: Jeff
  author_email: mehdi.public@gmail.com
  author_url: ''
  date: '2010-04-14 08:29:34 -0400'
  content: So do you recommend IBM's AIX instead Ubuntu?
- id: 81
  author: Frustrated Linux User
  author_email: ''
  author_url: ''
  date: '2010-04-13 23:38:08 -0400'
  content: "The attack would have been contained to brutus.apache.org's www directories
    if you were either running RHEL/CentOS/Fedora with SELinux enabled, or if the
    Debian/Ubutnu team would put down their bongs and actually implement one or two
    hardening mechanisms.\r\n\r\nThe state of Linux security is abysmal these days.
    With no hardening and a new kernel exploit every week, a single XSS flaw these
    days usually gets you root. Windows 7 has far more hardening mechanisms than your
    average Linux distro, save maybe Fedora or hardened Gentoo. The only thing that
    saves us all from 100% compromise is that no one uses Linux.\r\n\r\nJust sayin'
    ; )"
- id: 93
  author: Blanca Garcia
  author_email: bgarciagil@gmail.com
  author_url: ''
  date: '2010-04-13 09:15:11 -0400'
  content: "I have seen on your JIRA site that you are using Enterprise Edition, Version:
    3.13.5-#360, how about an upgrade?\r\n\r\nThey include lots of security fixes
    as well, including locking user accounts after a number of failed log in attempts.
    This would actually have prevented part of the attack suffered.\r\n\r\nAnd definitely,
    the user with complete sudo access sharing password with JIRA, that was a big
    FAIL.\r\n\r\nKeep up the good work, and thank you for documenting this!\r\n"
- id: 97
  author: abadidea
  author_email: ''
  author_url: ''
  date: '2010-04-13 21:36:44 -0400'
  content: Thank you for the transparency; I really respect it. It's also a very clear
    case as for why XSS should be treated seriously.
- id: 99
  author: Sergey Shepelev
  author_email: temotor@gmail.com
  author_url: http://temoto.ru/
  date: '2010-04-14 05:56:03 -0400'
  content: "> Hopefully others can learn from our mistakes.\r\n\r\nYup, don't use
    Jira is best lesson from this mistake.\r\n\r\nIn 2010 it could have support for
    OpenID."
- id: 100
  author: Alex
  author_email: ''
  author_url: ''
  date: '2010-04-13 16:34:32 -0400'
  content: "\"By the morning of April 9th, the attackers had installed a JAR file
    that would collect all passwords on login and save them\".\r\n\r\nThe major issue
    there is that nothing was monitoring a restart of a JIRA instance with a delta
    in its runtime path, or a modification of key binaries in its runtime part in
    the file system - that correlated with a spike due to a brute force attack should
    have been spotted."
- id: 278
  author: David S
  author_email: ''
  author_url: ''
  date: '2010-04-13 16:51:51 -0400'
  content: What would have been another good thing, is that the mail you sent out
    would be signed with a key which we who receive these mails can validate.
- id: 402
  author: Anton Chuvakin
  author_email: anton@chuvakin.org
  author_url: http://www.chuvakin.org
  date: '2010-04-13 13:52:35 -0400'
  content: Thanks for a great incident report; I wish other orgs that suffered a breach
    will be that forthcoming with the whole set of details!
- id: 2746
  author: Pepijn
  author_email: apache@chaos.demon.nl
  author_url: ''
  date: '2010-04-13 17:56:56 -0400'
  content: "Why do you say the Slicehost server was \"compromised\"? Could it not
    have been the attackers' own VPS (presumably purchased under false pretences)?\r\n\r\nIf
    it really was compromised, was it the VPS itself which had been subverted, or
    Slicehost's systems?"
- id: 6120
  author: FM
  author_email: ferruh@mavitunasecurity.com
  author_url: http://www.mavitunasecurity.com
  date: '2010-04-14 12:17:49 -0400'
  content: "You might add more testing against all installed 3rd party application
    such as JIRA, I wrote a short blog post about it.\r\n\r\nhttp://www.mavitunasecurity.com/blog/apacheorg-and-jira-incident/\r\n\r\nI
    already send the email but want repeat in here we would be happy to give a free
    Netsparker license to Apache Software Foundation.\r\n\r\nAlso we do have a free
    version of Netsparker - Community Edition which would have identified these XSS
    issues as well - http://www.mavitunasecurity.com/communityedition/"
- id: 7352
  author: PaPPy
  author_email: pappy@cyber-wars.com
  author_url: http://cyber-wars.com
  date: '2010-04-14 12:33:46 -0400'
  content: use FireFox with NoScript or IE8 with default XSS filter enabled
- id: 12616
  author: Fred Schlip
  author_email: developerwatch@usa.com
  author_url: ''
  date: '2010-04-14 13:26:09 -0400'
  content: "Hi,\r\n\r\nThis was very useful.\r\n\r\nConsider adding multi-factor authentication
    with client certificates that you can issue to admin members, instead of relying
    soley on password based solutions (two factor auth).\r\n\r\nConsider also requiring
    VPN with multi-factor authentication as a requirement to reach your infrastructure
    related configuration.  Even from inside your infrastructure.\r\n\r\n"
- id: 884446
  author: Andrei Railean
  author_email: andrei@andrei.md
  author_url: http://andrei.md
  date: '2010-04-14 01:39:13 -0400'
  content: Thanks for sharing this. Any ideas on who the attackers could be?
- id: 3734180
  author: Alasdair
  author_email: not@apache.org
  author_url: ''
  date: '2010-04-13 19:17:36 -0400'
  content: "Any chance of getting JIRA to authenticate using LDAP? At least that way
    they wouldn't have been able to get the password hash's for JIRA.\r\n\r\nAlasdair"
- id: 9294894
  author: Michael
  author_email: ''
  author_url: ''
  date: '2010-04-14 01:08:29 -0400'
  content: How do we request to have our accounts deleted from JIRA?
- id: 39616511
  author: John
  author_email: ''
  author_url: ''
  date: '2010-04-13 18:07:04 -0400'
  content: Expiring/locking accounts that haven't logged in for 30 or 90 days (and
    removing the password from your database) would of lessen the number of people
    affected by this attack.  If you don't store it, it can't be stolen!
- id: 93804944
  author: Skyphire
  author_email: fbi@fbi.org
  author_url: ''
  date: '2010-04-16 03:40:53 -0400'
  content: "It's about time Apache stops broadcasting mod_status to the rest of the
    world:\r\n\r\nhttp://www.apache.org/server-status\r\n\r\nJust a hint."
permalink: infra/entry/apache_org_04_09_2010
---
<p>Apache.org services recently suffered a direct, targeted attack against our infrastructure, specifically the server hosting our issue-tracking software.</p>
<p>The Apache Software Foundation uses a donated instance of <a href="http://www.atlassian.com/software/jira/">Atlassian JIRA</a> as an issue tracker for our projects. Among other projects, the ASF Infrastructure Team uses it to track issues and requests. Our JIRA instance was hosted on brutus.apache.org, a machine running Ubuntu Linux 8.04 LTS.</p>
<h2>Password Security</h2>
<p><strong><font color="red">If you are a user of the Apache hosted JIRA, Bugzilla, or Confluence, a hashed copy of your password has been compromised.</font></strong></p>
<p>JIRA and Confluence both use a SHA-512 hash, but without a random salt.  We believe the risk to simple passwords based on dictionary words is quite high, and most users should rotate their passwords.</p>
<p>Bugzilla uses a SHA-256, including a random salt. The risk for most users is low to moderate, since pre-built password dictionaries are not effective, but we recommend users should still remove these passwords from use. </p>
<p>In addition, if you logged into the Apache JIRA instance between April 6th and April 9th, you should consider the password as compromised, because the attackers changed the login form to log them.</p>
<h2>What Happened?</h2>
<p>On April 5th, the attackers via a compromised <a href="http://www.slicehost.com">Slicehost</a> server opened a new issue, INFRA-2591.  This issue contained the following text:</p>
<blockquote><p>
ive got this error while browsing some projects in jira<br />
http://tinyurl.com/XXXXXXXXX [obscured]
</p></blockquote>
<p>Tinyurl is a URL redirection and shortening tool.  This specific URL redirected back to the Apache instance of JIRA, at a special URL containing a <a href="http://en.wikipedia.org/wiki/Cross-site_scripting">cross site scripting (XSS) attack</a>. The attack was crafted to steal the session cookie from the user logged-in to JIRA. When this issue was opened against the Infrastructure team, several of our administators clicked on the link. This compromised their sessions, including their JIRA administrator rights.</p>
<p>At the same time as the XSS attack, the attackers started a brute force attack against the JIRA login.jsp, attempting hundreds of thousands of password combinations.</p>
<p>On April 6th, one of these methods was successful. Having gained administrator privileges on a JIRA account, the attackers used this account to disable notifications for a project, and to change the path used to upload attachments. The path they chose was configured to run JSP files, and was writable by the JIRA user. They then created several new issues and uploaded attachments to them. One of these attachments was a JSP file that was used to browse and copy the filesystem. The attackers used this access to create copies of many users' home directories and various files.  They also uploaded other JSP files that gave them backdoor access to the system using the account that JIRA runs under.</p>
<p>By the morning of April 9th, the attackers had installed a JAR file that would collect all passwords on login and save them. They then sent password reset mails from JIRA to members of the Apache Infrastructure team. These team members, thinking that JIRA had encountered an innocent bug, logged in using the temporary password sent in the mail, then changed the passwords on their accounts back to their usual passwords.</p>
<p>One of these passwords happened to be the same as the password to a local user account on brutus.apache.org, and this local user account had full sudo access. The attackers were thereby able to login to brutus.apache.org, and gain full root access to the machine. This machine hosted the Apache installs of JIRA, Confluence, and Bugzilla.</p>
<p>Once they had root on brutus.apache.org, the attackers found that several users had cached Subversion authentication credentials, and used these passwords to log in to minotaur.apache.org (aka people.apache.org), our main shell server. On minotaur, they were unable to escalate privileges with the compromised accounts.</p>
<p>About 6 hours after they started resetting passwords, we noticed the attackers and began shutting down services. We notified Atlassian of the previously unreported XSS attack in JIRA and contacted SliceHost.  Atlassian was responsive.  Unfortunately, SliceHost did nothing and 2 days later, the <strong>very</strong> same virtual host (slice) <a href="http://blogs.atlassian.com/news/2010/04/oh_man_what_a_day_an_update_on_our_security_breach.html">attacked Atlassian directly</a>.</p>
<p>We started moving services to a different machine, thor.apache.org. The attackers had root access on brutus.apache.org for several hours, and we could no longer trust the operating system on the original machine.</p>
<p>By April 10th, JIRA and Bugzilla were back online.</p>
<p>On April 13th, Atlassian provided a patch for JIRA to prevent the XSS attack. See<br />
<a href="http://jira.atlassian.com/browse/JRA-20994">JRA-20994</a> and <a href="http://jira.atlassian.com/browse/JRA-20995">JRA-20995</a> for details.</p>
<p>Our Confluence wiki remains offline at this time. We are working to restore it.</p>
<h2>What worked?</h2>
<ul>
<li>Limited use passwords, especially <a href="http://en.wikipedia.org/wiki/One-time_password">one-time passwords</a>, were a real lifesaver. If JIRA passwords had been shared with other services/hosts, the attackers could have caused widespread damage to the ASF's infrastructure. Fortunately, in this case, the damage was limited to rooting a single host.</li>
<li>Service isolation worked with mixed results. The attackers must be presumed to have copies of our Confluence and Bugzilla databases, as well as our JIRA database, at this point. These databases include hashes of all passwords used on those systems. However, other services and hosts, including LDAP, were largely unaffected.</li>
</ul>
<h2>What didn't work?</h2>
<ul>
<li>The primary problem with our JIRA install is that the JIRA daemon runs as the user who installed JIRA. In this case, it runs as a jira role-account. There are historical reasons for this decision, but with 20/20 hindsight, and in light of the security issues at stake, we expect to revisit the decision!</li>
<li>The same password should not have been used for a JIRA account as was used for sudo access on the host machine.</li>
<li>Inconsistent application of one time passwords; We required them on other machines, but not on brutus.  PAM was configured to allow optional use of OPIE, but not all of our sudoers had switched to it.</li>
<li>SSH passwords should not have been enabled for login over the Internet. Although the Infrastructure Team had attempted to configure the sshd daemon to disable password-based logins, having <code>UsePAM yes</code> set meant that password-based logins were still possible.</li>
<li>We use <a href="http://www.fail2ban.org">Fail2Ban</a> for many services, but we did not have it configured to track JIRA login failures.</li>
</ul>
<h2>What are we changing?</h2>
<ul>
<li>We have remedied the JIRA installation issues with our reinstall. JIRA is now installed by root and runs as a separate daemon with limited privileges.</li>
<li>For the time being we are running JIRA in a httpd-tomcat proxy config with the following rules:
<pre>
<code>
   ProxyPass /jira/secure/popups/colorpicker.jsp !
   ProxyPass /jira/secure/popups/grouppicker.jsp !
   ProxyPass /jira/secure/popups/userpicker.jsp !
   ProxyPass /jira        http://127.0.0.1:18080/jira
</code>
</pre>
<p>Sysadmins may find this useful to secure their JIRA installation until an upgrade is feasible.</p>
</li>
<li>We will be making one-time-passwords mandatory for all super-users, on all of our Linux and FreeBSD hosts.</li>
<li>We have disabled caching of svn passwords, and removed all currently cached svn passwords across all hosts ast the ASF via the global config <code>/etc/subversion/config</code> file:
<pre>
<code>
[auth]
store-passwords = no
</code>
</pre>
</li>
<li>Use Fail2Ban to protect web application login failures from brute force attacks</li>
</ul>
<p>We hope our disclosure has been as open as possible and true to the ASF spirit. Hopefully others can learn from our mistakes.</p>
