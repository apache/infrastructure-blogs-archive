<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Using SBT in Apache ESME | Blogs Archive</title>
<meta name="generator" content="Jekyll v3.9.3" />
<meta property="og:title" content="Using SBT in Apache ESME" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Introduction While many projects have been using Apache Maven as widely adopted and recognized project management tool, Scala-based Simple Build Tool (SBT) became very popular dependency management tool recently. SBT has following advantages: Buld file is written in Scala language which is much more concise comparing to verbose XML and provides full power of Scala platform and libraries SBT intelligently tracks changes in source code to make accurate recompilation SBT console mode keeps scalac in resident, which really improves compile times on subsequent runs. This is important for scalac, which is quite slow as compared to javac SBT supports continious compilation and testing While SBT is based on Apache Ivy, also very popular dependency management tool, it is possible to use both remote and local Maven repository with SBT SBT has Custom Actions That said SBT integration with popular IDEs and CI tools is not as good as Maven integration yet (I&#39;ll show an example of SBT and IDEA integration and give links to resources related to Hudson integration). It is possible to build ESME project both with Maven and SBT. At the moment Maven is main build tool. SBT might be used locally by developers to improve performance. Subject of this article is building project with SBT. &lt;/br&gt; Installation and configuration 1. Download SBT jar file and place it into local directory 2. Create script to launch SBT and specify path to SBT jar. For example, below is a script for Linux platform: java -XX:+CMSClassUnloadingEnabled -XX:MaxPermSize=256m -Xmx512M -Xss2M -jar `dirname $0`/sbt-launch-0.7.4.jar &quot;$@&quot; *JVM options above were added to launch script to avoid frequent OutOfMemory errors. Now it is possible to launch SBT. But before proceeding to project structure, it would be useful to know how SBT manages its dependencies. &lt;/br&gt; Dependency management As noted before, SBT is based on Apache Ivy &mdash; popular dependency management tool. It means that all dependencies will be downloaded to local repository (located by default in $USER_HOME/.ivy2 folder) and orginized in a manner similar to Maven: organization/module/artifact/revision, where organization and revision are analogs to Maven&#39;s groupId and version accordingly. All automatically managed dependencies, specified in project definition file, are placed into PROJECT_ROOT/lib_managed directory. &lt;/br&gt; Project structure Overall project structure has following form: ---&gt;ESME root | ---&gt;server | ---&gt;project | ----&gt;build | | | -----EsmeProject.scala | ----&gt;plugins | | | -----Plugins.scala | ----- build.properties SBT build artifacts have only been added to ESME server module, therefore they are located under server/project folder. These artifacts include: ESMEProject.scala &mdash; project definition file containing build configuration Plugins.scala &mdash; plugins for project definition are declared in this file build.properties &mdash; contains project name, version, organization, Scala and SBT versions and other custom properties The most important file among these is project file, so lets review it step-by-step. &lt;/br&gt; Project File Project definition class for web project EsmeProject should extend DefaultWebProject (which in turn implements base class for all types of projects sbt.Project): class EsmeProject(info: ProjectInfo) extends DefaultWebProject(info) Dependency versions are defined as vals: val liftVersion = &quot;2.2-RC6&quot; val compassVersion = &quot;2.1.1&quot; val luceneVersion = &quot;2.4.0&quot; It is possible to tell SBT to search dependencies in local Maven repository. To do that it&#39;s neccessary to define mavenLocal val and assign it to the path in the local filesystem where Maven repository resides: val mavenLocal = &quot;Local Maven Repository&quot; at &quot;file://&quot;+Path.userHome+&quot;/.m2/repository&quot; All additional repositories are also defined as vals. To include Scala Tools Snaphots repository predefined constant ScalaToolsSnapshots is used, for other repos explicit URL is specified: val scalatoolsSnapshot = ScalaToolsSnapshots val compassRepo = &quot;Compass Repository&quot; at &quot;http://repo.compass-project.org&quot; val twitterRepo = &quot;Twitter Repository&quot; at &quot;http://maven.twttr.com&quot; Project might contain additional files like licenses and notices. To include them in target jar it is neccessary to define method extraResources and override mainResources method, as shown below (assuming that both files are located in project&#39;s root directory) : def extraResources = &quot;LICENSE&quot; +++ &quot;NOTICE&quot; override def mainResources = super.mainResources +++ extraResources It&#39;s possible to specify dependency definition with Ivy configuration file inline (for example to include or exclude dependent modules). To do that, it is neccessary to override ivyXML method: override def ivyXML = SBT manages dependencies based on dependency expressions in project&#39;s definition file. Dependency expressions have following form: groupID % artifactID % revision % configuration In case dependency was build with SBT, it is neccessary to change first % to %%: groupID %% artifactID % revision % configuration That way SBT knows how to download correct jar corresponding to Scala version which is used to build project (for example lift-webkit_2.8.1-2.2-RC6.jar). It is possible to use range to specify version like in Maven. For example, value [6.1.6,) corresponds to all versions greater or equal to 6.1.6. Configuration has form A-&gt;B, where configuration A use a dependencys configuration B. ESME project definition contains compile and test configurations. As an example, expression &quot;junit&quot; % &quot;junit&quot; % &quot;4.4&quot; % &quot;test-&gt;default&quot; says that ESME test configuration uses JUnit default configuration. If no configuration mapping is specified explicitly, compile-&gt;default mapping is used by default. One way to list all dependencies is to define libraryDependencies method containing Set of dependency expressions: override def libraryDependencies = Set( &quot;net.liftweb&quot; %% &quot;lift-webkit&quot; % liftVersion % &quot;compile-&gt;default&quot;, &quot;net.liftweb&quot; %% &quot;lift-mapper&quot; % liftVersion % &quot;compile-&gt;default&quot;, ... &quot;org.compass-project&quot; % &quot;compass&quot; % compassVersion % &quot;compile-&gt;default&quot;, &quot;org.apache.lucene&quot; % &quot;lucene-core&quot; % luceneVersion % &quot;compile-&gt;default&quot;, ... &quot;org.mortbay.jetty&quot; % &quot;jetty&quot; % &quot;[6.1.6,)&quot; % &quot;test-&gt;default&quot;, &quot;junit&quot; % &quot;junit&quot; % &quot;4.4&quot; % &quot;test-&gt;default&quot;, ... ) ++ super.libraryDependencies &lt;/br&gt; Build properties SBT loader reads the versions of Scala and sbt to use to build the project from the project/build.properties file. If this is the first time the project has been built with those versions, the loader downloads the appropriate versions to project/boot directory. The sbt loader will then load the right version of the main sbt builder using the right version of Scala. Other user-defined properties might also be set in this file. Below is an example of build properties file for ESME: project.organization=Apache Software Foundation project.name=Apache Enterprise Social Messaging Environment (ESME) sbt.version=0.7.4 project.version=1.2 def.scala.version=2.8.1 build.scala.versions=2.8.1 project.initialize=false &lt;/br&gt; Plugins All plugins for SBT are specified in plugins definition file Plugins.scala. It&#39;s structure is very similar to project definition file. Lets review plugins configuration via example of sbt-idea plugin which is used to generate project artifacts for IntelliJ IDEA. Plugins class should extend PluginDefinition base class: class Plugins(info : ProjectInfo) extends PluginDefinition(info) Additional repositories which are used by plugins are declared as vals: val sbtIdeaRepo = &quot;sbt-idea-repo&quot; at &quot;http://mpeltonen.github.com/maven/&quot; Like in a project definition file, dependencies for plugins are specified via dependency expressions: val sbtIdea = &quot;com.github.mpeltonen&quot; % &quot;sbt-idea-plugin&quot; % &quot;0.1.0&quot; With sbt-idea plugin configured, it is possible to issue commands: sbt update sbt idea and IDEA project file will be generated in project&#39;s root directory. &lt;/br&gt; Main commands All interaction with SBT is performed via commands, which are usually executed in SBT console. To enter into SBT console, it&#39;s necessary to run sbt in a project directory. Clean First group of commands is used to clean generated and downloaded artifacts. clean command deletes target directory where all generated files are located. clean-cache command deletes local Ivy repository where downloaded artifacts and metadata for automatically managed dependencies for this user are resides. clean-lib command deletes lib_managed - managed library directory for this project. Update update command is used to resolve and download all external dependencies into local Ivy repository. Compile compile command preforms compilation of all Scala source files located in src/main/scala folder. It&#39;s possible to specify additional options for compile task by overriding compileOptions method. Test test command executes all tests that have been found during compilation. Runs test-compile command first (similar to compile task it&#39;s possible to specify additional options for test-compile task by overriding method testCompileOptions). Jetty jetty-run command starts the Jetty server and serves this project as a web application on http://localhost:8080 by default. This variant of starting Jetty is intended to be run from the interactive prompt. jetty-stop command stops the Jetty server that was started with the jetty-run action. &lt;/br&gt; Dependencies list Sometimes it&#39;s necessary to analyze all tree of used dependencies (to prevent conflicts between them for example). Maven has specific plugin dependency:tree to do just that. It&#39;s also possible to perform similar task with SBT via Project Console. console-project command starts the Scala interpreter with access to project and to sbt. For example, to get list of dependencies in compile classpath, current.publicClasspath command should be executed. Similar commands current.testClasspath and current.optionalClasspath exist for test classpath and optional classpath accordingly. &lt;/br&gt; Integration with Hudson While integration of SBT with Hudson, popular Continious Integration tool, hasn&#39;t been used in ESME project yet, there are some resources on this available: Hudson SBT plugin: https://github.com/hudson/sbt-plugin Christoph Henkelmann&rsquo;s Blog entry - &ldquo;How to build sbt projects with Hudson and integrate test results&rdquo; : http://henkelmann.eu/2010/11/14/sbt_hudson_with_test_integration &lt;/br&gt; Links Simple Build Tool home: http://code.google.com/p/simple-build-tool/ Apache Ivy home: http://ant.apache.org/ivy/ Lift Wiki page related to SBT: http://www.assembla.com/wiki/show/liftweb/Using_SBT Mikko Peltonen&#39;s sbt-idea plugin home: https://github.com/mpeltonen/sbt-idea &lt;/br&gt; A big thank you goes out to Vladimir Ivanov for the SBT implementation and for writing up this blog post explaining how it works! &lt;/br&gt;" />
<meta property="og:description" content="Introduction While many projects have been using Apache Maven as widely adopted and recognized project management tool, Scala-based Simple Build Tool (SBT) became very popular dependency management tool recently. SBT has following advantages: Buld file is written in Scala language which is much more concise comparing to verbose XML and provides full power of Scala platform and libraries SBT intelligently tracks changes in source code to make accurate recompilation SBT console mode keeps scalac in resident, which really improves compile times on subsequent runs. This is important for scalac, which is quite slow as compared to javac SBT supports continious compilation and testing While SBT is based on Apache Ivy, also very popular dependency management tool, it is possible to use both remote and local Maven repository with SBT SBT has Custom Actions That said SBT integration with popular IDEs and CI tools is not as good as Maven integration yet (I&#39;ll show an example of SBT and IDEA integration and give links to resources related to Hudson integration). It is possible to build ESME project both with Maven and SBT. At the moment Maven is main build tool. SBT might be used locally by developers to improve performance. Subject of this article is building project with SBT. &lt;/br&gt; Installation and configuration 1. Download SBT jar file and place it into local directory 2. Create script to launch SBT and specify path to SBT jar. For example, below is a script for Linux platform: java -XX:+CMSClassUnloadingEnabled -XX:MaxPermSize=256m -Xmx512M -Xss2M -jar `dirname $0`/sbt-launch-0.7.4.jar &quot;$@&quot; *JVM options above were added to launch script to avoid frequent OutOfMemory errors. Now it is possible to launch SBT. But before proceeding to project structure, it would be useful to know how SBT manages its dependencies. &lt;/br&gt; Dependency management As noted before, SBT is based on Apache Ivy &mdash; popular dependency management tool. It means that all dependencies will be downloaded to local repository (located by default in $USER_HOME/.ivy2 folder) and orginized in a manner similar to Maven: organization/module/artifact/revision, where organization and revision are analogs to Maven&#39;s groupId and version accordingly. All automatically managed dependencies, specified in project definition file, are placed into PROJECT_ROOT/lib_managed directory. &lt;/br&gt; Project structure Overall project structure has following form: ---&gt;ESME root | ---&gt;server | ---&gt;project | ----&gt;build | | | -----EsmeProject.scala | ----&gt;plugins | | | -----Plugins.scala | ----- build.properties SBT build artifacts have only been added to ESME server module, therefore they are located under server/project folder. These artifacts include: ESMEProject.scala &mdash; project definition file containing build configuration Plugins.scala &mdash; plugins for project definition are declared in this file build.properties &mdash; contains project name, version, organization, Scala and SBT versions and other custom properties The most important file among these is project file, so lets review it step-by-step. &lt;/br&gt; Project File Project definition class for web project EsmeProject should extend DefaultWebProject (which in turn implements base class for all types of projects sbt.Project): class EsmeProject(info: ProjectInfo) extends DefaultWebProject(info) Dependency versions are defined as vals: val liftVersion = &quot;2.2-RC6&quot; val compassVersion = &quot;2.1.1&quot; val luceneVersion = &quot;2.4.0&quot; It is possible to tell SBT to search dependencies in local Maven repository. To do that it&#39;s neccessary to define mavenLocal val and assign it to the path in the local filesystem where Maven repository resides: val mavenLocal = &quot;Local Maven Repository&quot; at &quot;file://&quot;+Path.userHome+&quot;/.m2/repository&quot; All additional repositories are also defined as vals. To include Scala Tools Snaphots repository predefined constant ScalaToolsSnapshots is used, for other repos explicit URL is specified: val scalatoolsSnapshot = ScalaToolsSnapshots val compassRepo = &quot;Compass Repository&quot; at &quot;http://repo.compass-project.org&quot; val twitterRepo = &quot;Twitter Repository&quot; at &quot;http://maven.twttr.com&quot; Project might contain additional files like licenses and notices. To include them in target jar it is neccessary to define method extraResources and override mainResources method, as shown below (assuming that both files are located in project&#39;s root directory) : def extraResources = &quot;LICENSE&quot; +++ &quot;NOTICE&quot; override def mainResources = super.mainResources +++ extraResources It&#39;s possible to specify dependency definition with Ivy configuration file inline (for example to include or exclude dependent modules). To do that, it is neccessary to override ivyXML method: override def ivyXML = SBT manages dependencies based on dependency expressions in project&#39;s definition file. Dependency expressions have following form: groupID % artifactID % revision % configuration In case dependency was build with SBT, it is neccessary to change first % to %%: groupID %% artifactID % revision % configuration That way SBT knows how to download correct jar corresponding to Scala version which is used to build project (for example lift-webkit_2.8.1-2.2-RC6.jar). It is possible to use range to specify version like in Maven. For example, value [6.1.6,) corresponds to all versions greater or equal to 6.1.6. Configuration has form A-&gt;B, where configuration A use a dependencys configuration B. ESME project definition contains compile and test configurations. As an example, expression &quot;junit&quot; % &quot;junit&quot; % &quot;4.4&quot; % &quot;test-&gt;default&quot; says that ESME test configuration uses JUnit default configuration. If no configuration mapping is specified explicitly, compile-&gt;default mapping is used by default. One way to list all dependencies is to define libraryDependencies method containing Set of dependency expressions: override def libraryDependencies = Set( &quot;net.liftweb&quot; %% &quot;lift-webkit&quot; % liftVersion % &quot;compile-&gt;default&quot;, &quot;net.liftweb&quot; %% &quot;lift-mapper&quot; % liftVersion % &quot;compile-&gt;default&quot;, ... &quot;org.compass-project&quot; % &quot;compass&quot; % compassVersion % &quot;compile-&gt;default&quot;, &quot;org.apache.lucene&quot; % &quot;lucene-core&quot; % luceneVersion % &quot;compile-&gt;default&quot;, ... &quot;org.mortbay.jetty&quot; % &quot;jetty&quot; % &quot;[6.1.6,)&quot; % &quot;test-&gt;default&quot;, &quot;junit&quot; % &quot;junit&quot; % &quot;4.4&quot; % &quot;test-&gt;default&quot;, ... ) ++ super.libraryDependencies &lt;/br&gt; Build properties SBT loader reads the versions of Scala and sbt to use to build the project from the project/build.properties file. If this is the first time the project has been built with those versions, the loader downloads the appropriate versions to project/boot directory. The sbt loader will then load the right version of the main sbt builder using the right version of Scala. Other user-defined properties might also be set in this file. Below is an example of build properties file for ESME: project.organization=Apache Software Foundation project.name=Apache Enterprise Social Messaging Environment (ESME) sbt.version=0.7.4 project.version=1.2 def.scala.version=2.8.1 build.scala.versions=2.8.1 project.initialize=false &lt;/br&gt; Plugins All plugins for SBT are specified in plugins definition file Plugins.scala. It&#39;s structure is very similar to project definition file. Lets review plugins configuration via example of sbt-idea plugin which is used to generate project artifacts for IntelliJ IDEA. Plugins class should extend PluginDefinition base class: class Plugins(info : ProjectInfo) extends PluginDefinition(info) Additional repositories which are used by plugins are declared as vals: val sbtIdeaRepo = &quot;sbt-idea-repo&quot; at &quot;http://mpeltonen.github.com/maven/&quot; Like in a project definition file, dependencies for plugins are specified via dependency expressions: val sbtIdea = &quot;com.github.mpeltonen&quot; % &quot;sbt-idea-plugin&quot; % &quot;0.1.0&quot; With sbt-idea plugin configured, it is possible to issue commands: sbt update sbt idea and IDEA project file will be generated in project&#39;s root directory. &lt;/br&gt; Main commands All interaction with SBT is performed via commands, which are usually executed in SBT console. To enter into SBT console, it&#39;s necessary to run sbt in a project directory. Clean First group of commands is used to clean generated and downloaded artifacts. clean command deletes target directory where all generated files are located. clean-cache command deletes local Ivy repository where downloaded artifacts and metadata for automatically managed dependencies for this user are resides. clean-lib command deletes lib_managed - managed library directory for this project. Update update command is used to resolve and download all external dependencies into local Ivy repository. Compile compile command preforms compilation of all Scala source files located in src/main/scala folder. It&#39;s possible to specify additional options for compile task by overriding compileOptions method. Test test command executes all tests that have been found during compilation. Runs test-compile command first (similar to compile task it&#39;s possible to specify additional options for test-compile task by overriding method testCompileOptions). Jetty jetty-run command starts the Jetty server and serves this project as a web application on http://localhost:8080 by default. This variant of starting Jetty is intended to be run from the interactive prompt. jetty-stop command stops the Jetty server that was started with the jetty-run action. &lt;/br&gt; Dependencies list Sometimes it&#39;s necessary to analyze all tree of used dependencies (to prevent conflicts between them for example). Maven has specific plugin dependency:tree to do just that. It&#39;s also possible to perform similar task with SBT via Project Console. console-project command starts the Scala interpreter with access to project and to sbt. For example, to get list of dependencies in compile classpath, current.publicClasspath command should be executed. Similar commands current.testClasspath and current.optionalClasspath exist for test classpath and optional classpath accordingly. &lt;/br&gt; Integration with Hudson While integration of SBT with Hudson, popular Continious Integration tool, hasn&#39;t been used in ESME project yet, there are some resources on this available: Hudson SBT plugin: https://github.com/hudson/sbt-plugin Christoph Henkelmann&rsquo;s Blog entry - &ldquo;How to build sbt projects with Hudson and integrate test results&rdquo; : http://henkelmann.eu/2010/11/14/sbt_hudson_with_test_integration &lt;/br&gt; Links Simple Build Tool home: http://code.google.com/p/simple-build-tool/ Apache Ivy home: http://ant.apache.org/ivy/ Lift Wiki page related to SBT: http://www.assembla.com/wiki/show/liftweb/Using_SBT Mikko Peltonen&#39;s sbt-idea plugin home: https://github.com/mpeltonen/sbt-idea &lt;/br&gt; A big thank you goes out to Vladimir Ivanov for the SBT implementation and for writing up this blog post explaining how it works! &lt;/br&gt;" />
<link rel="canonical" href="http://localhost:4000/esme/entry/using_sbt_in_apache_esme" />
<meta property="og:url" content="http://localhost:4000/esme/entry/using_sbt_in_apache_esme" />
<meta property="og:site_name" content="Blogs Archive" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2011-01-12T09:38:17-05:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Using SBT in Apache ESME" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2011-01-12T09:38:17-05:00","datePublished":"2011-01-12T09:38:17-05:00","description":"Introduction While many projects have been using Apache Maven as widely adopted and recognized project management tool, Scala-based Simple Build Tool (SBT) became very popular dependency management tool recently. SBT has following advantages: Buld file is written in Scala language which is much more concise comparing to verbose XML and provides full power of Scala platform and libraries SBT intelligently tracks changes in source code to make accurate recompilation SBT console mode keeps scalac in resident, which really improves compile times on subsequent runs. This is important for scalac, which is quite slow as compared to javac SBT supports continious compilation and testing While SBT is based on Apache Ivy, also very popular dependency management tool, it is possible to use both remote and local Maven repository with SBT SBT has Custom Actions That said SBT integration with popular IDEs and CI tools is not as good as Maven integration yet (I&#39;ll show an example of SBT and IDEA integration and give links to resources related to Hudson integration). It is possible to build ESME project both with Maven and SBT. At the moment Maven is main build tool. SBT might be used locally by developers to improve performance. Subject of this article is building project with SBT. &lt;/br&gt; Installation and configuration 1. Download SBT jar file and place it into local directory 2. Create script to launch SBT and specify path to SBT jar. For example, below is a script for Linux platform: java -XX:+CMSClassUnloadingEnabled -XX:MaxPermSize=256m -Xmx512M -Xss2M -jar `dirname $0`/sbt-launch-0.7.4.jar &quot;$@&quot; *JVM options above were added to launch script to avoid frequent OutOfMemory errors. Now it is possible to launch SBT. But before proceeding to project structure, it would be useful to know how SBT manages its dependencies. &lt;/br&gt; Dependency management As noted before, SBT is based on Apache Ivy &mdash; popular dependency management tool. It means that all dependencies will be downloaded to local repository (located by default in $USER_HOME/.ivy2 folder) and orginized in a manner similar to Maven: organization/module/artifact/revision, where organization and revision are analogs to Maven&#39;s groupId and version accordingly. All automatically managed dependencies, specified in project definition file, are placed into PROJECT_ROOT/lib_managed directory. &lt;/br&gt; Project structure Overall project structure has following form: ---&gt;ESME root | ---&gt;server | ---&gt;project | ----&gt;build | | | -----EsmeProject.scala | ----&gt;plugins | | | -----Plugins.scala | ----- build.properties SBT build artifacts have only been added to ESME server module, therefore they are located under server/project folder. These artifacts include: ESMEProject.scala &mdash; project definition file containing build configuration Plugins.scala &mdash; plugins for project definition are declared in this file build.properties &mdash; contains project name, version, organization, Scala and SBT versions and other custom properties The most important file among these is project file, so lets review it step-by-step. &lt;/br&gt; Project File Project definition class for web project EsmeProject should extend DefaultWebProject (which in turn implements base class for all types of projects sbt.Project): class EsmeProject(info: ProjectInfo) extends DefaultWebProject(info) Dependency versions are defined as vals: val liftVersion = &quot;2.2-RC6&quot; val compassVersion = &quot;2.1.1&quot; val luceneVersion = &quot;2.4.0&quot; It is possible to tell SBT to search dependencies in local Maven repository. To do that it&#39;s neccessary to define mavenLocal val and assign it to the path in the local filesystem where Maven repository resides: val mavenLocal = &quot;Local Maven Repository&quot; at &quot;file://&quot;+Path.userHome+&quot;/.m2/repository&quot; All additional repositories are also defined as vals. To include Scala Tools Snaphots repository predefined constant ScalaToolsSnapshots is used, for other repos explicit URL is specified: val scalatoolsSnapshot = ScalaToolsSnapshots val compassRepo = &quot;Compass Repository&quot; at &quot;http://repo.compass-project.org&quot; val twitterRepo = &quot;Twitter Repository&quot; at &quot;http://maven.twttr.com&quot; Project might contain additional files like licenses and notices. To include them in target jar it is neccessary to define method extraResources and override mainResources method, as shown below (assuming that both files are located in project&#39;s root directory) : def extraResources = &quot;LICENSE&quot; +++ &quot;NOTICE&quot; override def mainResources = super.mainResources +++ extraResources It&#39;s possible to specify dependency definition with Ivy configuration file inline (for example to include or exclude dependent modules). To do that, it is neccessary to override ivyXML method: override def ivyXML = SBT manages dependencies based on dependency expressions in project&#39;s definition file. Dependency expressions have following form: groupID % artifactID % revision % configuration In case dependency was build with SBT, it is neccessary to change first % to %%: groupID %% artifactID % revision % configuration That way SBT knows how to download correct jar corresponding to Scala version which is used to build project (for example lift-webkit_2.8.1-2.2-RC6.jar). It is possible to use range to specify version like in Maven. For example, value [6.1.6,) corresponds to all versions greater or equal to 6.1.6. Configuration has form A-&gt;B, where configuration A use a dependencys configuration B. ESME project definition contains compile and test configurations. As an example, expression &quot;junit&quot; % &quot;junit&quot; % &quot;4.4&quot; % &quot;test-&gt;default&quot; says that ESME test configuration uses JUnit default configuration. If no configuration mapping is specified explicitly, compile-&gt;default mapping is used by default. One way to list all dependencies is to define libraryDependencies method containing Set of dependency expressions: override def libraryDependencies = Set( &quot;net.liftweb&quot; %% &quot;lift-webkit&quot; % liftVersion % &quot;compile-&gt;default&quot;, &quot;net.liftweb&quot; %% &quot;lift-mapper&quot; % liftVersion % &quot;compile-&gt;default&quot;, ... &quot;org.compass-project&quot; % &quot;compass&quot; % compassVersion % &quot;compile-&gt;default&quot;, &quot;org.apache.lucene&quot; % &quot;lucene-core&quot; % luceneVersion % &quot;compile-&gt;default&quot;, ... &quot;org.mortbay.jetty&quot; % &quot;jetty&quot; % &quot;[6.1.6,)&quot; % &quot;test-&gt;default&quot;, &quot;junit&quot; % &quot;junit&quot; % &quot;4.4&quot; % &quot;test-&gt;default&quot;, ... ) ++ super.libraryDependencies &lt;/br&gt; Build properties SBT loader reads the versions of Scala and sbt to use to build the project from the project/build.properties file. If this is the first time the project has been built with those versions, the loader downloads the appropriate versions to project/boot directory. The sbt loader will then load the right version of the main sbt builder using the right version of Scala. Other user-defined properties might also be set in this file. Below is an example of build properties file for ESME: project.organization=Apache Software Foundation project.name=Apache Enterprise Social Messaging Environment (ESME) sbt.version=0.7.4 project.version=1.2 def.scala.version=2.8.1 build.scala.versions=2.8.1 project.initialize=false &lt;/br&gt; Plugins All plugins for SBT are specified in plugins definition file Plugins.scala. It&#39;s structure is very similar to project definition file. Lets review plugins configuration via example of sbt-idea plugin which is used to generate project artifacts for IntelliJ IDEA. Plugins class should extend PluginDefinition base class: class Plugins(info : ProjectInfo) extends PluginDefinition(info) Additional repositories which are used by plugins are declared as vals: val sbtIdeaRepo = &quot;sbt-idea-repo&quot; at &quot;http://mpeltonen.github.com/maven/&quot; Like in a project definition file, dependencies for plugins are specified via dependency expressions: val sbtIdea = &quot;com.github.mpeltonen&quot; % &quot;sbt-idea-plugin&quot; % &quot;0.1.0&quot; With sbt-idea plugin configured, it is possible to issue commands: sbt update sbt idea and IDEA project file will be generated in project&#39;s root directory. &lt;/br&gt; Main commands All interaction with SBT is performed via commands, which are usually executed in SBT console. To enter into SBT console, it&#39;s necessary to run sbt in a project directory. Clean First group of commands is used to clean generated and downloaded artifacts. clean command deletes target directory where all generated files are located. clean-cache command deletes local Ivy repository where downloaded artifacts and metadata for automatically managed dependencies for this user are resides. clean-lib command deletes lib_managed - managed library directory for this project. Update update command is used to resolve and download all external dependencies into local Ivy repository. Compile compile command preforms compilation of all Scala source files located in src/main/scala folder. It&#39;s possible to specify additional options for compile task by overriding compileOptions method. Test test command executes all tests that have been found during compilation. Runs test-compile command first (similar to compile task it&#39;s possible to specify additional options for test-compile task by overriding method testCompileOptions). Jetty jetty-run command starts the Jetty server and serves this project as a web application on http://localhost:8080 by default. This variant of starting Jetty is intended to be run from the interactive prompt. jetty-stop command stops the Jetty server that was started with the jetty-run action. &lt;/br&gt; Dependencies list Sometimes it&#39;s necessary to analyze all tree of used dependencies (to prevent conflicts between them for example). Maven has specific plugin dependency:tree to do just that. It&#39;s also possible to perform similar task with SBT via Project Console. console-project command starts the Scala interpreter with access to project and to sbt. For example, to get list of dependencies in compile classpath, current.publicClasspath command should be executed. Similar commands current.testClasspath and current.optionalClasspath exist for test classpath and optional classpath accordingly. &lt;/br&gt; Integration with Hudson While integration of SBT with Hudson, popular Continious Integration tool, hasn&#39;t been used in ESME project yet, there are some resources on this available: Hudson SBT plugin: https://github.com/hudson/sbt-plugin Christoph Henkelmann&rsquo;s Blog entry - &ldquo;How to build sbt projects with Hudson and integrate test results&rdquo; : http://henkelmann.eu/2010/11/14/sbt_hudson_with_test_integration &lt;/br&gt; Links Simple Build Tool home: http://code.google.com/p/simple-build-tool/ Apache Ivy home: http://ant.apache.org/ivy/ Lift Wiki page related to SBT: http://www.assembla.com/wiki/show/liftweb/Using_SBT Mikko Peltonen&#39;s sbt-idea plugin home: https://github.com/mpeltonen/sbt-idea &lt;/br&gt; A big thank you goes out to Vladimir Ivanov for the SBT implementation and for writing up this blog post explaining how it works! &lt;/br&gt;","headline":"Using SBT in Apache ESME","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/esme/entry/using_sbt_in_apache_esme"},"url":"http://localhost:4000/esme/entry/using_sbt_in_apache_esme"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Blogs Archive" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Blogs Archive</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Using SBT in Apache ESME</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2011-01-12T09:38:17-05:00" itemprop="datePublished">Jan 12, 2011
      </time>• <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">{"display_name"=>"Anne Kathrine Petterøe", "login"=>"akpetteroe", "email"=>"akpetteroe@apache.org"}</span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h3>Introduction</h3>
<p>While many projects have been using Apache Maven as widely adopted and recognized project management tool, Scala-based Simple Build Tool (SBT) became very popular dependency management tool recently. SBT has following advantages:</p>
<ul>
<li>Buld file is written in Scala language which is much more concise comparing to verbose XML and provides full power of Scala platform and libraries</li>
<li>SBT intelligently tracks changes in source code to make accurate recompilation</li>
<li>SBT console mode keeps scalac in resident, which really improves compile times on subsequent runs. This is important for scalac, which is quite slow as compared to javac</li>
<li>SBT supports continious compilation and testing</li>
<li>While SBT is based on Apache Ivy,  also very popular dependency management tool, it is possible to use both remote and local Maven repository with SBT</li>
<li>SBT has Custom Actions</li>
</ul>
<p>That said SBT integration with popular IDEs and CI tools is not as good as Maven integration yet (I'll show an example of SBT and IDEA integration and give links to resources related to Hudson integration).</p>
<p>It is possible to build ESME project both with Maven and SBT. At the moment Maven is main build tool. SBT might be used locally by developers to improve performance. Subject of this article is building project with SBT.</p>
<p></br></p>
<h3>Installation and configuration</h3>
<p>1. Download SBT jar file and place it into local directory<br />
2. Create script to launch SBT and specify path to SBT jar.  For example, below is a script for Linux platform:</p>
<p><i>java -XX:+CMSClassUnloadingEnabled -XX:MaxPermSize=256m -Xmx512M -Xss2M -jar `dirname $0`/sbt-launch-0.7.4.jar "$@"</i></p>
<p>*JVM options above were added to launch script to avoid frequent OutOfMemory errors.</p>
<p>Now it is possible to launch SBT. But before proceeding to project structure, it would be useful to know how SBT manages its dependencies.</p>
<p></br></p>
<h3>Dependency management</h3>
<p>As noted before, SBT is based on Apache Ivy &mdash; popular dependency management tool. It means that all dependencies will be downloaded to local repository (located by default in <i>$USER_HOME/.ivy2</i> folder) and orginized in a manner similar to Maven: <i>organization/module/artifact/revision</i>, where <i>organization</i> and <i>revision</i> are analogs to Maven's <i>groupId</i> and <i>version</i> accordingly. All automatically managed dependencies, specified in project definition file, are placed into <i>PROJECT_ROOT/lib_managed</i> directory.</p>
<p></br></p>
<h3>Project structure</h3>
<p>Overall project structure has following form:</p>
<p><i>--->ESME root<br />
|<br />
--->server<br />
       |<br />
       --->project<br />
              |<br />
              ---->build<br />
              |   |<br />
              |   -----EsmeProject.scala<br />
              |<br />
              ---->plugins<br />
              |   |<br />
              |   -----Plugins.scala<br />
              |<br />
              ----- build.properties</i></p>
<p>SBT build artifacts have only been added to ESME server module, therefore they are located under <i>server/project</i> folder. These artifacts include:<br />
	<i>ESMEProject.scala</i> &mdash; project definition file containing build configuration<br />
 	<i>Plugins.scala</i> &mdash; plugins for project definition are declared in this file<br />
	<i>build.properties</i> &mdash; contains project name, version, organization, Scala and SBT versions and other custom properties</p>
<p>The most important file among these is project file, so lets review it step-by-step.</p>
<p></br></p>
<h3>Project File</h3>
<p>Project definition class for web project EsmeProject should extend <i>DefaultWebProject</i> (which in turn implements base class for all types of projects <i>sbt.Project</i>):<br />
<i>class EsmeProject(info: ProjectInfo) extends DefaultWebProject(info)</i></p>
<p>Dependency versions are defined as vals:<br />
<i>val liftVersion = "2.2-RC6"<br />
val compassVersion = "2.1.1"<br />
val luceneVersion = "2.4.0"</i></p>
<p>It is possible to tell SBT to search dependencies in local Maven repository. To do that it's neccessary to define mavenLocal val and assign it to the path in the local filesystem where Maven repository resides:<br />
<i>val mavenLocal = "Local Maven Repository" at "file://"+Path.userHome+"/.m2/repository"</i></p>
<p>All additional repositories are also defined as vals. To include Scala Tools Snaphots repository predefined constant <i>ScalaToolsSnapshots</i> is used, for other repos explicit URL is specified:<br />
<i>val scalatoolsSnapshot = ScalaToolsSnapshots<br />
val compassRepo = "Compass Repository" at "http://repo.compass-project.org"<br />
val twitterRepo = "Twitter Repository" at "http://maven.twttr.com"</i></p>
<p>Project might contain additional files like licenses and notices. To include them in target jar it is neccessary to define method <i>extraResources</i> and override <i>mainResources</i> method, as shown below (assuming that both files are located in project's root directory) :<br />
<i>def extraResources = "LICENSE" +++ "NOTICE"<br />
override def mainResources = super.mainResources +++ extraResources</i></p>
<p>It's possible to specify dependency definition with Ivy configuration file inline (for example to include or exclude dependent modules). To do that, it is neccessary to override <i>ivyXML</i> method:<br />
<i>override def ivyXML =<br />
    <dependencies><br />
      <dependency org="net.lag" name="configgy" rev="2.0.1"><br />
        <exclude org="org.scala-tools" module="vscaladoc"/><br />
      </dependency><br />
      <dependency org="com.twitter" name="ostrich" rev="2.3.2"><br />
        <exclude org="org.scala-tools" module="vscaladoc"/><br />
      </dependency><br />
    </dependencies></i></p>
<p>SBT manages dependencies based on dependency expressions in project's definition file. Dependency expressions have following form:<br />
<i>groupID % artifactID % revision % configuration</i></p>
<p>In case dependency was build with SBT, it is neccessary to change first <i>%</i> to <i>%%</i>:<br />
<i>groupID %% artifactID % revision % configuration</i></p>
<p>That way SBT knows how to download correct jar corresponding to Scala version which is used to build project (for example <i>lift-webkit_2.8.1-2.2-RC6.jar</i>).</p>
<p>It is possible to use range to specify version like in Maven. For example, value [6.1.6,) corresponds to all versions greater or equal to 6.1.6.</p>
<p>Configuration has form <i>A->B</i>, where configuration A use a dependencys configuration B. ESME project definition contains compile and test configurations. As an example, expression <i>"junit" % "junit" % "4.4" % "test->default"</i> says that ESME test configuration uses JUnit default configuration. </p>
<p>If no configuration mapping is specified explicitly, <i>compile->default</i> mapping is used by default.</p>
<p>One way to list all dependencies is to define <i>libraryDependencies</i> method containing Set of dependency expressions:<br />
<i>override def libraryDependencies = Set(<br />
    "net.liftweb" %% "lift-webkit" % liftVersion % "compile->default",<br />
    "net.liftweb" %% "lift-mapper" % liftVersion % "compile->default",<br />
...<br />
    "org.compass-project" % "compass" % compassVersion % "compile->default",<br />
    "org.apache.lucene" % "lucene-core" % luceneVersion % "compile->default",<br />
...<br />
    "org.mortbay.jetty" % "jetty" % "[6.1.6,)" % "test->default",<br />
    "junit" % "junit" % "4.4" % "test->default",<br />
...<br />
  ) ++ super.libraryDependencies</i>    </p>
<p> </br>  </p>
<h3>Build properties</h3>
<p>SBT loader reads the versions of Scala and sbt to use to build the project from the <i>project/build.properties</i> file. If this is the first time the project has been built with those versions, the loader downloads the appropriate versions to <i>project/boot</i> directory. The sbt loader will then load the right version of the main sbt builder using the right version of Scala. Other user-defined properties might also be set in this file. Below is an example of build properties file for ESME:</p>
<p><i>project.organization=Apache Software Foundation<br />
project.name=Apache Enterprise Social Messaging Environment (ESME)<br />
sbt.version=0.7.4<br />
project.version=1.2<br />
def.scala.version=2.8.1<br />
build.scala.versions=2.8.1<br />
project.initialize=false</i></p>
<p></br></p>
<h3>Plugins</h3>
<p>All plugins for SBT are specified in plugins definition file <i>Plugins.scala</i>. It's structure is very similar to project definition file. Lets review plugins configuration via example of <i>sbt-idea</i> plugin which is used to generate project artifacts for IntelliJ IDEA.</p>
<p>Plugins class should extend PluginDefinition base class:<br />
<i>class Plugins(info : ProjectInfo) extends PluginDefinition(info)</i></p>
<p>Additional repositories which are used by plugins are declared as vals:<br />
<i>val sbtIdeaRepo = "sbt-idea-repo" at "http://mpeltonen.github.com/maven/"</i></p>
<p>Like in a project definition file, dependencies for plugins are specified via dependency expressions:<br />
<i>val sbtIdea = "com.github.mpeltonen" % "sbt-idea-plugin" % "0.1.0"</i></p>
<p>With sbt-idea plugin configured, it is possible to issue commands:<br />
<i>sbt update<br />
sbt idea</i></p>
<p>and IDEA project file will be generated in project's root directory.</p>
<p></br></p>
<h3>Main commands</h3>
<p>All interaction with SBT is performed via commands, which are usually executed in SBT console. To enter into SBT console, it's necessary to run <i>sbt</i> in a project directory.</p>
<p><b>Clean</b><br />
First group of commands is used to clean generated and downloaded artifacts.<br />
<i>clean</i> command deletes <i>target</i> directory where all generated files are located.<br />
<i>clean-cache</i> command deletes local Ivy repository where downloaded artifacts and metadata for automatically managed dependencies for this user are resides.<br />
<i>clean-lib</i> command deletes <i>lib_managed</i> - managed library directory for this project.</p>
<p><b>Update</b><br />
<i>update</i> command is used to resolve and download all external dependencies into local Ivy repository.</p>
<p><b>Compile</b><br />
<i>compile</i> command preforms compilation of all Scala source files located in <i>src/main/scala</i> folder. It's possible to specify additional options for compile task by overriding <i>compileOptions</i> method.</p>
<p><b>Test</b><br />
<i>test</i> command executes all tests that have been found during compilation. Runs <i>test-compile</i> command first (similar to <i>compile</i> task it's possible to specify additional options for <i>test-compile</i> task by overriding method <i>testCompileOptions</i>).</p>
<p><b>Jetty</b><br />
<i>jetty-run</i> command starts the Jetty server and serves this project as a web application on http://localhost:8080 by default. This variant of starting Jetty is intended to be run from the interactive prompt.<br />
<i>jetty-stop</i> command stops the Jetty server that was started with the jetty-run action.</p>
<p></br></p>
<h3>Dependencies list</h3>
<p>Sometimes it's necessary to analyze all tree of used dependencies (to prevent conflicts between them for example). Maven has specific plugin <i>dependency:tree</i> to do just that. It's also possible to perform similar task with SBT via Project Console.</p>
<p><i>console-project</i> command starts the Scala interpreter with access to project and to sbt.</p>
<p>For example, to get list of dependencies in compile classpath, <i>current.publicClasspath</i> command should be executed. Similar commands <i>current.testClasspath</i> and <i>current.optionalClasspath</i> exist for test classpath and optional classpath accordingly.</p>
<p></br></p>
<h3>Integration with Hudson</h3>
<p>While integration of SBT with Hudson, popular Continious Integration tool, hasn't been used in ESME project yet, there are some resources on this available:<br />
Hudson SBT plugin: <a href="https://github.com/hudson/sbt-plugin">https://github.com/hudson/sbt-plugin</a><br />
Christoph Henkelmann&rsquo;s Blog entry - &ldquo;How to build sbt projects with Hudson and integrate test results&rdquo; : <a href="http://henkelmann.eu/2010/11/14/sbt_hudson_with_test_integration">http://henkelmann.eu/2010/11/14/sbt_hudson_with_test_integration</a></p>
<p></br></p>
<h3>Links</h3>
<p>Simple Build Tool home: <a href="http://code.google.com/p/simple-build-tool/">http://code.google.com/p/simple-build-tool/</a><br />
Apache Ivy home: <a href="http://ant.apache.org/ivy/">http://ant.apache.org/ivy/</a><br />
Lift Wiki page related to SBT: <a href="http://www.assembla.com/wiki/show/liftweb/Using_SBT">http://www.assembla.com/wiki/show/liftweb/Using_SBT</a><br />
Mikko Peltonen's sbt-idea plugin home: <a href="https://github.com/mpeltonen/sbt-idea">https://github.com/mpeltonen/sbt-idea</a><br />
</br><br />
A big thank you goes out to Vladimir Ivanov for the SBT implementation and for writing up this blog post explaining how it works!<br />
</br></p>

  </div><a class="u-url" href="/esme/entry/using_sbt_in_apache_esme" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Blogs Archive</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Blogs Archive</li><li><a class="u-email" href="mailto:issues@infra.apache.org">issues@infra.apache.org</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/jekyll"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">jekyll</span></a></li><li><a href="https://www.twitter.com/jekyllrb"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">jekyllrb</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>This is an archive of the Roller blogs that were previously hosted on blogs.apache.org</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
