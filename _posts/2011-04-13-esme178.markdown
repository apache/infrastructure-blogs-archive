---
layout: post
title: 'LDAP-based Authentication with Apache ESME and Apache Directory Server '
date: '2011-04-13T07:10:57+00:00'
categories: esme
---
<p class=" "><span>This blog was written by our new committer&nbsp;<i>Vladimir Ivanov</i>&nbsp;who implemented a feature that users have been wanting for a long time.&nbsp;</span> </p> 
  <p class=" "><span>In this blog, I'll discuss how container-managed authentication works
with an LDAP server and how to connect and get additional information from it.
I'll use Jetty and Apache Tomcat web servers with Apache Directory Server (ADS)
1.5.7 - a certified LDAPv3 compatible server. It is also possible to use
different LDAP compatible server such as a 389 Directory Server or MS Active
Directory.</span></p> 
  <p class=" "><span> </span></p> 
  <p class=" "><span>An LDAP server is a directory service that contains objects organized in
a hierarchical manner.</span></p> 
  <h2><span>Apache Directory Server (ADS)</span></h2> 
  <p class=" "><span> </span></p> 
  <p class=" "><span>The ADS project page provides a detailed server installation and
configuration guide, but here are the basic steps: during the installation, the
default server instance will be created. The configuration settings for this
instance are defined in the <em>server.xml</em> file as Spring bean definitions.
Below is an excerpt from the configuration file that was used for this
blog.<span> </span></span></p> 
  <p class=" "><span> </span></p> 
  <p class=" "><u><span>server.xml</span></u></p> 
  <p class=" "><u><span> </span></u></p> 
  <p class=" "><span>First of all, it is necessary to create a new partition:</span></p> 
  <blockquote class="webkit-indent-blockquote" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 40px; border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; "> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">...</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">&lt;partitions&gt;
</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">... </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">&lt;jdbmPartition id=&quot;lester&quot;
suffix=&quot;dc=lester,dc=org&quot; /&gt; </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">&lt;/partitions&gt; </span></p> 
  </blockquote> 
  <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "> </span></p> 
  <p class=" "><span>Ports that LDAP server will use are specified as tcpTransport elements:</span></p> 
  <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "> </span></p> 
  <blockquote class="webkit-indent-blockquote" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 40px; border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; "> 
    <p class=" "><font face="'Courier New'"><span style="font-size: 12px; "> </span></font></p> 
    <p class="MsoNormal"><font face="'Courier New'"><span style="font-size: 12px; "> </span></font></p> 
    <p><font face="'Courier New'"><span style="font-size: 12px; "> </span></font></p> 
    <p class="MsoNormal"><font face="'Courier New'"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>&lt;ldapServer
id=&quot;ldapServer&quot; <o:p /></span></font></p><font face="'Courier New'"> 
      <p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>allowAnonymousAccess=&quot;false&quot; <o:p /></span></p> 
      <p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span><span> </span>saslHost=&quot;ldap.example.com&quot; <o:p /></span></p> 
      <p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>saslPrincipal=&quot;ldap/ldap.example.com@EXAMPLE.COM&quot; <o:p /></span></p> 
      <p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>searchBaseDn=&quot;ou=users,ou=system&quot; <o:p /></span></p> 
      <p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>maxTimeLimit=&quot;15000&quot; <o:p /></span></p> 
      <p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>maxSizeLimit=&quot;1000&quot;&gt; <o:p /></span></p> 
      <p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>&lt;transports&gt; <o:p /></span></p> 
      <p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>&lt;tcpTransport address=&quot;0.0.0.0&quot; port=&quot;10389&quot;
nbThreads=&quot;8&quot; backLog=&quot;50&quot; enableSSL=&quot;false&quot;/&gt;
<o:p /></span></p> 
      <p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>&lt;tcpTransport address=&quot;localhost&quot; port=&quot;10636&quot;
enableSSL=&quot;true&quot;/&gt; <o:p /></span></p> 
      <p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>&lt;/transports&gt; <o:p /></span></p> 
      <p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>&lt;/ldapServer&gt;<o:p /></span></p></font> 
    <p> </p> 
    <p> </p> 
  </blockquote> 
  <p> </p> 
  <p>The local path to the directory containing LDIF files should also be
specified:<br /> </p> 
  <blockquote class="webkit-indent-blockquote" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 40px; border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; "> 
    <p class=" "><font face="'Courier New'"><span style="font-size: 12px; "> </span></font></p> 
    <p class="MsoNormal"><font face="'Courier New'"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>&lt;apacheDS
id=&quot;apacheDS&quot;&gt; <o:p /></span></font></p><font face="'Courier New'"> 
      <p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>&lt;ldapServer&gt;#ldapServer&lt;/ldapServer&gt; <o:p /></span></p> 
      <p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>&lt;ldifDirectory&gt;<b>PATH_TO_ADS_INSTALL_DIR/instances/default/ldif</b>&lt;/ldifDirectory&gt;
<o:p /></span></p> 
      <p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>&lt;/apacheDS&gt;&nbsp;<o:p /></span></p></font> 
    <p> </p> 
  </blockquote> 
  <p class=" "><em><span> </span></em></p> 
  <p class=" "><span> </span></p> 
  <p class=" "><em><span> </span></em></p> 
  <p class=" "><span>Other configuration settings were left unchanged.</span></p> 
  <p class=" "><span> </span></p> 
  <p class=" "><span>Now It is time to create the directory structure. I used the popular
open source tool JXplorer for this task.</span></p> 
  <p class=" "><span> </span></p> 
  <p class=" "><span> </span></p> 
  <p class=" "><span>It is possible to export the directory structure from the JXplorer tool
to the LDIF file â€” directory content in text format. Let's review the generated
file.</span></p> 
  <p class=" "><span> </span></p> 
  <p class=" "><u><span>lester.ldif</span></u></p> 
  <p class=" "><u><span> </span></u></p> 
  <p class=" "><span>Below is a record list beginning from the top. Note that each record has
specific set of object classes defined in this schema. Each object class
defines specific set of attributes, for example, <em>person</em> class defines <em>Surname</em>
(<em>sn</em>) and <em>Given Name</em> (<em>givenName</em>) attributes. One object
class can extend another, for example <em>organizationalPerson </em>class extends
<em>person </em>class. <em>top</em> is a superclass for all other classes.</span></p> 
  <p class=" "><span> </span></p> 
  <p class=" "><span>Domain <em>lester.org</em> is the root of this hierarchy:<span> </span></span></p> 
  <p class=" "><span> </span></p> 
  <blockquote class="webkit-indent-blockquote" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 40px; border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; "> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">dn: dc=lester,dc=org </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">objectClass: extensibleObject </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">objectClass: domain </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">objectClass: top </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">dc: lester </span></p> 
  </blockquote> 
  <p class=" "><em><span> </span></em></p> 
  <p class=" "><em><span> </span></em></p> 
  <p class=" "><span>The Organizational Unit <em>esme </em>is placed one level lower:</span></p> 
  <p class=" "><span> </span></p> 
  <blockquote class="webkit-indent-blockquote" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 40px; border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; "> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">dn: ou=esme,dc=lester,dc=org </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">objectClass: organizationalUnit </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">objectClass: top </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">ou: esme </span></p> 
  </blockquote> 
  <p class=" "><em><span> </span></em></p> 
  <p class=" "><span>The Organizational Unit<em> Groups </em>resides under the <em>esme</em>
Organizational Unit:</span></p> 
  <p class=" "><span> </span></p> 
  <blockquote class="webkit-indent-blockquote" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 40px; border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; "> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">dn: ou=Groups,ou=esme,dc=lester,dc=org </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">objectClass: organizationalUnit </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">objectClass: top </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">ou: Groups </span></p> 
  </blockquote> 
  <p class=" "><em><span> </span></em></p> 
  <p class=" "><span>There is only one group <em>esme-users</em> on the lowest level of the hierarchy
and it has the <em>vivanov</em> user (specified by a <span> </span>full path) as a unique member:</span></p> 
  <p class=" "><span> </span></p> 
  <blockquote class="webkit-indent-blockquote" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 40px; border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; "> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">dn: cn=esme-users,ou=Groups,ou=esme,dc=lester,dc=org </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">objectClass: groupOfUniqueNames </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">objectClass: top </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">cn: esme-users </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">ou: Groups </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">uniqueMember:
uid=vivanov,ou=Users,ou=esme,dc=lester,dc=org </span></p> 
  </blockquote> 
  <p class=" "><em><span> </span></em></p> 
  <p class=" "><span>The Organizational Unit<em> Users </em>resides under the <em>esme</em>
organizational unit:</span></p> 
  <p class=" "><span> </span></p> 
  <blockquote class="webkit-indent-blockquote" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 40px; border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; "> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">dn: ou=Users,ou=esme,dc=lester,dc=org </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">objectClass: organizationalUnit </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">objectClass: top </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">ou: Users </span></p> 
  </blockquote> 
  <p class=" "><em><span> </span></em></p> 
  <p class=" "><span>The user <em>vivanov </em>and its corresponding attributes are defined on the
lowest level of the hierarchy:</span></p> 
  <p class=" "><span> </span></p> 
  <blockquote class="webkit-indent-blockquote" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 40px; border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; "> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">dn: uid=vivanov,ou=Users,ou=esme,dc=lester,dc=org </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">objectClass: organizationalPerson </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">objectClass: person </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">objectClass: uidObject </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">objectClass: inetOrgPerson </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">objectClass: top </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">cn: vivanov </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">givenName: Vladimir </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">mail: vivanov@lester.org </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">ou: Users </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">sn: Ivanov </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">telephoneNumber: +7 111 222 33 44 </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">uid: vivanov </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">userPassword:: cXdlcnR5 </span></p> 
  </blockquote> 
  <p class=" "><em><span> </span></em></p> 
  <p class=" "><span>There is also a special user with administrative rights: <em>uid=admin,ou=system
</em>(default password: <em>secret</em>) defined in <em>system</em> schema. It was
used to connect to ADS from JXplorer.</span></p> 
  <p class=" "><span> </span></p> 
  <p class=" "><span>Those were all basic steps necessary to configure ADS for purpose of
this b log. Let's move to the configuration of the web servers.</span></p> 
  <h2><span>Configuration</span></h2> 
  <p class=" "><strong><span> </span></strong></p> 
  <p class=" "><span>Before digging into the configuration details specific for each web
server, let's review the common properties used to connect to the LDAP server.</span></p> 
  <p class=" "><span> </span></p> 
  <p class=" "><span>First of all, it is necessary to specify the hostname / ip address and the
port of our LDAP server â€” <em>localhost:10389</em>, as well as the credentials
for an account that has rights to perform search operation and get attributes
for users and roles in a directory tree. The special <em>admin</em> user
described in previous section was also used for this purpose in this blog.
Sometimes anonymous access is also permitted.</span></p> 
  <p class=" "><span> </span></p> 
  <p class=" "><span>The next set of properties, user base and group base, specify the base
context with which to lookup users and groups. For our configuration web server
will search users under <em>ou=Users,ou=esme,dc=lester,dc=org</em> and groups
under <em>ou=Groups,ou=esme,dc=lester,dc=org</em> paths in the directory tree
accordingly.<span> </span></span></p> 
  <p class=" "><span> </span></p> 
  <p class=" "><span>The user id and role name attributes specify the prefix for user/group
search filter. In our example, it has the <span> </span><em>uid</em> value for users and the <em>cn </em>value
for groups.</span></p> 
  <p class=" "><span> </span></p> 
  <p class=" "><span>The <em>uniqueMember</em> attribute is
used to check whether the user belongs to the specified group.</span></p> 
  <p class=" "><span> </span></p> 
  <p class=" "><span>Now it is time to review the configuration for each of the web servers.</span></p> 
  <p class=" "><span> </span></p> 
  <p class=" "><strong><span>Note:</span></strong><span> The required <em>lift-ldap</em>
dependency has been already included in <em>pom.xml</em>.</span></p> 
  <h3><span>Jetty</span></h3> 
  <p class=" "><span>In order to configure Jetty to use LDAP server, two additional Maven
dependencies: <em>jetty-plus</em> and <em>jetty-ldap-jaas</em> should be added to
the <em>pom.xml </em><span>file</span>.
Configuration of <em>maven-jetty-plugin </em>includes the following steps: set the
<em>JAASUserRealm<strong> </strong></em>as an user realm implementation and specify the <span> </span><em>ldaploginmodule </em>as the login module
name. It is also necessary to set the system property <em>java.security.auth.login.config
</em>with the<em> ldap-loginModule.conf </em>value:</span></p> 
  <p class=" "><span> </span></p> 
  <p class=" "><u><span>pom.xml</span></u></p> 
  <p class=" "><u><span> </span></u></p> 
  <blockquote class="webkit-indent-blockquote" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 40px; border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; "> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">&lt;dependency&gt;</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">&lt;groupId&gt;org.mortbay.jetty&lt;/groupId&gt;</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">&lt;artifactId&gt;jetty-plus&lt;/artifactId&gt;</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">&lt;version&gt;[6.1.6,)&lt;/version&gt;</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">&lt;scope&gt;compile&lt;/scope&gt;</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">&lt;/dependency&gt;</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">&lt;dependency&gt;</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">&lt;groupId&gt;org.mortbay.jetty&lt;/groupId&gt;</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">&lt;artifactId&gt;<strong>jetty-ldap-jaas</strong>&lt;/artifactId&gt;</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">&lt;version&gt;[6.1.6,)&lt;/version&gt;</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">&lt;scope&gt;compile&lt;/scope&gt;</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">&lt;/dependency&gt;</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">&lt;plugin&gt;</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">&lt;groupId&gt;org.mortbay.jetty&lt;/groupId&gt;</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">&lt;artifactId&gt;maven-jetty-plugin&lt;/artifactId&gt;</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">&lt;configuration&gt;</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">&lt;contextPath&gt;/&lt;/contextPath&gt;</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">&lt;scanIntervalSeconds&gt;0&lt;/scanIntervalSeconds&gt;</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">&lt;userRealms&gt;</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">&lt;userRealm
implementation=&quot;org.mortbay.jetty.plus.jaas.JAASUserRealm&quot;&gt;</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">&lt;name&gt;ESMERealm&lt;/name&gt;</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">&lt;loginModuleName&gt;<strong>ldaploginmodule</strong>&lt;/loginModuleName&gt;</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">&lt;/userRealm&gt;</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">&lt;/userRealms&gt;</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">&lt;systemProperties&gt;</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">&lt;systemProperty&gt;</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">&lt;name&gt;java.security.auth.login.config&lt;/name&gt;</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">&lt;value&gt;ldap-loginModule.conf&lt;/value&gt;</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">&lt;/systemProperty&gt;</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">&lt;/systemProperties&gt;</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">&lt;/configuration&gt;</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">&lt;/plugin&gt;</span></p> 
  </blockquote> 
  <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "> </span></p> 
  <p class=" "><em><span> </span></em></p> 
  <p class=" "><span>The file <em>ldap-loginModule.conf</em> is placed under the <em>ESME_ROOT/server</em>
folder. It specifies login module implementation class - <em>LdapLoginModule </em>as
well as LDAP-specific connection properties:</span></p> 
  <p class=" "><span> </span></p> 
  <p class=" "><u><span>ldap-loginModule.conf</span></u></p> 
  <p class=" "><u><span> </span></u></p> 
  <blockquote class="webkit-indent-blockquote" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 40px; border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; "> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">ldaploginmodule {</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">org.mortbay.jetty.plus.jaas.ldap.LdapLoginModule
required</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">debug=&quot;true&quot;</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">useLdaps=&quot;false&quot;</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">contextFactory=&quot;com.sun.jndi.ldap.LdapCtxFactory&quot;</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">hostname=&quot;localhost&quot;</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">port=&quot;10389&quot;</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">bindDn=&quot;uid=admin,ou=system&quot;</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">bindPassword=&quot;secret&quot;</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">authenticationMethod=&quot;simple&quot;</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">forceBindingLogin=&quot;false&quot;</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">userBaseDn=&quot;ou=Users,ou=esme,dc=lester,dc=org&quot;</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">userRdnAttribute=&quot;uid&quot;</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">userIdAttribute=&quot;uid&quot;</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">userPasswordAttribute=&quot;userPassword&quot;</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">userObjectClass=&quot;inetOrgPerson&quot;</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">roleBaseDn=&quot;ou=Groups,ou=esme,dc=lester,dc=org&quot;</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">roleNameAttribute=&quot;cn&quot;</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">roleMemberAttribute=&quot;uniqueMember&quot;</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">roleObjectClass=&quot;groupOfUniqueNames&quot;;</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">};</span></p> 
  </blockquote> 
  <p class=" "><font face="'Courier New'"><span style="font-size: 12px; "><a name="id.85a2218e86a9"></a></span></font></p> 
  <p class=" "><em><span> </span></em></p> 
  <p class=" "><span>Note that for some environments <em>forceBindingLogin </em>attribute<em> </em>must
also be set to <em>true</em>.</span></p> 
  <h3><span>Tomcat</span></h3> 
  <p class=" "><strong><span> </span></strong></p> 
  <p class=" "><span>The only required change in the Tomcat's <em>server.xml</em> configuration
file (compared to the changes described in the last blog) is a different realm
-<span> </span><em>JNDIRealm</em>. This realm is used
to connect to LDAP server and search users/groups:</span></p> 
  <p class=" "><span> </span></p> 
  <p class=" "><u><span>server.xml</span></u></p> 
  <p class=" "><u><span> </span></u></p> 
  <blockquote class="webkit-indent-blockquote" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 40px; border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; "> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">...</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">&lt;Realm
className=&quot;org.apache.catalina.realm.JNDIRealm&quot; </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">connectionName=&quot;uid=admin,ou=system&quot; </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">connectionPassword=&quot;secret&quot; </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">connectionURL=&quot;ldap://localhost:10389&quot; debug=&quot;99&quot; </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">referrals=&quot;follow&quot; </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">roleBase=&quot;ou=Groups,ou=esme,dc=lester,dc=org&quot; </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">roleName=&quot;cn&quot; </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">roleSearch=&quot;(uniqueMember={0})&quot; </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">roleSubtree=&quot;true&quot; </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">userBase=&quot;ou=Users,ou=esme,dc=lester,dc=org&quot; </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">userSearch=&quot;(uid={0})&quot; </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">userSubtree=&quot;true&quot;/&gt; </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">â€¦</span></p> 
  </blockquote> 
  <p class=" "><span> </span></p> 
  <h3><span>LDAPVendor and ESMELdap.properties
file</span></h3> 
  <p class=" "><strong><span> </span></strong></p> 
  <p class=" "><span>The web server is now configured to perform CMA. But the Servlet API
makes only the user principal available for application. In order to fill ESME
user's profile, additional attributes such as firstname, lastname and email are
needed. We will use LDAP server to retrieve these attributes. Let's review
changes in UserAuth.scala, specifically in <em>ContainerManagedAuthModule </em>object:</span></p> 
  <p class=" "><span> </span></p> 
  <p class=" "><u><span>UserAuth.scala</span></u></p> 
  <p class=" "><u><span> </span></u></p> 
  <p class=" "><span>To connect to the LDAP server from application first of all, <span> </span>it is necessary to create aq subclass of <em>net.lift.ldap.LDAPVendor</em>
class:</span></p> 
  <p class=" "><span> </span></p> 
  <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>object
myLdapVendor extends LDAPVendor</span></p> 
  <p class=" "><em><span> </span></em></p> 
  <p class=" "><span>All LDAP-specific connection properties are placed into a resource
bundle â€” plaintext property file with key-value pairs. It is possible to get
property values by key with the <em>S.?</em> method:</span></p> 
  <p class=" "><span> </span></p> 
  <blockquote class="webkit-indent-blockquote" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 40px; border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; "> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">def myLdap :
LDAPVendor = {</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">val
ldapSrvHost = S.?(&quot;ldap.server.host&quot;)</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">val
ldapSrvPort = S.?(&quot;ldap.server.port&quot;)</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">val
ldapSrvBase = S.?(&quot;ldap.server.base&quot;)</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">val
ldapSrvUsrName = S.?(&quot;ldap.server.userName&quot;)</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">val
ldapSrvPwd = S.?(&quot;ldap.server.password&quot;)</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">val
ldapSrvAuthType = S.?(&quot;ldap.server.authType&quot;)</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">val
ldapSrvReferral= S.?(&quot;ldap.server.referral&quot;)</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">val
ldapSrvCtxFactory = S.?(&quot;ldap.server.initial_context_factory&quot;)</span></p> 
  </blockquote> 
  <p class=" "><em><span> </span></em></p> 
  <p class=" "><span>The next step is to configure the <em>LDAPVendor </em>subclass with these
values:</span></p> 
  <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "> </span></p> 
  <blockquote class="webkit-indent-blockquote" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 40px; border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; "> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">myLdapVendor.configure(Map(&quot;ldap.url&quot; -&gt;
&quot;ldap://%s:%s&quot;.format(ldapSrvHost, ldapSrvPort),</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">&quot;ldap.base&quot; -&gt; ldapSrvBase,</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">&quot;ldap.userName&quot; -&gt; ldapSrvUsrName,</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">&quot;ldap.password&quot; -&gt;
ldapSrvPwd,</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">&quot;ldap.authType&quot; -&gt; ldapSrvAuthType,</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">&quot;referral&quot; -&gt; ldapSrvReferral,</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">&quot;ldap.initial_context_factory&quot; -&gt; ldapSrvCtxFactory))</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">myLdapVendor</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">}</span></p> 
  </blockquote> 
  <p class=" "><em><span> </span></em></p> 
  <p class=" "><span>The method <em>getAttrs</em> takes the username as a parameter and returns
a map of [attribute name / list of attribute values] pairs (attribute in LDAP
might contain more than one value) for this user. Let's review the method
definition. It is possible to get attributes for user with <em>LDAPVendor.attributesFromDn()</em>
method.<span> </span>It takes the distinguished name
as a parameter, so it is necessary to append the prefix and the user base from the
property file to the username to construct it. Note that the <em>attributesFromDn</em>
method returns <em>javax.naming.directory.Attributes</em> therefore the interfaces
from <a name="id.e82d238b7d29"></a><em>javax.naming.directory </em>package must be
imported correctly:</span></p> 
  <p class=" "><span> </span></p> 
  <blockquote class="webkit-indent-blockquote" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 40px; border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; "> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">import _root_.javax.naming.directory.{Attributes,
Attribute =&gt; Attr}</span></p> 
  </blockquote> 
  <p class=" "><em><span> </span></em></p> 
  <p class=" "><span>The shorthand <em>Attr </em>is used for the <em>javax.naming.directory.Attribute</em>
because the <em>scala.xml.Attribute</em> trait<em> </em>has already been imported
and placed in scope.</span></p> 
  <p class=" "><span> </span></p> 
  <p class=" "><span>Then attribute's id and values are used to populate the result map. </span></p> 
  <p class=" "><span> </span></p> 
  <p class=" "><span>The<em> getAttrs</em></span><span> method definition
is shown below:<span> </span><em></em></span></p> 
  <p class=" "><span> </span></p> 
  <blockquote class="webkit-indent-blockquote" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 40px; border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; "> 
    <p class=" "><font face="'Courier New'"><span style="font-size: 12px; "> </span></font></p> 
    <p class="MsoNormal"><font face="'Courier New'"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>def
getAttrs(who : String) : Map[String, List[String]] = {<o:p /></span></font></p><font face="'Courier New'"> 
      <p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><o:p> </o:p></span></p> 
      <p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>val
uidPrefix = S.?(&quot;ldap.uidPrefix&quot;)<o:p /></span></p> 
      <p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>val userBase
= S.?(&quot;ldap.userBase&quot;)<o:p /></span></p> 
      <p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><o:p> </o:p></span></p> 
      <p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>var attrsMap
= Map.empty[String, List[String]]<o:p /></span></p> 
      <p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>val dn =
&quot;%s=%s,%s&quot;.format(uidPrefix, who, userBase)<o:p /></span></p> 
      <p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><o:p> </o:p></span></p> 
      <p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>val attrs :
Attributes = myLdap.attributesFromDn(dn)<o:p /></span></p> 
      <p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>if (attrs !=
null) {<o:p /></span></p> 
      <p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>val
allAttrs = attrs.getAll();<o:p /></span></p> 
      <p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>if
(allAttrs != null) {<o:p /></span></p> 
      <p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>while(allAttrs.hasMore()) {<o:p /></span></p> 
      <p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>val
attribute = allAttrs.next().asInstanceOf[Attr];<o:p /></span></p> 
      <p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>var
attrValues = List.empty[String]<o:p /></span></p> 
      <p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>for(i
&lt;- 0 until attribute.size()) {<o:p /></span></p> 
      <p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>attrValues ::= attribute.get(i).toString<o:p /></span></p> 
      <p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>}<o:p /></span></p> 
      <p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>attrsMap += (attribute.getID() -&gt; attrValues)<o:p /></span></p> 
      <p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>}<o:p /></span></p> 
      <p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>}<o:p /></span></p> 
      <p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>}<o:p /></span></p> 
      <p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>attrsMap<o:p /></span></p> 
      <p class="MsoNormal"><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>}<o:p /></span></p></font> 
    <p> </p> 
  </blockquote> 
  <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "> </span></p> 
  <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "> </span></p> 
  <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "> </span></p> 
  <p class=" "><em><span> </span></em></p> 
  <p class=" "><span>The last step is to modify the <em>performInit</em> method. First of all, it
is necessary to check if LDAP is enabled as configured in the property file.
Then the values for attributes <em>givenName</em>, <em>sn</em> and <em>mail</em> are
extracted from the map, returned via the <em>getAttrs</em> method call and then used
to populate <em>User</em> instance.</span></p> 
  <p class=" "><span> </span></p> 
  <p class=" "><font face="'Courier New'"> </font></p> 
  <p class="MsoNormal" style="font-size: 12px; "><font face="'Courier New'"><span style="font-size: 9pt; font-family: 'Courier New'; ">def performInit(): Unit = {<o:p /></span></font></p><font face="'Courier New'"><span style="font-size: 12px; "> </span> 
    <p class="MsoNormal" style="font-size: 12px; "><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>...<o:p /></span></p><span style="font-size: 12px; "> </span> 
    <p class="MsoNormal" style="font-size: 12px; "><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>val usr =
User.createAndPopulate.nickname(username).saveMe<o:p /></span></p><span style="font-size: 12px; "> </span> 
    <p class="MsoNormal" style="font-size: 12px; "><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>//find and
save additional attributes in LDAP if It is enabled<o:p /></span></p><span style="font-size: 12px; "> </span> 
    <p class="MsoNormal" style="font-size: 12px; "><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>val
ldapEnabled = S.?(&quot;ldap.enabled&quot;)<o:p /></span></p><span style="font-size: 12px; "> </span> 
    <p class="MsoNormal" style="font-size: 12px; "><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>if(ldapEnabled.toBoolean) {<o:p /></span></p><span style="font-size: 12px; "> </span> 
    <p class="MsoNormal" style="font-size: 12px; "><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>val
ldapAttrs = getAttrs(username)<o:p /></span></p><span style="font-size: 12px; "> </span> 
    <p class="MsoNormal" style="font-size: 12px; "><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>val
firstName = ldapAttrs(&quot;givenName&quot;).head<o:p /></span></p><span style="font-size: 12px; "> </span> 
    <p class="MsoNormal" style="font-size: 12px; "><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>val
lastName = ldapAttrs(&quot;sn&quot;).head<o:p /></span></p><span style="font-size: 12px; "> </span> 
    <p class="MsoNormal" style="font-size: 12px; "><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>val mail
= ldapAttrs(&quot;mail&quot;).head<o:p /></span></p><span style="font-size: 12px; "> </span> 
    <p class="MsoNormal" style="font-size: 12px; "><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>usr.firstName(firstName).lastName(lastName).save<o:p /></span></p><span style="font-size: 12px; "> </span> 
    <p class="MsoNormal" style="font-size: 12px; "><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>}<o:p /></span></p><span style="font-size: 12px; "> </span> 
    <p class="MsoNormal" style="font-size: 12px; "><span style="font-size: 9pt; font-family: 'Courier New'; "><span> </span>...<o:p /></span></p><span style="font-size: 12px; "> </span> 
    <p class="MsoNormal" style="font-size: 12px; "><span style="font-size: 9pt; font-family: 'Courier New'; ">}<o:p /></span></p></font> 
  <p> </p> 
  <p class=" "><em><span> </span></em></p> 
  <p class=" "><span>The<em> ESMELdap </em></span><span>property file is
shown below. It essentially resembles connection properties in web server
configuration files that we have seen previously.<em></em></span></p> 
  <p class=" "><span> </span></p> 
  <p class=" "><u><span>ESMELdap.properties file</span></u></p> 
  <p class=" "><u><span> </span></u></p> 
  <blockquote class="webkit-indent-blockquote" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 40px; border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; "> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">#This flag specifies whether LDAP should be used </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">ldap.enabled=true </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "># Hostname or IP of LDAP server </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">ldap.server.host=localhost </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "># Port
 of LDAP server </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">ldap.server.port=10389 </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "># Base DN from the LDAP Server </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">ldap.server.base=ou=esme,dc=lester,dc=org </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "># User that has access to LDAP server to perform
search operations </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">ldap.server.userName=uid=admin,ou=system </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "># Password for user above </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">ldap.server.password=secret </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "># Authentication type </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">ldap.server.authType=simple </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "># Referral </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">ldap.server.referral=follow </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "># Initial context factory class </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">ldap.server.initial_context_factory=com.sun.jndi.ldap.LdapCtxFactory
</span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "># Prefix for user to whom additional LDAP attributes
belong, for example 'uid' or 'sAMAccountName' </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">ldap.cnPrefix=uid </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "># User base DN for user to whom additional LDAP
attributes belong </span></p> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">ldap.userBase=ou=Users,ou=esme,dc=lester,dc=org</span></p> 
  </blockquote> 
  <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "> </span></p> 
  <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; "> </span></p> 
  <p class=" "><em><span> </span></em></p> 
  <p class=" "><span>The last thing that must be done is to tell Lift where to look for the <em>ESMELdap.properties</em>
file. The list of resource file names is assigned to <em>LiftRules.resourceNames
</em>var<em> </em>in<em> Boot.scala</em>:</span></p> 
  <p class=" "><span> </span></p> 
  <p class=" "><u><span>Boot.scala</span></u></p> 
  <p class=" "><u><span> </span></u></p> 
  <blockquote class="webkit-indent-blockquote" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 40px; border-top-style: none; border-right-style: none; border-bottom-style: none; border-left-style: none; border-width: initial; border-color: initial; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; "> 
    <p class=" "><span style="font-size: 9pt; font-family: 'Courier New'; ">LiftRules.resourceNames = &quot;ESMELdap&quot; :: &quot;ESMECustom&quot;
:: &quot;ESMEBase&quot; :: &quot;ESMEUI&quot; :: Nil</span></p> 
  </blockquote> 
  <p class=" "><em><span> </span></em></p> 
  <h2><span>Conclusion</span></h2> 
  <p class=" "><strong><span> </span></strong></p> 
  <p class=" "><span>We have just configured both web servers - Jetty and Tomcat - to perform
authentication and authorization via LDAP. We have also improved <em>ContainerManagedAuthModule</em>
to get additional attributes for authenticated user from LDAP with Lift LDAP
API.</span></p> 
  <p class=" "><span> </span></p> 
  <h2><span>Links</span></h2> 
  <p class=" " style="margin-left: 0cm; text-indent: 0cm; "><!--[if !supportLists]--><strong><span style="font-size: 10pt; font-family: 'Times New Roman'; "><span>1.<span style="font: normal normal normal 7pt/normal 'Times New Roman'; "> </span></span></span></strong><!--[endif]--><strong><span>Apache Directory Server: </span></strong><span><a href="http://directory.apache.org/apacheds/1.5/"><span style="color: black; text-decoration: none; ">http</span></a><a href="http://directory.apache.org/apacheds/1.5/"><span style="color: black; text-decoration: none; ">://</span></a><a href="http://directory.apache.org/apacheds/1.5/"><span style="color: black; text-decoration: none; ">directory</span></a><a href="http://directory.apache.org/apacheds/1.5/"><span style="color: black; text-decoration: none; ">.</span></a><a href="http://directory.apache.org/apacheds/1.5/"><span style="color: black; text-decoration: none; ">apache</span></a><a href="http://directory.apache.org/apacheds/1.5/"><span style="color: black; text-decoration: none; ">.</span></a><a href="http://directory.apache.org/apacheds/1.5/"><span style="color: black; text-decoration: none; ">org</span></a><a href="http://directory.apache.org/apacheds/1.5/"><span style="color: black; text-decoration: none; ">/</span></a><a href="http://directory.apache.org/apacheds/1.5/"><span style="color: black; text-decoration: none; ">apacheds</span></a><a href="http://directory.apache.org/apacheds/1.5/"><span style="color: black; text-decoration: none; ">/1.5/</span></a></span><strong><span></span></strong></p> 
  <p class=" " style="margin-left: 0cm; text-indent: 0cm; "><!--[if !supportLists]--><strong><span style="font-size: 10pt; font-family: 'Times New Roman'; "><span>2.<span style="font: normal normal normal 7pt/normal 'Times New Roman'; "> </span></span></span></strong><!--[endif]--><strong><span>Jxplorer: </span></strong><span><a href="http://jxplorer.org/"><span style="color: black; text-decoration: none; ">http</span></a><a href="http://jxplorer.org/"><span style="color: black; text-decoration: none; ">://</span></a><a href="http://jxplorer.org/"><span style="color: black; text-decoration: none; ">jxplorer</span></a><a href="http://jxplorer.org/"><span style="color: black; text-decoration: none; ">.</span></a><a href="http://jxplorer.org/"><span style="color: black; text-decoration: none; ">org</span></a><a href="http://jxplorer.org/"><span style="color: black; text-decoration: none; ">/</span></a></span><strong><span></span></strong></p> 
  <p class=" " style="margin-left: 0cm; text-indent: 0cm; "><!--[if !supportLists]--><strong><span style="font-size: 10pt; font-family: 'Times New Roman'; "><span>3.<span style="font: normal normal normal 7pt/normal 'Times New Roman'; "> </span></span></span></strong><!--[endif]--><strong><span>Jetty login modules:&nbsp;</span></strong><a href="http://docs.codehaus.org/display/JETTY/JAAS"><span style="color: black; text-decoration: none; ">http</span></a><a href="http://docs.codehaus.org/display/JETTY/JAAS"><span style="color: black; text-decoration: none; ">://</span></a><a href="http://docs.codehaus.org/display/JETTY/JAAS"><span style="color: black; text-decoration: none; ">docs</span></a><a href="http://docs.codehaus.org/display/JETTY/JAAS"><span style="color: black; text-decoration: none; ">.</span></a><a href="http://docs.codehaus.org/display/JETTY/JAAS"><span style="color: black; text-decoration: none; ">codehaus</span></a><a href="http://docs.codehaus.org/display/JETTY/JAAS"><span style="color: black; text-decoration: none; ">.</span></a><a href="http://docs.codehaus.org/display/JETTY/JAAS"><span style="color: black; text-decoration: none; ">org</span></a><a href="http://docs.codehaus.org/display/JETTY/JAAS"><span style="color: black; text-decoration: none; ">/</span></a><a href="http://docs.codehaus.org/display/JETTY/JAAS"><span style="color: black; text-decoration: none; ">display</span></a><a href="http://docs.codehaus.org/display/JETTY/JAAS"><span style="color: black; text-decoration: none; ">/</span></a><a href="http://docs.codehaus.org/display/JETTY/JAAS"><span style="color: black; text-decoration: none; ">JETTY</span></a><a href="http://docs.codehaus.org/display/JETTY/JAAS"><span style="color: black; text-decoration: none; ">/</span></a><a href="http://docs.codehaus.org/display/JETTY/JAAS"><span style="color: black; text-decoration: none; ">JAAS</span></a></p> 
  <p class=" "><span></span></p> 
  <p class=" "><span><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">http</span></a><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">://</span></a><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">jetty</span></a><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">.</span></a><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">codehaus</span></a><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">.</span></a><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">org</span></a><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">/</span></a><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">jetty</span></a><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">/</span></a><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">jetty</span></a><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">-6/</span></a><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">apidocs</span></a><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">/</span></a><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">org</span></a><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">/</span></a><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">mortbay</span></a><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">/</span></a><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">jetty</span></a><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">/</span></a><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">plus</span></a><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">/</span></a><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">jaas</span></a><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">/</span></a><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">ldap</span></a><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">/</span></a><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">LdapLoginModule</span></a><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">.</span></a><a href="http://jetty.codehaus.org/jetty/jetty-6/apidocs/org/mortbay/jetty/plus/jaas/ldap/LdapLoginModule.html"><span style="color: black; text-decoration: none; ">html</span></a></span><span></span></p> 
  <p class=" " style="margin-left: 0cm; text-indent: 0cm; "><!--[if !supportLists]--><strong><span style="font-size: 10pt; font-family: 'Times New Roman'; "><span>4.<span style="font: normal normal normal 7pt/normal 'Times New Roman'; "> </span></span></span></strong><!--[endif]--><strong><span>Tomcat user realms: </span></strong><span><a href="http://tomcat.apache.org/tomcat-6.0-doc/realm-howto.html"><span style="color: black; text-decoration: none; ">http</span></a><a href="http://tomcat.apache.org/tomcat-6.0-doc/realm-howto.html"><span style="color: black; text-decoration: none; ">://</span></a><a href="http://tomcat.apache.org/tomcat-6.0-doc/realm-howto.html"><span style="color: black; text-decoration: none; ">tomcat</span></a><a href="http://tomcat.apache.org/tomcat-6.0-doc/realm-howto.html"><span style="color: black; text-decoration: none; ">.</span></a><a href="http://tomcat.apache.org/tomcat-6.0-doc/realm-howto.html"><span style="color: black; text-decoration: none; ">apache</span></a><a href="http://tomcat.apache.org/tomcat-6.0-doc/realm-howto.html"><span style="color: black; text-decoration: none; ">.</span></a><a href="http://tomcat.apache.org/tomcat-6.0-doc/realm-howto.html"><span style="color: black; text-decoration: none; ">org</span></a><a href="http://tomcat.apache.org/tomcat-6.0-doc/realm-howto.html"><span style="color: black; text-decoration: none; ">/</span></a><a href="http://tomcat.apache.org/tomcat-6.0-doc/realm-howto.html"><span style="color: black; text-decoration: none; ">tomcat</span></a><a href="http://tomcat.apache.org/tomcat-6.0-doc/realm-howto.html"><span style="color: black; text-decoration: none; ">-6.0-</span></a><a href="http://tomcat.apache.org/tomcat-6.0-doc/realm-howto.html"><span style="color: black; text-decoration: none; ">doc</span></a><a href="http://tomcat.apache.org/tomcat-6.0-doc/realm-howto.html"><span style="color: black; text-decoration: none; ">/</span></a><a href="http://tomcat.apache.org/tomcat-6.0-doc/realm-howto.html"><span style="color: black; text-decoration: none; ">realm</span></a><a href="http://tomcat.apache.org/tomcat-6.0-doc/realm-howto.html"><span style="color: black; text-decoration: none; ">-</span></a><a href="http://tomcat.apache.org/tomcat-6.0-doc/realm-howto.html"><span style="color: black; text-decoration: none; ">howto</span></a><a href="http://tomcat.apache.org/tomcat-6.0-doc/realm-howto.html"><span style="color: black; text-decoration: none; ">.</span></a><a href="http://tomcat.apache.org/tomcat-6.0-doc/realm-howto.html"><span style="color: black; text-decoration: none; ">html</span></a></span><strong><span></span></strong></p> 
  <p><strong><span style="font-size: 10pt; font-family: 'Times New Roman'; "><span>5.<span style="font: normal normal normal 7pt/normal 'Times New Roman'; "> </span></span></span></strong><strong><span>Lift API:</span></strong><span> </span><span><a href="http://scala-tools.org/mvnsites/liftweb-2.3/"><span style="color: black; text-decoration: none; ">http</span></a><a href="http://scala-tools.org/mvnsites/liftweb-2.3/"><span style="color: black; text-decoration: none; ">://</span></a><a href="http://scala-tools.org/mvnsites/liftweb-2.3/"><span style="color: black; text-decoration: none; ">scala</span></a><a href="http://scala-tools.org/mvnsites/liftweb-2.3/"><span style="color: black; text-decoration: none; ">-</span></a><a href="http://scala-tools.org/mvnsites/liftweb-2.3/"><span style="color: black; text-decoration: none; ">tools</span></a><a href="http://scala-tools.org/mvnsites/liftweb-2.3/"><span style="color: black; text-decoration: none; ">.</span></a><a href="http://scala-tools.org/mvnsites/liftweb-2.3/"><span style="color: black; text-decoration: none; ">org</span></a><a href="http://scala-tools.org/mvnsites/liftweb-2.3/"><span style="color: black; text-decoration: none; ">/</span></a><a href="http://scala-tools.org/mvnsites/liftweb-2.3/"><span style="color: black; text-decoration: none; ">mvnsites</span></a><a href="http://scala-tools.org/mvnsites/liftweb-2.3/"><span style="color: black; text-decoration: none; ">/</span></a><a href="http://scala-tools.org/mvnsites/liftweb-2.3/"><span style="color: black; text-decoration: none; ">liftweb</span></a><a href="http://scala-tools.org/mvnsites/liftweb-2.3/"><span style="color: black; text-decoration: none; ">-2.3/</span></a></span> </p> 
  <p> </p> 
  <p> </p> 
  <p> </p>
