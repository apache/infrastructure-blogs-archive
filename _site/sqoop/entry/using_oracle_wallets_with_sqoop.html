<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Using Oracle Wallets with Sqoop Jobs | Blogs Archive</title>
<meta name="generator" content="Jekyll v3.9.3" />
<meta property="og:title" content="Using Oracle Wallets with Sqoop Jobs" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="How to Secure Apache Sqoop Jobs with Oracle Wallet Apache Sqoop is a tool that transfers data between the Hadoop ecosystem and enterprise data stores. Sqoop does this by providing methods to transfer data to HDFS or Hive (using HCatalog). Oracle Database is one of the databases supported by Apache Sqoop. With Oracle Database, the database connection credentials are stored in Oracle Wallet. Oracle Wallet can act as the store of keys and secrets such as authentication credentials. This post describes how Oracle Wallet Manager adds a secure authentication layer for Sqoop jobs. &lt;/p&gt; In order to connect to an external database, Sqoop users must provide a set of credentials specific to that data store. These credentials are typically in the form of user name and password. &lt;/p&gt; Some enterprises may already be standardized on credential management tools provided by their enterprise DBMS vendor. These companies may not be comfortable with any of Sqoop&rsquo;s three authentication methods: ● Password provided on the command line ● Password read from the console during the interactive execution of a Sqoop job. ● Password provided on a secure file system that only the user can access. &lt;/p&gt; With Oracle Database, the database connection credentials can be securely stored in an Oracle Wallet. The use of Oracle Wallet can allay the security concerns mentioned above because it provides a secure client-side software container allowing secure storage of authentication and signing credentials. With support for Oracle Wallet, Sqoop jobs no longer need to embed usernames and passwords. This reduces the risk of exposing credentials and eases enforcement of authentication policies, since application code and scripts need not change whenever usernames or passwords change. &lt;/p&gt; Instructions for Using Oracle Wallets for External Password Store &lt;/p&gt; Please note that the following steps were tested with Oracle 11gR2 database. We expect these instructions should be applicable to other versions of Oracle DB, but they were not tested on versions other than Oracle 11gR2. &lt;/p&gt; At a high-level, these are the steps (which we describe in detail below): ● Create an Oracle client-side wallet ● Create tnsnames.ora and sqlnet.ora files ● Add the database access credentials to the Oracle wallet ● Test the Oracle wallet ● Use the Oracle wallet for Sqoop jobs ● Modify the JDBC URL for the connection to use the wallet ● Run the Sqoop job with Oracle wallet Create an Oracle Client-Side Wallet The first step is to create an Oracle wallet to hold the credentials used by Sqoop jobs. Oracle provides various tools to manage the Oracle Wallet. This document describes one of those: the mkstore command line tool. The mkstore command can be used to create the wallet: &lt;/p&gt; mkstore -wrl -create&lt;/span&gt;&lt;/p&gt; That command line creates a client side wallet at the location &lt;/span&gt;. Substitute &lt;/span&gt; to your valid directory location.&lt;/p&gt; It will be an auto-logon wallet. So before a client process can use the wallet, the ownership of the wallet directory and files (owner and group) must match the process uid and gid. Make sure that the password matches the database minimum requirements. Create tnsnames.ora and sqlnet.ora Files The Oracle database uses a few network configuration files. The files tnsnames.ora and sqlnet.ora are used for configuring client side network access. tnsnames.ora The configuration file tnsnames.ora has client side local naming parameters. The contents of tnsnames.ora are used to map the network service name to an Oracle database connection descriptor.&lt;/p&gt; Here is an example of a tnsnames.ora file: W_ORCL = ( DESCRIPTION = (ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.64.51)(PORT = 1521)) (CONNECT_DATA = (SERVER = DEDICATED) (SERVICE_NAME = orcl) ) ) In the above tnsnames.ora file, the network service name W_ORCL is mapped to a connection descriptor accessing a database instance named ORCL running on a host with an IP address 192.168.64.51.&lt;/p&gt; sqlnet.ora The configuration file sqlnet.ora is used to specify client side network configuration properties that influence the connection profiles. This file configures tracing, authentication, routing, and advanced security parameters. Here is an example of a sqlnet.ora file: WALLET_LOCATION = (SOURCE = (METHOD = FILE) (METHOD_DATA = (DIRECTORY = )&lt;/span&gt;&lt;/p&gt; ) )&lt;/p&gt; SQLNET.WALLET_OVERRIDE = TRUE SSL_CLIENT_AUTHENTICATION = FALSE&lt;/p&gt; &lt;/td&gt; &lt;/tr&gt; &lt;/tbody&gt; &lt;/table&gt; The tnsnames.ora and sqlnet.ora files can be placed in separate directories or they can both be placed in the wallet directory. Add the Database Access Credentials to the Oracle Wallet Now that we&rsquo;ve created an Oracle Wallet, we need to populate it with the database access credentials. We can use the -createCredential option to the mkstore command to do this:&lt;/p&gt; mkstore -wrl -createCredential &lt;/span&gt;&lt;/p&gt; ● is the directory where the wallet files will be stored&lt;/span&gt;&lt;/p&gt; ● is the service name defined in tnsnames.ora&lt;/span&gt;&lt;/p&gt; ● is the username to access the database&lt;/span&gt;&lt;/p&gt; ● is the database password for the user &lt;/span&gt;&lt;/p&gt;&lt;/p&gt; For example, with the sample service defined in tnsames.ora, and a DB user &ldquo;sqoop&rdquo; using password &ldquo;sqooppwd&rdquo;, the command invocation would be:&lt;/p&gt; mkstore -wrl -createCredential w_orcl sqoop sqooppwd&lt;/span&gt;&lt;/p&gt; This will prompt for the wallet password, which should be same as the one used when creating the wallet. Test the Oracle Wallet A quick way to test the password is to attempt a DB session with SQLPLUS. If the tnsnames.ora and sqlnet.ora settings are not in the default location ($ORACLE_HOME/network/admin), then you can provide the location of these files using the TNS_ADMIN environment variable.&lt;/p&gt; Assuming the tnsnames.ora and sqlnet.ora are under $HOME/wallet_test, do the following: export TNS_ADMIN=$HOME/wallet_test sqlplus /@ # in our case w_orcl&lt;/span&gt;&lt;/p&gt; This command should successfully establish the connection. If it does not, check the tnsnames.ora contents to make sure the DB host, port or service name are correct. If the service name in tnsnames.ora changes, then the wallet entry has to be created/modified. Use the Oracle Wallet for Sqoop Jobs After successfully validating the wallet, it can be used for Sqoop jobs. There are a few steps for providing the wallet with Sqoop: ● Provide the wallet to the Sqoop launcher ● Provision the wallet to the mapper tasks ● Make command line changes for the Sqoop launcher program ● Specify the location of the wallet and Oracle configuration files to the mapper tasks ● Specify the option to localize the files to the mapper tasks ● Modify the JDBC URL Provide the Wallet to the Sqoop Launcher For the Sqoop client program and the mappers launched by the Sqoop job, we have to specify the location for the wallet and the tnsnames.ora and sqlnet.ora files. Add the following files to the $SQOOP_HOME/lib directory (typically SQOOP_HOME is set to /usr/lib/sqoop):&lt;/p&gt; ● oraclepki.jar ● osdt_cert.jar ● osdt_core.jar ● ojdbc6.jar These jars are available as part of an Oracle Database installation. Provision the Wallet to the Mapper Tasks Copy the contents of the wallet directory from the database host along with the tnsnames.ora and sqlnet.ora files to a folder, such as $HOME/wallet, as the operating system user who is launching the Sqoop command. The wallet directory will have the following files after this step:&lt;/p&gt; ● cwallet.sso ● ewallet.p12 ● sqlnet.ora ● tnsnames.ora&lt;/p&gt; The first two are the wallet files and the next two are the Oracle client network configuration files that we saw before. Make sure the wallet directory and the files in that directory are owned by the operating system user and the group ownership is the same as the Sqoop user group. Make Command Line Changes for the Sqoop Launcher Program Since the wallet location and the TNS locations are different from the defaults, we have to override the location of the wallet and the tnsnames.ora and sqlnames.ora files. Oracle JDBC exposes two properties for this purpose: ● oracle.net.tns_admin &ndash; Location of the tnsnames.ora and sqlnet.ora files ● oracle.net.wallet_location &ndash; Location of the wallet files, cwallet.sso and ewallet.p12 In this case we will set both these properties to $HOME/wallet.&lt;/p&gt; Setting these two system properties for Sqoop can be achieved by setting the system environment variable HADOOP_OPTS which will be used for setting additional Java options to the JVM. export HADOOP_OPTS= &quot;-Doracle.net.tns_admin=$HOME/wallet -Doracle.net.wallet_location=$HOME/wallet_test&quot; Specify the Location of the Wallet and Oracle Configuration Files to the Mapper Tasks While the client program uses the DB for retrieving metadata, the mapper tasks do the actual data transfer. To provide the wallet files to the mapper tasks, we specify them as part of the &ndash;files tool option to localize to each mapper. Also, we have to use the Hadoop configuration properties to pass specific Java command line options (similar to HADOOP_OPTS for the launcher). Specify the Option to Localize the Files to the Mapper Tasks This can be achieved by adding the &ndash;files option to the Sqoop command line. Please note that Hadoop options have to come before any Sqoop options. The option and option argument can be specified as follows: -files $HOME/wallet/cwallet.sso,\ $HOME/wallet/ewallet.p12,\ $HOME/wallet/sqlnet.ora,\ $HOME/wallet/tnsnames.ora &lt;/p&gt; We also have to tell the Mapper tasks the location of wallet and TNS files. We use the hadoop configuration parameter mapred.child.java.opts to provide additional Java options to the mappers. Note that we use the current directory as the location (&lsquo;.&rsquo;). This is because the files provided by the &ndash;files option will be localized to the current directory for each mapper task. -D mapred.map.child.java.opts=&rsquo;-Doracle.net.tns_admin=. -Doracle.net.wallet_location=.&#39; &lt;/p&gt; If there are additional Java options that need to be provided for the mappers, they should be added to the Java options given below. For example, to add the system property -Djava.security.egd=file:/dev/./urandom, the options would be specified as: -D mapred.map.child.java.opts=&rsquo;-Doracle.net.tns_admin=. -Doracle.net.wallet_location=. &ndash;Djava.security.egd=file:/dev/./urandom&#39;&lt;/p&gt; Modify the JDBC URL The JDBC URL provided should use the format jdbc:oracle:thin:@SVC where the SVC is the service name used for accessing the database. This is added as part of the createCredential command above and should also be in the tnsnames.ora file. Run the Sqoop Job with Oracle Wallet Please make sure that Apache Sqoop v1.4.5 is used or (if using a prior version of Sqoop) install the OracleManager fix for wallet support. When we use wallet-based authentication, we don&rsquo;t provide the username or password for establishing the JDBC connection. Sqoop code has been enhanced to properly handle this case (please see &lt;spancolor:&gt;SQOOP&lt;/spancolor:&gt;&lt;spancolor:&gt;-1224&lt;/spancolor:&gt; for more information). Use Oracle session user when the database user name is not explicitly provided. This will be part of Sqoop 1.4.5 and later versions. For versions of Sqoop prior to 1.4.5, please make sure that the Sqoop product has this patch applied. Run the Sqoop Job Now we are ready to use the wallet with the Sqoop job.&lt;/p&gt; Here is an excerpt from a script that can be used after the wallet and Oracle client configuration setup are complete. This combines all of the steps previously outlined in this post.&lt;/p&gt; export HADOOP_OPTS= &quot;-Doracle.net.tns_admin=$PWD/wallet -Doracle.net.wallet_location=$PWD/wallet &quot;&lt;/p&gt; sqoop {import|export} \ -D mapred.map.child.java.opts= &#39;-Doracle.net.tns_admin=. -Doracle.net.wallet_location=.&#39; \ -files $HOME/wallet/cwallet.sso,\ $HOME/wallet/ewallet.p12,\ $HOME/wallet/sqlnet.ora,\ $HOME/wallet/tnsnames.ora \ -connect &lsquo;jdbc:oracle:thin:@w_orcl&rsquo; \ &lt;&lt;rest of sqoop options&gt;&gt;" />
<meta property="og:description" content="How to Secure Apache Sqoop Jobs with Oracle Wallet Apache Sqoop is a tool that transfers data between the Hadoop ecosystem and enterprise data stores. Sqoop does this by providing methods to transfer data to HDFS or Hive (using HCatalog). Oracle Database is one of the databases supported by Apache Sqoop. With Oracle Database, the database connection credentials are stored in Oracle Wallet. Oracle Wallet can act as the store of keys and secrets such as authentication credentials. This post describes how Oracle Wallet Manager adds a secure authentication layer for Sqoop jobs. &lt;/p&gt; In order to connect to an external database, Sqoop users must provide a set of credentials specific to that data store. These credentials are typically in the form of user name and password. &lt;/p&gt; Some enterprises may already be standardized on credential management tools provided by their enterprise DBMS vendor. These companies may not be comfortable with any of Sqoop&rsquo;s three authentication methods: ● Password provided on the command line ● Password read from the console during the interactive execution of a Sqoop job. ● Password provided on a secure file system that only the user can access. &lt;/p&gt; With Oracle Database, the database connection credentials can be securely stored in an Oracle Wallet. The use of Oracle Wallet can allay the security concerns mentioned above because it provides a secure client-side software container allowing secure storage of authentication and signing credentials. With support for Oracle Wallet, Sqoop jobs no longer need to embed usernames and passwords. This reduces the risk of exposing credentials and eases enforcement of authentication policies, since application code and scripts need not change whenever usernames or passwords change. &lt;/p&gt; Instructions for Using Oracle Wallets for External Password Store &lt;/p&gt; Please note that the following steps were tested with Oracle 11gR2 database. We expect these instructions should be applicable to other versions of Oracle DB, but they were not tested on versions other than Oracle 11gR2. &lt;/p&gt; At a high-level, these are the steps (which we describe in detail below): ● Create an Oracle client-side wallet ● Create tnsnames.ora and sqlnet.ora files ● Add the database access credentials to the Oracle wallet ● Test the Oracle wallet ● Use the Oracle wallet for Sqoop jobs ● Modify the JDBC URL for the connection to use the wallet ● Run the Sqoop job with Oracle wallet Create an Oracle Client-Side Wallet The first step is to create an Oracle wallet to hold the credentials used by Sqoop jobs. Oracle provides various tools to manage the Oracle Wallet. This document describes one of those: the mkstore command line tool. The mkstore command can be used to create the wallet: &lt;/p&gt; mkstore -wrl -create&lt;/span&gt;&lt;/p&gt; That command line creates a client side wallet at the location &lt;/span&gt;. Substitute &lt;/span&gt; to your valid directory location.&lt;/p&gt; It will be an auto-logon wallet. So before a client process can use the wallet, the ownership of the wallet directory and files (owner and group) must match the process uid and gid. Make sure that the password matches the database minimum requirements. Create tnsnames.ora and sqlnet.ora Files The Oracle database uses a few network configuration files. The files tnsnames.ora and sqlnet.ora are used for configuring client side network access. tnsnames.ora The configuration file tnsnames.ora has client side local naming parameters. The contents of tnsnames.ora are used to map the network service name to an Oracle database connection descriptor.&lt;/p&gt; Here is an example of a tnsnames.ora file: W_ORCL = ( DESCRIPTION = (ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.64.51)(PORT = 1521)) (CONNECT_DATA = (SERVER = DEDICATED) (SERVICE_NAME = orcl) ) ) In the above tnsnames.ora file, the network service name W_ORCL is mapped to a connection descriptor accessing a database instance named ORCL running on a host with an IP address 192.168.64.51.&lt;/p&gt; sqlnet.ora The configuration file sqlnet.ora is used to specify client side network configuration properties that influence the connection profiles. This file configures tracing, authentication, routing, and advanced security parameters. Here is an example of a sqlnet.ora file: WALLET_LOCATION = (SOURCE = (METHOD = FILE) (METHOD_DATA = (DIRECTORY = )&lt;/span&gt;&lt;/p&gt; ) )&lt;/p&gt; SQLNET.WALLET_OVERRIDE = TRUE SSL_CLIENT_AUTHENTICATION = FALSE&lt;/p&gt; &lt;/td&gt; &lt;/tr&gt; &lt;/tbody&gt; &lt;/table&gt; The tnsnames.ora and sqlnet.ora files can be placed in separate directories or they can both be placed in the wallet directory. Add the Database Access Credentials to the Oracle Wallet Now that we&rsquo;ve created an Oracle Wallet, we need to populate it with the database access credentials. We can use the -createCredential option to the mkstore command to do this:&lt;/p&gt; mkstore -wrl -createCredential &lt;/span&gt;&lt;/p&gt; ● is the directory where the wallet files will be stored&lt;/span&gt;&lt;/p&gt; ● is the service name defined in tnsnames.ora&lt;/span&gt;&lt;/p&gt; ● is the username to access the database&lt;/span&gt;&lt;/p&gt; ● is the database password for the user &lt;/span&gt;&lt;/p&gt;&lt;/p&gt; For example, with the sample service defined in tnsames.ora, and a DB user &ldquo;sqoop&rdquo; using password &ldquo;sqooppwd&rdquo;, the command invocation would be:&lt;/p&gt; mkstore -wrl -createCredential w_orcl sqoop sqooppwd&lt;/span&gt;&lt;/p&gt; This will prompt for the wallet password, which should be same as the one used when creating the wallet. Test the Oracle Wallet A quick way to test the password is to attempt a DB session with SQLPLUS. If the tnsnames.ora and sqlnet.ora settings are not in the default location ($ORACLE_HOME/network/admin), then you can provide the location of these files using the TNS_ADMIN environment variable.&lt;/p&gt; Assuming the tnsnames.ora and sqlnet.ora are under $HOME/wallet_test, do the following: export TNS_ADMIN=$HOME/wallet_test sqlplus /@ # in our case w_orcl&lt;/span&gt;&lt;/p&gt; This command should successfully establish the connection. If it does not, check the tnsnames.ora contents to make sure the DB host, port or service name are correct. If the service name in tnsnames.ora changes, then the wallet entry has to be created/modified. Use the Oracle Wallet for Sqoop Jobs After successfully validating the wallet, it can be used for Sqoop jobs. There are a few steps for providing the wallet with Sqoop: ● Provide the wallet to the Sqoop launcher ● Provision the wallet to the mapper tasks ● Make command line changes for the Sqoop launcher program ● Specify the location of the wallet and Oracle configuration files to the mapper tasks ● Specify the option to localize the files to the mapper tasks ● Modify the JDBC URL Provide the Wallet to the Sqoop Launcher For the Sqoop client program and the mappers launched by the Sqoop job, we have to specify the location for the wallet and the tnsnames.ora and sqlnet.ora files. Add the following files to the $SQOOP_HOME/lib directory (typically SQOOP_HOME is set to /usr/lib/sqoop):&lt;/p&gt; ● oraclepki.jar ● osdt_cert.jar ● osdt_core.jar ● ojdbc6.jar These jars are available as part of an Oracle Database installation. Provision the Wallet to the Mapper Tasks Copy the contents of the wallet directory from the database host along with the tnsnames.ora and sqlnet.ora files to a folder, such as $HOME/wallet, as the operating system user who is launching the Sqoop command. The wallet directory will have the following files after this step:&lt;/p&gt; ● cwallet.sso ● ewallet.p12 ● sqlnet.ora ● tnsnames.ora&lt;/p&gt; The first two are the wallet files and the next two are the Oracle client network configuration files that we saw before. Make sure the wallet directory and the files in that directory are owned by the operating system user and the group ownership is the same as the Sqoop user group. Make Command Line Changes for the Sqoop Launcher Program Since the wallet location and the TNS locations are different from the defaults, we have to override the location of the wallet and the tnsnames.ora and sqlnames.ora files. Oracle JDBC exposes two properties for this purpose: ● oracle.net.tns_admin &ndash; Location of the tnsnames.ora and sqlnet.ora files ● oracle.net.wallet_location &ndash; Location of the wallet files, cwallet.sso and ewallet.p12 In this case we will set both these properties to $HOME/wallet.&lt;/p&gt; Setting these two system properties for Sqoop can be achieved by setting the system environment variable HADOOP_OPTS which will be used for setting additional Java options to the JVM. export HADOOP_OPTS= &quot;-Doracle.net.tns_admin=$HOME/wallet -Doracle.net.wallet_location=$HOME/wallet_test&quot; Specify the Location of the Wallet and Oracle Configuration Files to the Mapper Tasks While the client program uses the DB for retrieving metadata, the mapper tasks do the actual data transfer. To provide the wallet files to the mapper tasks, we specify them as part of the &ndash;files tool option to localize to each mapper. Also, we have to use the Hadoop configuration properties to pass specific Java command line options (similar to HADOOP_OPTS for the launcher). Specify the Option to Localize the Files to the Mapper Tasks This can be achieved by adding the &ndash;files option to the Sqoop command line. Please note that Hadoop options have to come before any Sqoop options. The option and option argument can be specified as follows: -files $HOME/wallet/cwallet.sso,\ $HOME/wallet/ewallet.p12,\ $HOME/wallet/sqlnet.ora,\ $HOME/wallet/tnsnames.ora &lt;/p&gt; We also have to tell the Mapper tasks the location of wallet and TNS files. We use the hadoop configuration parameter mapred.child.java.opts to provide additional Java options to the mappers. Note that we use the current directory as the location (&lsquo;.&rsquo;). This is because the files provided by the &ndash;files option will be localized to the current directory for each mapper task. -D mapred.map.child.java.opts=&rsquo;-Doracle.net.tns_admin=. -Doracle.net.wallet_location=.&#39; &lt;/p&gt; If there are additional Java options that need to be provided for the mappers, they should be added to the Java options given below. For example, to add the system property -Djava.security.egd=file:/dev/./urandom, the options would be specified as: -D mapred.map.child.java.opts=&rsquo;-Doracle.net.tns_admin=. -Doracle.net.wallet_location=. &ndash;Djava.security.egd=file:/dev/./urandom&#39;&lt;/p&gt; Modify the JDBC URL The JDBC URL provided should use the format jdbc:oracle:thin:@SVC where the SVC is the service name used for accessing the database. This is added as part of the createCredential command above and should also be in the tnsnames.ora file. Run the Sqoop Job with Oracle Wallet Please make sure that Apache Sqoop v1.4.5 is used or (if using a prior version of Sqoop) install the OracleManager fix for wallet support. When we use wallet-based authentication, we don&rsquo;t provide the username or password for establishing the JDBC connection. Sqoop code has been enhanced to properly handle this case (please see &lt;spancolor:&gt;SQOOP&lt;/spancolor:&gt;&lt;spancolor:&gt;-1224&lt;/spancolor:&gt; for more information). Use Oracle session user when the database user name is not explicitly provided. This will be part of Sqoop 1.4.5 and later versions. For versions of Sqoop prior to 1.4.5, please make sure that the Sqoop product has this patch applied. Run the Sqoop Job Now we are ready to use the wallet with the Sqoop job.&lt;/p&gt; Here is an excerpt from a script that can be used after the wallet and Oracle client configuration setup are complete. This combines all of the steps previously outlined in this post.&lt;/p&gt; export HADOOP_OPTS= &quot;-Doracle.net.tns_admin=$PWD/wallet -Doracle.net.wallet_location=$PWD/wallet &quot;&lt;/p&gt; sqoop {import|export} \ -D mapred.map.child.java.opts= &#39;-Doracle.net.tns_admin=. -Doracle.net.wallet_location=.&#39; \ -files $HOME/wallet/cwallet.sso,\ $HOME/wallet/ewallet.p12,\ $HOME/wallet/sqlnet.ora,\ $HOME/wallet/tnsnames.ora \ -connect &lsquo;jdbc:oracle:thin:@w_orcl&rsquo; \ &lt;&lt;rest of sqoop options&gt;&gt;" />
<link rel="canonical" href="http://localhost:4000/sqoop/entry/using_oracle_wallets_with_sqoop" />
<meta property="og:url" content="http://localhost:4000/sqoop/entry/using_oracle_wallets_with_sqoop" />
<meta property="og:site_name" content="Blogs Archive" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2014-01-13T03:08:34-05:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Using Oracle Wallets with Sqoop Jobs" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2014-01-13T03:08:34-05:00","datePublished":"2014-01-13T03:08:34-05:00","description":"How to Secure Apache Sqoop Jobs with Oracle Wallet Apache Sqoop is a tool that transfers data between the Hadoop ecosystem and enterprise data stores. Sqoop does this by providing methods to transfer data to HDFS or Hive (using HCatalog). Oracle Database is one of the databases supported by Apache Sqoop. With Oracle Database, the database connection credentials are stored in Oracle Wallet. Oracle Wallet can act as the store of keys and secrets such as authentication credentials. This post describes how Oracle Wallet Manager adds a secure authentication layer for Sqoop jobs. &lt;/p&gt; In order to connect to an external database, Sqoop users must provide a set of credentials specific to that data store. These credentials are typically in the form of user name and password. &lt;/p&gt; Some enterprises may already be standardized on credential management tools provided by their enterprise DBMS vendor. These companies may not be comfortable with any of Sqoop&rsquo;s three authentication methods: ● Password provided on the command line ● Password read from the console during the interactive execution of a Sqoop job. ● Password provided on a secure file system that only the user can access. &lt;/p&gt; With Oracle Database, the database connection credentials can be securely stored in an Oracle Wallet. The use of Oracle Wallet can allay the security concerns mentioned above because it provides a secure client-side software container allowing secure storage of authentication and signing credentials. With support for Oracle Wallet, Sqoop jobs no longer need to embed usernames and passwords. This reduces the risk of exposing credentials and eases enforcement of authentication policies, since application code and scripts need not change whenever usernames or passwords change. &lt;/p&gt; Instructions for Using Oracle Wallets for External Password Store &lt;/p&gt; Please note that the following steps were tested with Oracle 11gR2 database. We expect these instructions should be applicable to other versions of Oracle DB, but they were not tested on versions other than Oracle 11gR2. &lt;/p&gt; At a high-level, these are the steps (which we describe in detail below): ● Create an Oracle client-side wallet ● Create tnsnames.ora and sqlnet.ora files ● Add the database access credentials to the Oracle wallet ● Test the Oracle wallet ● Use the Oracle wallet for Sqoop jobs ● Modify the JDBC URL for the connection to use the wallet ● Run the Sqoop job with Oracle wallet Create an Oracle Client-Side Wallet The first step is to create an Oracle wallet to hold the credentials used by Sqoop jobs. Oracle provides various tools to manage the Oracle Wallet. This document describes one of those: the mkstore command line tool. The mkstore command can be used to create the wallet: &lt;/p&gt; mkstore -wrl -create&lt;/span&gt;&lt;/p&gt; That command line creates a client side wallet at the location &lt;/span&gt;. Substitute &lt;/span&gt; to your valid directory location.&lt;/p&gt; It will be an auto-logon wallet. So before a client process can use the wallet, the ownership of the wallet directory and files (owner and group) must match the process uid and gid. Make sure that the password matches the database minimum requirements. Create tnsnames.ora and sqlnet.ora Files The Oracle database uses a few network configuration files. The files tnsnames.ora and sqlnet.ora are used for configuring client side network access. tnsnames.ora The configuration file tnsnames.ora has client side local naming parameters. The contents of tnsnames.ora are used to map the network service name to an Oracle database connection descriptor.&lt;/p&gt; Here is an example of a tnsnames.ora file: W_ORCL = ( DESCRIPTION = (ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.64.51)(PORT = 1521)) (CONNECT_DATA = (SERVER = DEDICATED) (SERVICE_NAME = orcl) ) ) In the above tnsnames.ora file, the network service name W_ORCL is mapped to a connection descriptor accessing a database instance named ORCL running on a host with an IP address 192.168.64.51.&lt;/p&gt; sqlnet.ora The configuration file sqlnet.ora is used to specify client side network configuration properties that influence the connection profiles. This file configures tracing, authentication, routing, and advanced security parameters. Here is an example of a sqlnet.ora file: WALLET_LOCATION = (SOURCE = (METHOD = FILE) (METHOD_DATA = (DIRECTORY = )&lt;/span&gt;&lt;/p&gt; ) )&lt;/p&gt; SQLNET.WALLET_OVERRIDE = TRUE SSL_CLIENT_AUTHENTICATION = FALSE&lt;/p&gt; &lt;/td&gt; &lt;/tr&gt; &lt;/tbody&gt; &lt;/table&gt; The tnsnames.ora and sqlnet.ora files can be placed in separate directories or they can both be placed in the wallet directory. Add the Database Access Credentials to the Oracle Wallet Now that we&rsquo;ve created an Oracle Wallet, we need to populate it with the database access credentials. We can use the -createCredential option to the mkstore command to do this:&lt;/p&gt; mkstore -wrl -createCredential &lt;/span&gt;&lt;/p&gt; ● is the directory where the wallet files will be stored&lt;/span&gt;&lt;/p&gt; ● is the service name defined in tnsnames.ora&lt;/span&gt;&lt;/p&gt; ● is the username to access the database&lt;/span&gt;&lt;/p&gt; ● is the database password for the user &lt;/span&gt;&lt;/p&gt;&lt;/p&gt; For example, with the sample service defined in tnsames.ora, and a DB user &ldquo;sqoop&rdquo; using password &ldquo;sqooppwd&rdquo;, the command invocation would be:&lt;/p&gt; mkstore -wrl -createCredential w_orcl sqoop sqooppwd&lt;/span&gt;&lt;/p&gt; This will prompt for the wallet password, which should be same as the one used when creating the wallet. Test the Oracle Wallet A quick way to test the password is to attempt a DB session with SQLPLUS. If the tnsnames.ora and sqlnet.ora settings are not in the default location ($ORACLE_HOME/network/admin), then you can provide the location of these files using the TNS_ADMIN environment variable.&lt;/p&gt; Assuming the tnsnames.ora and sqlnet.ora are under $HOME/wallet_test, do the following: export TNS_ADMIN=$HOME/wallet_test sqlplus /@ # in our case w_orcl&lt;/span&gt;&lt;/p&gt; This command should successfully establish the connection. If it does not, check the tnsnames.ora contents to make sure the DB host, port or service name are correct. If the service name in tnsnames.ora changes, then the wallet entry has to be created/modified. Use the Oracle Wallet for Sqoop Jobs After successfully validating the wallet, it can be used for Sqoop jobs. There are a few steps for providing the wallet with Sqoop: ● Provide the wallet to the Sqoop launcher ● Provision the wallet to the mapper tasks ● Make command line changes for the Sqoop launcher program ● Specify the location of the wallet and Oracle configuration files to the mapper tasks ● Specify the option to localize the files to the mapper tasks ● Modify the JDBC URL Provide the Wallet to the Sqoop Launcher For the Sqoop client program and the mappers launched by the Sqoop job, we have to specify the location for the wallet and the tnsnames.ora and sqlnet.ora files. Add the following files to the $SQOOP_HOME/lib directory (typically SQOOP_HOME is set to /usr/lib/sqoop):&lt;/p&gt; ● oraclepki.jar ● osdt_cert.jar ● osdt_core.jar ● ojdbc6.jar These jars are available as part of an Oracle Database installation. Provision the Wallet to the Mapper Tasks Copy the contents of the wallet directory from the database host along with the tnsnames.ora and sqlnet.ora files to a folder, such as $HOME/wallet, as the operating system user who is launching the Sqoop command. The wallet directory will have the following files after this step:&lt;/p&gt; ● cwallet.sso ● ewallet.p12 ● sqlnet.ora ● tnsnames.ora&lt;/p&gt; The first two are the wallet files and the next two are the Oracle client network configuration files that we saw before. Make sure the wallet directory and the files in that directory are owned by the operating system user and the group ownership is the same as the Sqoop user group. Make Command Line Changes for the Sqoop Launcher Program Since the wallet location and the TNS locations are different from the defaults, we have to override the location of the wallet and the tnsnames.ora and sqlnames.ora files. Oracle JDBC exposes two properties for this purpose: ● oracle.net.tns_admin &ndash; Location of the tnsnames.ora and sqlnet.ora files ● oracle.net.wallet_location &ndash; Location of the wallet files, cwallet.sso and ewallet.p12 In this case we will set both these properties to $HOME/wallet.&lt;/p&gt; Setting these two system properties for Sqoop can be achieved by setting the system environment variable HADOOP_OPTS which will be used for setting additional Java options to the JVM. export HADOOP_OPTS= &quot;-Doracle.net.tns_admin=$HOME/wallet -Doracle.net.wallet_location=$HOME/wallet_test&quot; Specify the Location of the Wallet and Oracle Configuration Files to the Mapper Tasks While the client program uses the DB for retrieving metadata, the mapper tasks do the actual data transfer. To provide the wallet files to the mapper tasks, we specify them as part of the &ndash;files tool option to localize to each mapper. Also, we have to use the Hadoop configuration properties to pass specific Java command line options (similar to HADOOP_OPTS for the launcher). Specify the Option to Localize the Files to the Mapper Tasks This can be achieved by adding the &ndash;files option to the Sqoop command line. Please note that Hadoop options have to come before any Sqoop options. The option and option argument can be specified as follows: -files $HOME/wallet/cwallet.sso,\\ $HOME/wallet/ewallet.p12,\\ $HOME/wallet/sqlnet.ora,\\ $HOME/wallet/tnsnames.ora &lt;/p&gt; We also have to tell the Mapper tasks the location of wallet and TNS files. We use the hadoop configuration parameter mapred.child.java.opts to provide additional Java options to the mappers. Note that we use the current directory as the location (&lsquo;.&rsquo;). This is because the files provided by the &ndash;files option will be localized to the current directory for each mapper task. -D mapred.map.child.java.opts=&rsquo;-Doracle.net.tns_admin=. -Doracle.net.wallet_location=.&#39; &lt;/p&gt; If there are additional Java options that need to be provided for the mappers, they should be added to the Java options given below. For example, to add the system property -Djava.security.egd=file:/dev/./urandom, the options would be specified as: -D mapred.map.child.java.opts=&rsquo;-Doracle.net.tns_admin=. -Doracle.net.wallet_location=. &ndash;Djava.security.egd=file:/dev/./urandom&#39;&lt;/p&gt; Modify the JDBC URL The JDBC URL provided should use the format jdbc:oracle:thin:@SVC where the SVC is the service name used for accessing the database. This is added as part of the createCredential command above and should also be in the tnsnames.ora file. Run the Sqoop Job with Oracle Wallet Please make sure that Apache Sqoop v1.4.5 is used or (if using a prior version of Sqoop) install the OracleManager fix for wallet support. When we use wallet-based authentication, we don&rsquo;t provide the username or password for establishing the JDBC connection. Sqoop code has been enhanced to properly handle this case (please see &lt;spancolor:&gt;SQOOP&lt;/spancolor:&gt;&lt;spancolor:&gt;-1224&lt;/spancolor:&gt; for more information). Use Oracle session user when the database user name is not explicitly provided. This will be part of Sqoop 1.4.5 and later versions. For versions of Sqoop prior to 1.4.5, please make sure that the Sqoop product has this patch applied. Run the Sqoop Job Now we are ready to use the wallet with the Sqoop job.&lt;/p&gt; Here is an excerpt from a script that can be used after the wallet and Oracle client configuration setup are complete. This combines all of the steps previously outlined in this post.&lt;/p&gt; export HADOOP_OPTS= &quot;-Doracle.net.tns_admin=$PWD/wallet -Doracle.net.wallet_location=$PWD/wallet &quot;&lt;/p&gt; sqoop {import|export} \\ -D mapred.map.child.java.opts= &#39;-Doracle.net.tns_admin=. -Doracle.net.wallet_location=.&#39; \\ -files $HOME/wallet/cwallet.sso,\\ $HOME/wallet/ewallet.p12,\\ $HOME/wallet/sqlnet.ora,\\ $HOME/wallet/tnsnames.ora \\ -connect &lsquo;jdbc:oracle:thin:@w_orcl&rsquo; \\ &lt;&lt;rest of sqoop options&gt;&gt;","headline":"Using Oracle Wallets with Sqoop Jobs","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/sqoop/entry/using_oracle_wallets_with_sqoop"},"url":"http://localhost:4000/sqoop/entry/using_oracle_wallets_with_sqoop"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Blogs Archive" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Blogs Archive</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Using Oracle Wallets with Sqoop Jobs</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2014-01-13T03:08:34-05:00" itemprop="datePublished">Jan 13, 2014
      </time>• <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">{"display_name"=>"Venkat Ranganathan ", "login"=>"venkatrangan", "email"=>"venkatrangan@apache.org"}</span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h1 style="margin: 2pt 16pt 0.0001pt 0in;"><a name="hpa6zse7andu6"></a><strong><span style="font-size: 12pt; line-height: 115%; font-family: Arial;">How to Secure Apache<br />
Sqoop Jobs with Oracle Wallet</span></strong></h1>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> </span></p>
<p><a href="http://hortonworks.com/hadoop/sqoop/"><span style="font-size: 10pt; line-height: 115%; font-family: Verdana; color: #1155cc;">Apache</span></a><a href="http://hortonworks.com/hadoop/sqoop/"><span style="font-size: 10pt; line-height: 115%; font-family: Verdana; color: #1155cc;"> </span></a><a href="http://hortonworks.com/hadoop/sqoop/"><span style="font-size: 10pt; line-height: 115%; font-family: Verdana; color: #1155cc;">Sqoop</span></a><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> is a tool that transfers data between<br />
the Hadoop ecosystem and enterprise data stores. Sqoop does this by providing<br />
methods to transfer data to</span><a href="http://hortonworks.com/hadoop/hdfs/"><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> </span></a><a href="http://hortonworks.com/hadoop/hdfs/"><span style="font-size: 10pt; line-height: 115%; font-family: Verdana; color: #1155cc;">HDFS</span></a><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> or</span><a href="http://hortonworks.com/hadoop/hive/"><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> </span></a><a href="http://hortonworks.com/hadoop/hive/"><span style="font-size: 10pt; line-height: 115%; font-family: Verdana; color: #1155cc;">Hive</span></a><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> (using</span><a href="http://hortonworks.com/hadoop/hcatalog/"><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> </span></a><a href="http://hortonworks.com/hadoop/hcatalog/"><span style="font-size: 10pt; line-height: 115%; font-family: Verdana; color: #1155cc;">HCatalog</span></a><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">). Oracle Database is one of the<br />
databases supported by Apache Sqoop.</span></p>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">With Oracle Database, the database connection<br />
credentials are stored in Oracle Wallet. Oracle Wallet can act as the store of<br />
keys and secrets such as authentication credentials. This post describes how</span><a href="http://docs.oracle.com/cd/B28359_01/network.111/b28530/asowalet.htm#i1009041"><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> </span></a><a href="http://docs.oracle.com/cd/B28359_01/network.111/b28530/asowalet.htm#i1009041"><span style="font-size: 10pt; line-height: 115%; font-family: Verdana; color: #1155cc;">Oracle</span></a><a href="http://docs.oracle.com/cd/B28359_01/network.111/b28530/asowalet.htm#i1009041"><span style="font-size: 10pt; line-height: 115%; font-family: Verdana; color: #1155cc;"> </span></a><a href="http://docs.oracle.com/cd/B28359_01/network.111/b28530/asowalet.htm#i1009041"><span style="font-size: 10pt; line-height: 115%; font-family: Verdana; color: #1155cc;">Wallet</span></a><a href="http://docs.oracle.com/cd/B28359_01/network.111/b28530/asowalet.htm#i1009041"><span style="font-size: 10pt; line-height: 115%; font-family: Verdana; color: #1155cc;"> </span></a><a href="http://docs.oracle.com/cd/B28359_01/network.111/b28530/asowalet.htm#i1009041"><span style="font-size: 10pt; line-height: 115%; font-family: Verdana; color: #1155cc;">Manager</span></a><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> adds a secure authentication layer for<br />
Sqoop jobs.</span></p></p>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">In order to connect to an external database,<br />
Sqoop users must provide a set of credentials specific to that data store.<br />
These credentials are typically in the form of user name and password.</span></p></p>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">Some enterprises may already be standardized on<br />
credential management tools provided by their enterprise DBMS vendor. These<br />
companies may not be comfortable with any of Sqoop&rsquo;s three authentication methods:</span></p>
<p style="margin-left: 0.5in; text-indent: -0.25in;"><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">●</span><span style="font-size: 7pt; line-height: 115%; font-family: 'Times New Roman';"> </span><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">Password provided on the command line</span></p>
<p style="margin-left: 0.5in; text-indent: -0.25in;"><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">●</span><span style="font-size: 7pt; line-height: 115%; font-family: 'Times New Roman';"> </span><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">Password read from the console during the<br />
interactive execution of a Sqoop job.</span></p>
<p style="margin-left: 0.5in; text-indent: -0.25in;"><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">●</span><span style="font-size: 7pt; line-height: 115%; font-family: 'Times New Roman';"> </span><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">Password provided on a secure file system that<br />
only the user can access.</span></p></p>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">With Oracle Database, the database connection<br />
credentials can be securely stored in an Oracle Wallet. The use of Oracle<br />
Wallet can allay the security concerns mentioned above because it provides a<br />
secure client-side software container allowing secure storage of authentication<br />
and signing credentials.</span></p>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> </span></p>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">With support for Oracle Wallet, Sqoop jobs no<br />
longer need to embed usernames and passwords. This reduces the risk of exposing<br />
credentials and eases enforcement of authentication policies, since application<br />
code and scripts need not change whenever usernames or passwords change.</span></p></p>
<p><strong><span style="font-size: 12pt; line-height: 115%;">Instructions for Using<br />
Oracle Wallets for External Password Store</span></strong></p></p>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">Please note that the following steps were tested<br />
with Oracle 11gR2 database. We expect these instructions should be applicable<br />
to other versions of Oracle DB, but they were not tested on versions other than<br />
Oracle 11gR2.</span></p></p>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">At a high-level, these are the steps (which we<br />
describe in detail below):</span></p>
<p style="margin-left: 0.5in; text-indent: -0.25in;"><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">●</span><span style="font-size: 7pt; line-height: 115%; font-family: 'Times New Roman';"> </span><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">Create an Oracle client-side wallet</span></p>
<p style="margin-left: 0.5in; text-indent: -0.25in;"><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">●</span><span style="font-size: 7pt; line-height: 115%; font-family: 'Times New Roman';"> </span><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">Create </span><span>tnsnames.ora</span><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> and </span><span>sqlnet.ora</span><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> files</span></p>
<p style="margin-left: 0.5in; text-indent: -0.25in;"><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">●</span><span style="font-size: 7pt; line-height: 115%; font-family: 'Times New Roman';"> </span><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">Add the database access credentials to the Oracle<br />
wallet</span></p>
<p style="margin-left: 0.5in; text-indent: -0.25in;"><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">●</span><span style="font-size: 7pt; line-height: 115%; font-family: 'Times New Roman';"> </span><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">Test the Oracle wallet</span></p>
<p style="margin-left: 0.5in; text-indent: -0.25in;"><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">●</span><span style="font-size: 7pt; line-height: 115%; font-family: 'Times New Roman';"> </span><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">Use the Oracle wallet for Sqoop jobs</span></p>
<p style="margin-left: 0.5in; text-indent: -0.25in;"><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">●</span><span style="font-size: 7pt; line-height: 115%; font-family: 'Times New Roman';"> </span><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">Modify the JDBC URL for the connection to use the<br />
wallet</span></p>
<p style="margin-left: 0.5in; text-indent: -0.25in;"><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">●</span><span style="font-size: 7pt; line-height: 115%; font-family: 'Times New Roman';"> </span><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">Run the Sqoop job with Oracle wallet</span></p>
<h3 style="margin: 17pt 0in 6pt;"><a name="ha7dv2uc1p35e"></a><em><span style="font-size: 11pt; line-height: 115%; font-family: Arial;">Create an Oracle Client-Side Wallet</span></em></h3>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">The first step is to create an Oracle wallet to<br />
hold the credentials used by Sqoop jobs. Oracle provides various tools to<br />
manage the Oracle Wallet. This document describes one of those: the </span><span>mkstore</span><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> command line tool. The </span><span>mkstore</span><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> command can be used to create the<br />
wallet:</span></p></p>
<p><span>mkstore -wrl <wallet_location><br />
-create</span></p>
<p><o:p> </o:p></p>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">That command line creates a client side wallet at<br />
the location </span><span><wallet_location></span><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">. Substitute </span><span><wallet_location></span><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> to your valid directory location.</span></p>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> </span></p>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">It will be an auto-logon wallet. So before a<br />
client process can use the wallet, the ownership of the wallet directory and<br />
files (owner and group) must match the process uid and gid.</span></p>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> </span></p>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">Make sure that the password matches the database<br />
minimum requirements.</span></p>
<h3 style="margin: 17pt 0in 6pt;"><a name="h1pjrhotamekq"></a><em><span style="font-size: 11pt; line-height: 115%; font-family: Arial;">Create tnsnames.ora and<br />
sqlnet.ora Files</span></em></h3>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">The Oracle database uses a few network<br />
configuration files. The files </span><span>tnsnames.ora</span><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> and </span><span>sqlnet.ora</span><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> are used for configuring client side network<br />
access.</span></p>
<h3 style="margin: 17pt 0in 6pt;"><a name="hv94iygfwk3w4"></a><span style="font-size: 11pt; line-height: 115%; font-family: Arial; color: gray;">tnsnames.ora</span></h3>
<p>The configuration file <span style="font-family: 'Courier New';">tnsnames.ora</span> has client side local<br />
naming parameters. The contents of <span style="font-family: 'Courier New';">tnsnames.ora</span> are used to map the<br />
network service name to an Oracle database connection descriptor.</p></p>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">Here is an example of a </span><span>tnsnames.ora</span><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> file:</span></p>
<table class="MsoNormalTable" border="0" cellspacing="0" cellpadding="0" width="351" style="margin-left: 5pt; border-collapse: collapse;">
<tbody>
<tr>
<td width="351" valign="top" style="width: 351.25pt; border: 1pt solid windowtext; padding: 5pt;">
<p><span>W_ORCL<br />
  =</span></p>
<p><span> ( DESCRIPTION =</span></p>
<p><span> </span><span style="display: none;"> </span><span>(ADDRESS<br />
  = (PROTOCOL = TCP)(HOST = 192.168.64.51)(PORT = 1521))</span></p>
<p><span> </span><span style="display: none;"> </span><span>(CONNECT_DATA<br />
  =</span></p>
<p><span> </span><span style="display: none;"> </span><span>(SERVER<br />
  = DEDICATED)</span></p>
<p><span> </span><span style="display: none;"> </span><span>(SERVICE_NAME<br />
  = orcl)</span></p>
<p><span> )</span></p>
<p><span>)</span></p>
</td>
</tr>
</tbody>
</table>
<p>In the above<span style="font-family: 'Courier New';"> tnsnames.ora </span>file, the network<br />
service name <span style="font-family: 'Courier New';">W_ORCL</span> is mapped to a<br />
connection descriptor accessing a database instance named <span style="font-family: 'Courier New';">ORCL</span> running on a host with an IP<br />
address <span style="font-family: 'Courier New';">192.168.64.51.</span></p></p>
<h4 style="margin: 12pt 0in 2pt;"><a name="hhga0a6u8tc72"></a><strong><span style="font-family: Arial; color: gray;">sqlnet.ora</span></strong></h4>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">The configuration file </span><span>sqlnet.ora</span><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> is used to specify client side network<br />
configuration properties that influence the connection profiles. This file<br />
configures tracing, authentication, routing, and advanced security parameters.</span></p>
<p><span style="font-family: Verdana;"> </span></p>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">Here is an example of a </span><span>sqlnet.ora</span><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> file:</span></p>
<table class="MsoNormalTable" border="0" cellspacing="0" cellpadding="0" width="351" style="margin-left: 5pt; border-collapse: collapse;">
<tbody>
<tr>
<td width="351" valign="top" style="width: 351.25pt; border: 1pt solid windowtext; padding: 5pt;">
<p><span>WALLET_LOCATION<br />
  =</span></p>
<p><span> (SOURCE =</span></p>
<p><span style="display: none;"> </span><span>(METHOD = FILE)</span></p>
<p><span style="display: none;"> </span><span>(METHOD_DATA =</span></p>
<p><span> </span><span style="display: none;"> </span><span>(DIRECTORY<br />
  = <full path to file>)</span></p>
<p><span style="display: none;"> </span><span>)</span></p>
<p><span> )</span></p></p>
<p><strong><span>SQLNET.WALLET_OVERRIDE =<br />
  TRUE</span></strong></p>
<p><span>SSL_CLIENT_AUTHENTICATION<br />
  = FALSE</span></p></p>
</td>
</tr>
</tbody>
</table>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">The</span><span> tnsnames.ora</span><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> and</span><span> sqlnet.ora</span><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> files can be placed in separate directories or<br />
they can both be placed in the wallet directory.</span></p>
<h3 style="margin: 17pt 0in 6pt;"><a name="h19sxapc111uh"></a><em><span style="font-size: 11pt; line-height: 115%; font-family: Arial;">Add the Database Access<br />
Credentials to the Oracle Wallet</span></em></h3>
<p>Now that we&rsquo;ve created an Oracle<br />
Wallet, we need to populate it with the database access credentials. We can use the <span style="font-family: 'Courier New';">-createCredential<br />
</span>option to the <span style="font-family: 'Courier New';">mkstore</span> command to do<br />
this:</p></p>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> </span><span>mkstore -wrl<br />
<wallet-location> -createCredential <DBSvc> <DBUser><br />
<DBPassword></span></p>
<p style="margin-left: 0.5in; text-indent: -0.25in;"><span>●</span><span style="font-size: 7pt; line-height: 115%; font-family: 'Times New Roman';"> </span><span><wallet-location><br />
is the directory where the wallet files will be stored</span></p>
<p style="margin-left: 0.5in; text-indent: -0.25in;"><span>●</span><span style="font-size: 7pt; line-height: 115%; font-family: 'Times New Roman';"> </span><span><DBSvc><br />
is the service name defined in tnsnames.ora</span></p>
<p style="margin-left: 0.5in; text-indent: -0.25in;"><span>●</span><span style="font-size: 7pt; line-height: 115%; font-family: 'Times New Roman';"> </span><span><DBUser><br />
is the username to access the database</span></p>
<p style="margin-left: 0.5in; text-indent: -0.25in;"><span>●</span><span style="font-size: 7pt; line-height: 115%; font-family: 'Times New Roman';"> </span><span><DBPassword><br />
is the database password for the user <DBUser></span></p></p>
<p><span>For example, with the sample service<br />
defined in tnsames.ora, and a DB user &ldquo;sqoop&rdquo; using password &ldquo;sqooppwd&rdquo;, the<br />
command invocation would be:</span></p></p>
<p><span>mkstore -wrl <wallet-location><br />
-createCredential w_orcl sqoop sqooppwd</span></p>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> </span></p>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">This will prompt for the wallet password, which<br />
should be same as the one used when creating the wallet.</span></p>
<h3 style="margin: 17pt 0in 6pt;"><a name="hlpnp061oka7t"></a><em><span style="font-size: 11pt; line-height: 115%; font-family: Arial;">Test the Oracle Wallet</span></em></h3>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">A quick way to test the password is to attempt a<br />
DB session with </span><span>SQLPLUS</span><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">.</span></p>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> </span></p>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">If the </span><span>tnsnames.ora</span><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> and </span><span>sqlnet.ora</span><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> settings are not in the default location </span><span>($ORACLE_HOME/network/admin</span><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">), then you can provide the location of<br />
these files using the </span><span>TNS_ADMIN</span><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"><br />
environment variable.</span></p></p>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">Assuming the</span><span> tnsnames.ora </span><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">and </span><span>sqlnet.ora</span><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> are under </span><span>$HOME/wallet_test</span><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">, do the following:</span></p>
<p><o:p> </o:p></p>
<p><span>export TNS_ADMIN=$HOME/wallet_test</span></p>
<p><span>sqlplus /@<svc_name> # in our case<br />
w_orcl</span></p>
<p><o:p> </o:p></p>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">This command should successfully establish the<br />
connection. If it does not, check the </span><span>tnsnames.ora </span><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">contents to make sure the DB host, port or<br />
service name are correct.</span></p>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> </span></p>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">If the service name in </span><span>tnsnames.ora</span><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> changes, then the wallet entry has to be<br />
created/modified.</span></p>
<h3 style="margin: 17pt 0in 6pt;"><a name="hsnmbeu8b53j5"></a><em><span style="font-size: 11pt; line-height: 115%; font-family: Arial;">Use the Oracle Wallet for Sqoop<br />
Jobs</span></em></h3>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">After successfully validating the wallet, it can<br />
be used for Sqoop jobs. There are a few steps for providing the wallet with<br />
Sqoop:</span></p>
<p style="margin-left: 0.5in; text-indent: -0.25in;"><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">● Provide the wallet to the Sqoop launcher</span></p>
<p style="margin-left: 0.5in; text-indent: -0.25in;"><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">● Provision the wallet to the mapper tasks</span></p>
<p style="margin-left: 0.5in; text-indent: -0.25in;"><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">● Make command line changes for the Sqoop<br />
launcher program</span></p>
<p style="margin-left: 0.5in; text-indent: -0.25in;"><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">● Specify the location of the wallet and<br />
Oracle configuration files to the mapper tasks</span></p>
<p style="margin-left: 0.5in; text-indent: -0.25in;"><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">● Specify the option to localize the files<br />
to the mapper tasks</span></p>
<p style="margin-left: 0.5in; text-indent: -0.25in;"><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">● Modify the JDBC URL</span></p>
<h3 style="margin: 17pt 0in 6pt;"><a name="hziausk25rq38"></a><span style="font-size: 11pt; line-height: 115%; font-family: Arial; color: gray;">Provide the Wallet to the Sqoop Launcher</span></h3>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">For the Sqoop client program and the mappers launched<br />
by the Sqoop job, we have to specify the location for the wallet and the </span><span>tnsnames.ora</span><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> and </span><span>sqlnet.ora</span><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> files.</span></p>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> </span></p>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">Add the following files to the </span><span>$SQOOP_HOME/lib</span><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> directory (typically </span><span>SQOOP_HOME</span><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> is set to /usr/lib/sqoop):</span></p></p>
<p style="margin-left: 0.5in; text-indent: -0.25in;"><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">●</span><span style="font-size: 7pt; line-height: 115%; font-family: 'Times New Roman';"> </span><span>oraclepki.jar</span></p>
<p style="margin-left: 0.5in; text-indent: -0.25in;"><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">●</span><span style="font-size: 7pt; line-height: 115%; font-family: 'Times New Roman';"> </span><span>osdt_cert.jar</span></p>
<p style="margin-left: 0.5in; text-indent: -0.25in;"><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">●</span><span style="font-size: 7pt; line-height: 115%; font-family: 'Times New Roman';"> </span><span>osdt_core.jar</span></p>
<p style="margin-left: 0.5in; text-indent: -0.25in;"><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">●</span><span style="font-size: 7pt; line-height: 115%; font-family: 'Times New Roman';"> </span><span>ojdbc6.jar</span></p>
<p style="margin-left: 0.5in;"><span> </span></p>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">These jars are available as part of an Oracle<br />
Database installation.</span></p>
<h3 style="margin: 17pt 0in 6pt;"><a name="hu263pmsy6yf3"></a><span style="font-size: 11pt; line-height: 115%; font-family: Arial; color: gray;">Provision the Wallet to the Mapper Tasks</span></h3>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">Copy the contents of the wallet directory from<br />
the database host along with the</span><span> tnsnames.ora</span><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> and </span><span>sqlnet.ora</span><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> files to a folder, such as</span><span> $HOME/wallet</span><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">, as the</span><span> operating system user</span><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> who is launching the Sqoop command.</span></p>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> </span></p>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">The wallet directory will have the following<br />
files after this step:</span></p></p>
<p style="margin-left: 0.5in; text-indent: -0.25in;"><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">●</span><span style="font-size: 7pt; line-height: 115%; font-family: 'Times New Roman';"> </span><span>cwallet.sso</span></p>
<p style="margin-left: 0.5in; text-indent: -0.25in;"><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">●</span><span style="font-size: 7pt; line-height: 115%; font-family: 'Times New Roman';"> </span><span>ewallet.p12</span></p>
<p style="margin-left: 0.5in; text-indent: -0.25in;"><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">●</span><span style="font-size: 7pt; line-height: 115%; font-family: 'Times New Roman';"> </span><span>sqlnet.ora</span></p>
<p style="margin-left: 0.5in; text-indent: -0.25in;"><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">●</span><span style="font-size: 7pt; line-height: 115%; font-family: 'Times New Roman';"> </span><span>tnsnames.ora</span></p></p>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">The first two are the wallet files and the next<br />
two are the Oracle client network configuration files that we saw before.</span></p>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> </span></p>
<p><strong><em><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">Make sure the wallet directory and the files in<br />
that directory are owned by the operating system user and the group ownership<br />
is the same as the Sqoop user group.</span></em></strong></p>
<h3 style="margin: 17pt 0in 6pt;"><a name="h6alsmalhtkcs"></a><span style="font-size: 11pt; line-height: 115%; font-family: Arial; color: gray;">Make Command Line Changes for the Sqoop Launcher Program</span></h3>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">Since the wallet location and the TNS locations<br />
are different from the defaults, we have to override the location of the wallet<br />
and the tnsnames.ora and sqlnames.ora files.</span></p>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> </span></p>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">Oracle JDBC exposes two properties for this<br />
purpose:</span></p>
<p style="margin-left: 0.5in; text-indent: -0.25in;"><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">●</span><span style="font-size: 7pt; line-height: 115%; font-family: 'Times New Roman';"> </span><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">oracle.net.tns_admin &ndash; Location of the<br />
tnsnames.ora and sqlnet.ora files</span></p>
<p style="margin-left: 0.5in; text-indent: -0.25in;"><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">●</span><span style="font-size: 7pt; line-height: 115%; font-family: 'Times New Roman';"> </span><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">oracle.net.wallet_location &ndash; Location of the<br />
wallet files, cwallet.sso and ewallet.p12</span></p>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> </span></p>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">In this case we will set both these properties to<br />
</span><span>$HOME/wallet</span><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">.</span></p></p>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">Setting these two system properties for Sqoop can<br />
be achieved by setting the system environment variable </span><span>HADOOP_OPTS</span><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> which will be used for setting<br />
additional Java options to the JVM.</span></p>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> </span></p>
<p> <span>export HADOOP_OPTS=<br />
"-Doracle.net.tns_admin=$HOME/wallet<br />
-Doracle.net.wallet_location=$HOME/wallet_test"</span></p>
<p><o:p> </o:p></p>
<h3 style="margin: 17pt 0in 6pt;"><a name="h6w1n6z4qgwjs"></a><span style="font-size: 11pt; line-height: 115%; font-family: Arial; color: gray;">Specify the Location of the Wallet and Oracle Configuration Files<br />
to the Mapper Tasks</span></h3>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">While the client program uses the DB for<br />
retrieving metadata, the mapper tasks do the actual data transfer. To provide<br />
the wallet files to the mapper tasks, we specify them as part of the &ndash;files<br />
tool option to localize to each mapper. Also, we have to use the Hadoop<br />
configuration properties to pass specific Java command line options (similar to<br />
</span><span>HADOOP_OPTS</span><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> for the launcher).</span></p>
<h3 style="margin: 17pt 0in 6pt;"><a name="hirglz93bs0w0"></a><span style="font-size: 11pt; line-height: 115%; font-family: Arial; color: gray;">Specify the Option to Localize the Files to the Mapper Tasks</span></h3>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">This can be achieved by adding the </span><span>&ndash;files</span><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> option to the Sqoop command line.</span></p>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> </span></p>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">Please note that Hadoop options have to come<br />
before any Sqoop options. The option and option argument can be specified as<br />
follows:</span></p>
<p><span>-files $HOME/wallet/cwallet.sso,\</span></p>
<p><span>$HOME/wallet/ewallet.p12,\</span></p>
<p><span>$HOME/wallet/sqlnet.ora,\</span></p>
<p><span>$HOME/wallet/tnsnames.ora</span></p>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> </span></p></p>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">We also have to tell the Mapper tasks the<br />
location of wallet and TNS files. We use the hadoop configuration parameter </span><span>mapred.child.java.opts</span><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> to provide additional Java options to<br />
the mappers.</span></p>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> </span></p>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">Note that we use the current directory as the<br />
location (&lsquo;.&rsquo;). This is because the files provided by the </span><span>&ndash;files</span><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> option will be localized to the current<br />
directory for each mapper task.</span></p>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> </span></p>
<p><span>-D<br />
mapred.map.child.java.opts=&rsquo;-Doracle.net.tns_admin=.<br />
-Doracle.net.wallet_location=.'</span></p>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> </span></p></p>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">If there are additional Java options that need to<br />
be provided for the mappers, they should be added to the Java options given<br />
below. For example, to add the system<br />
property -Djava.security.egd=file:/dev/./urandom, the options would be<br />
specified as:</span></p>
<p><span>-D<br />
mapred.map.child.java.opts=&rsquo;-Doracle.net.tns_admin=.<br />
-Doracle.net.wallet_location=. &ndash;Djava.security.egd=file:/dev/./urandom'</span></p></p>
<h3 style="margin: 17pt 0in 6pt;"><a name="h51vw55n2pym2"></a><span style="font-size: 11pt; line-height: 115%; font-family: Arial; color: gray;">Modify the JDBC URL</span></h3>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">The JDBC URL provided should use the format </span><span>jdbc:oracle:thin:@SVC</span><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> where the </span><span>SVC</span><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> is the service name used for accessing the<br />
database.</span></p>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> </span></p>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">This is added as part of the createCredential<br />
command above and should also be in the </span><span>tnsnames.ora</span><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> file.</span></p>
<h3 style="margin: 17pt 0in 6pt;"><a name="hkmm1ehj7sweg"></a><em><span style="font-size: 11pt; line-height: 115%; font-family: Arial;">Run the Sqoop Job with Oracle<br />
Wallet</span></em></h3>
<p>Please make sure that Apache<br />
Sqoop v1.4.5 is used or (if using a prior version of Sqoop) install <span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">the OracleManager fix for wallet support.</span></p>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> </span></p>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">When we use wallet-based authentication, we don&rsquo;t<br />
provide the username or password for establishing the JDBC connection.</span></p>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> </span></p>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">Sqoop code has been enhanced to properly handle<br />
this case (please see</span><a href="https://issues.apache.org/jira/browse/SQOOP-1224"><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> </span></a><a href="https://issues.apache.org/jira/browse/SQOOP-1224"><spancolor:>SQOOP</spancolor:></a><a href="https://issues.apache.org/jira/browse/SQOOP-1224"><spancolor:>-1224</spancolor:></a><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> for more information). Use Oracle<br />
session user when the database user name is not explicitly provided.</span></p>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;"> </span></p>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">This will be part of </span><span>Sqoop 1.4.5 </span><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">and later versions. For versions of Sqoop prior to 1.4.5, please<br />
make sure that the Sqoop product has this patch applied.</span></p>
<h3 style="margin: 17pt 0in 6pt;"><a name="h4ncnx486a6gi"></a><span style="font-size: 11pt; line-height: 115%; font-family: Arial; color: gray;">Run the Sqoop Job</span></h3>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">Now we are ready to use the wallet with the Sqoop<br />
job.</span></p></p>
<p><span style="font-size: 10pt; line-height: 115%; font-family: Verdana;">Here is an excerpt from a script that can be used<br />
after the wallet and Oracle client configuration setup are complete. This combines all of the steps previously<br />
outlined in this post.</span></p></p>
<table class="MsoNormalTable" border="0" cellspacing="0" cellpadding="0" width="351" style="margin-left: 5pt; border-collapse: collapse;">
<tbody>
<tr>
<td width="351" valign="top" style="width: 351.25pt; border: 1pt solid windowtext; padding: 5pt;">
<p><span>export<br />
  HADOOP_OPTS= "-Doracle.net.tns_admin=$PWD/wallet<br />
  -Doracle.net.wallet_location=$PWD/wallet "</span></p></p>
<p><span>sqoop<br />
  {import|export} \</span></p>
<p><span>-D<br />
  mapred.map.child.java.opts= '-Doracle.net.tns_admin=.<br />
  -Doracle.net.wallet_location=.' \</span></p>
<p><span>-files<br />
  $HOME/wallet/cwallet.sso,\</span></p>
<p><span>$HOME/wallet/ewallet.p12,\</span></p>
<p><span>$HOME/wallet/sqlnet.ora,\</span></p>
<p><span>$HOME/wallet/tnsnames.ora<br />
  \</span></p>
<p><span>-connect<br />
  &lsquo;jdbc:oracle:thin:@w_orcl&rsquo; \</span></p>
<p><span><<rest<br />
  of sqoop options>></span></p>
</td>
</tr>
</tbody>
</table>

  </div><a class="u-url" href="/sqoop/entry/using_oracle_wallets_with_sqoop" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Blogs Archive</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Blogs Archive</li><li><a class="u-email" href="mailto:issues@infra.apache.org">issues@infra.apache.org</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/jekyll"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">jekyll</span></a></li><li><a href="https://www.twitter.com/jekyllrb"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">jekyllrb</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>This is an archive of the Roller blogs that were previously hosted on blogs.apache.org</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
